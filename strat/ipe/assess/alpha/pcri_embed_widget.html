<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PCRI Quick Assessment</title>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: var(--pcri-font, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
      background: transparent;
      color: var(--pcri-text, #fff);
    }
    
    /* Theme CSS Variables - can be overridden via URL params or parent page */
    :root {
      --pcri-primary: #6436bf;
      --pcri-primary-dark: #42247f;
      --pcri-primary-light: #a78bfa;
      --pcri-bg-start: #16213e;
      --pcri-bg-end: #1a1a2e;
      --pcri-text: #fff;
      --pcri-text-muted: rgba(255,255,255,0.6);
      --pcri-border: rgba(100, 54, 191, 0.3);
      --pcri-font: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    /* Light theme */
    .theme-light {
      --pcri-primary: #6436bf;
      --pcri-primary-dark: #42247f;
      --pcri-primary-light: #a78bfa;
      --pcri-bg-start: #ffffff;
      --pcri-bg-end: #f5f3ff;
      --pcri-text: #1a1a2e;
      --pcri-text-muted: rgba(26,26,46,0.6);
      --pcri-border: rgba(100, 54, 191, 0.2);
    }
    
    /* Corporate Blue theme */
    .theme-corporate {
      --pcri-primary: #0066cc;
      --pcri-primary-dark: #004d99;
      --pcri-primary-light: #3399ff;
      --pcri-bg-start: #0a1628;
      --pcri-bg-end: #0d1f3c;
      --pcri-text: #fff;
      --pcri-text-muted: rgba(255,255,255,0.6);
      --pcri-border: rgba(0, 102, 204, 0.3);
    }
    
    /* Emerald theme */
    .theme-emerald {
      --pcri-primary: #059669;
      --pcri-primary-dark: #047857;
      --pcri-primary-light: #34d399;
      --pcri-bg-start: #0a1f1a;
      --pcri-bg-end: #0d2922;
      --pcri-text: #fff;
      --pcri-text-muted: rgba(255,255,255,0.6);
      --pcri-border: rgba(5, 150, 105, 0.3);
    }
    
    /* Sunset theme */
    .theme-sunset {
      --pcri-primary: #ea580c;
      --pcri-primary-dark: #c2410c;
      --pcri-primary-light: #fb923c;
      --pcri-bg-start: #1f1007;
      --pcri-bg-end: #2a150a;
      --pcri-text: #fff;
      --pcri-text-muted: rgba(255,255,255,0.6);
      --pcri-border: rgba(234, 88, 12, 0.3);
    }
    
    /* Minimal theme */
    .theme-minimal {
      --pcri-primary: #374151;
      --pcri-primary-dark: #1f2937;
      --pcri-primary-light: #6b7280;
      --pcri-bg-start: #ffffff;
      --pcri-bg-end: #f9fafb;
      --pcri-text: #111827;
      --pcri-text-muted: rgba(17,24,39,0.6);
      --pcri-border: rgba(55, 65, 81, 0.2);
    }
    
    .widget-container {
      max-width: 480px;
      margin: 0 auto;
      padding: 0;
    }
    .widget-card {
      background: linear-gradient(145deg, var(--pcri-bg-start) 0%, var(--pcri-bg-end) 100%);
      border-radius: 16px;
      padding: 24px;
      border: 1px solid var(--pcri-border);
      box-shadow: 0 12px 40px rgba(0,0,0,0.3);
    }
    .widget-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .custom-logo {
      max-height: 40px;
      max-width: 160px;
      margin-bottom: 12px;
    }
    .logo-badge {
      display: inline-block;
      background: linear-gradient(135deg, var(--pcri-primary) 0%, var(--pcri-primary-dark) 100%);
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 1px;
      margin-bottom: 12px;
      color: #fff;
    }
    .widget-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 6px;
      color: var(--pcri-text);
    }
    .widget-subtitle {
      font-size: 0.8rem;
      color: var(--pcri-text-muted);
    }
    .progress-container {
      margin-bottom: 16px;
    }
    .progress-bar-bg {
      height: 6px;
      background: var(--pcri-border);
      border-radius: 3px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--pcri-primary) 0%, var(--pcri-primary-light) 100%);
      transition: width 0.3s ease;
    }
    .progress-text {
      font-size: 0.75rem;
      color: var(--pcri-text-muted);
      text-align: right;
      margin-top: 4px;
    }
    .question-container {
      margin-bottom: 16px;
    }
    .question-text {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--pcri-text);
      margin-bottom: 12px;
    }
    .option-btn {
      width: 100%;
      text-align: left;
      padding: 12px 14px;
      margin-bottom: 8px;
      border-radius: 8px;
      border: 1px solid var(--pcri-border);
      background: rgba(255,255,255,0.03);
      color: var(--pcri-text);
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .theme-light .option-btn,
    .theme-minimal .option-btn {
      background: rgba(0,0,0,0.02);
    }
    .option-btn:hover {
      border-color: var(--pcri-primary);
      background: rgba(100, 54, 191, 0.08);
    }
    .option-btn.selected {
      border-color: var(--pcri-primary);
      background: rgba(100, 54, 191, 0.15);
    }
    .btn-primary {
      width: 100%;
      background: linear-gradient(135deg, var(--pcri-primary) 0%, var(--pcri-primary-dark) 100%);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.9rem;
      border: none;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(100, 54, 191, 0.4);
    }
    .result-container {
      text-align: center;
    }
    .result-score {
      font-size: 3rem;
      font-weight: 700;
      color: var(--pcri-text);
      margin-bottom: 4px;
    }
    .result-label {
      font-size: 0.85rem;
      color: var(--pcri-text-muted);
      margin-bottom: 16px;
    }
    .result-tier {
      display: inline-block;
      padding: 6px 16px;
      background: rgba(100, 54, 191, 0.2);
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--pcri-primary-light);
      margin-bottom: 16px;
    }
    .theme-light .result-tier,
    .theme-minimal .result-tier {
      color: var(--pcri-primary);
    }
    .cta-link {
      display: block;
      color: var(--pcri-primary-light);
      font-size: 0.85rem;
      text-decoration: none;
      margin-top: 12px;
    }
    .theme-light .cta-link,
    .theme-minimal .cta-link {
      color: var(--pcri-primary);
    }
    .cta-link:hover {
      text-decoration: underline;
    }
    .form-input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid var(--pcri-border);
      background: rgba(255,255,255,0.03);
      color: var(--pcri-text);
      font-size: 0.85rem;
      margin-bottom: 12px;
    }
    .theme-light .form-input,
    .theme-minimal .form-input {
      background: rgba(0,0,0,0.02);
    }
    .form-input:focus {
      outline: none;
      border-color: var(--pcri-primary);
    }
    .form-label {
      font-size: 0.75rem;
      color: var(--pcri-text-muted);
      margin-bottom: 6px;
      display: block;
    }
    .pillar-mini {
      display: flex;
      justify-content: space-between;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--pcri-border);
    }
    .pillar-item {
      text-align: center;
      flex: 1;
    }
    .pillar-value {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--pcri-text);
    }
    .pillar-label {
      font-size: 0.65rem;
      color: var(--pcri-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .powered-by {
      text-align: center;
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid var(--pcri-border);
      font-size: 0.7rem;
      color: var(--pcri-text-muted);
    }
    .powered-by a {
      color: var(--pcri-primary-light);
      text-decoration: none;
    }
    .powered-by a:hover {
      text-decoration: underline;
    }
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Industry tag */
    .industry-tag {
      display: inline-block;
      padding: 3px 10px;
      background: var(--pcri-border);
      border-radius: 10px;
      font-size: 0.7rem;
      color: var(--pcri-text-muted);
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <div class="widget-container" id="widget-root">
    <div class="widget-card">
      <!-- Intro View -->
      <div id="intro-view">
        <div class="widget-header">
          <div id="custom-logo-container" style="display: none;">
            <img id="custom-logo" class="custom-logo" src="" alt="Logo">
          </div>
          <div class="logo-badge" id="badge-text">PCRI QUICK CHECK</div>
          <div id="industry-tag-container" style="display: none;">
            <span class="industry-tag" id="industry-tag"></span>
          </div>
          <h1 class="widget-title" id="widget-title">How AI-Ready Is Your Product System?</h1>
          <p class="widget-subtitle" id="widget-subtitle">5 questions • 2 minutes • Instant score</p>
        </div>
        
        <div style="margin-bottom: 16px;">
          <label class="form-label">Your email (for results)</label>
          <input type="email" class="form-input" id="widget-email" placeholder="you@company.com">
        </div>
        
        <button class="btn-primary" onclick="startWidget()" id="start-btn">
          <span id="start-btn-text">Start Quick Assessment</span>
          <i data-lucide="arrow-right" style="width: 18px; height: 18px;"></i>
        </button>
        
        <a href="./ipe_assessment_ab.html" class="cta-link" style="text-align: center;" id="full-assessment-link">
          Take the full assessment →
        </a>
      </div>
      
      <!-- Question View -->
      <div id="question-view" style="display: none;">
        <div class="progress-container">
          <div class="progress-bar-bg">
            <div class="progress-bar" id="widget-progress" style="width: 0%;"></div>
          </div>
          <div class="progress-text" id="widget-progress-text">1 of 5</div>
        </div>
        
        <div class="question-container" id="widget-question"></div>
      </div>
      
      <!-- Result View -->
      <div id="result-view" style="display: none;">
        <div class="result-container fade-in">
          <div class="logo-badge">YOUR QUICK SCORE</div>
          <div class="result-score" id="widget-score">—</div>
          <div class="result-label">Product System Readiness Index</div>
          <div class="result-tier" id="widget-tier">—</div>
          
          <div class="pillar-mini">
            <div class="pillar-item">
              <div class="pillar-value" id="w-foundation">—</div>
              <div class="pillar-label">Foundation</div>
            </div>
            <div class="pillar-item">
              <div class="pillar-value" id="w-governance">—</div>
              <div class="pillar-label">Governance</div>
            </div>
            <div class="pillar-item">
              <div class="pillar-value" id="w-ai">—</div>
              <div class="pillar-label">AI Ready</div>
            </div>
          </div>
          
          <a href="./ipe_assessment_ab.html" class="btn-primary" style="margin-top: 20px; text-decoration: none;" id="full-cta-btn">
            Get Full Assessment & Recommendations
          </a>
          
          <button onclick="resetWidget()" style="background: none; border: none; color: var(--pcri-text-muted); font-size: 0.8rem; margin-top: 12px; cursor: pointer;">
            Start Over
          </button>
        </div>
      </div>
      
      <!-- Powered By (optional) -->
      <div class="powered-by" id="powered-by" style="display: none;">
        Powered by <a href="https://knapsack.cloud" target="_blank">Knapsack</a>
      </div>
    </div>
  </div>

  <script>
    // ==========================================================================
    // WIDGET CONFIGURATION
    // ==========================================================================
    
    const CONFIG = {
      // Theme: 'default', 'light', 'corporate', 'emerald', 'sunset', 'minimal'
      theme: 'default',
      // Custom logo URL
      logoUrl: '',
      // Custom title
      title: 'How AI-Ready Is Your Product System?',
      // Custom subtitle
      subtitle: '5 questions • 2 minutes • Instant score',
      // Badge text
      badgeText: 'PCRI QUICK CHECK',
      // Start button text
      startButtonText: 'Start Quick Assessment',
      // Full assessment URL
      fullAssessmentUrl: './ipe_assessment_ab.html',
      // Show powered by
      showPoweredBy: false,
      // Industry (for industry-specific questions)
      industry: '',
      // Callback URL for results (webhook)
      callbackUrl: '',
      // Custom primary color (hex)
      primaryColor: '',
      // Hide email field
      hideEmail: false
    };
    
    // Industry-specific question variants
    const industryQuestions = {
      'Financial Services': {
        governance: {
          question: 'How is your design system governed for compliance?',
          options: [
            { text: 'No governance structure', score: 0 },
            { text: 'Informal, compliance handled separately', score: 20 },
            { text: 'Governance exists, compliance-aware', score: 50 },
            { text: 'Active governance with audit trails', score: 75 },
            { text: 'Full compliance integration with governance', score: 100 }
          ]
        },
        ai: {
          question: 'How are AI tools being adopted with regulatory considerations?',
          options: [
            { text: 'No AI tools approved', score: 0 },
            { text: 'Exploring with legal review', score: 25 },
            { text: 'Piloting with compliance guardrails', score: 50 },
            { text: 'Approved tools with usage policies', score: 75 },
            { text: 'Governed AI workflows in production', score: 100 }
          ]
        }
      },
      'Healthcare': {
        governance: {
          question: 'How is your design system governed for HIPAA/patient data?',
          options: [
            { text: 'No governance for PHI', score: 0 },
            { text: 'Ad-hoc, PHI handled elsewhere', score: 20 },
            { text: 'Governance exists, PHI-aware patterns', score: 50 },
            { text: 'Active governance with PHI controls', score: 75 },
            { text: 'Full PHI compliance baked into system', score: 100 }
          ]
        },
        ai: {
          question: 'How are AI tools being adopted with patient data safeguards?',
          options: [
            { text: 'No AI tools in use', score: 0 },
            { text: 'Exploring non-PHI use cases', score: 25 },
            { text: 'Piloting with strict data isolation', score: 50 },
            { text: 'Approved for specific workflows', score: 75 },
            { text: 'Governed AI with audit logging', score: 100 }
          ]
        }
      },
      'Retail / E-commerce': {
        foundation: {
          question: 'What is the state of your product/commerce design system?',
          options: [
            { text: 'No unified system across channels', score: 0 },
            { text: 'Separate systems per channel', score: 25 },
            { text: 'Some shared components', score: 50 },
            { text: 'Unified system, moderate adoption', score: 75 },
            { text: 'Omnichannel design system, high adoption', score: 100 }
          ]
        }
      },
      'Technology / Media': {
        ai: {
          question: 'How are your engineering teams adopting AI coding tools?',
          options: [
            { text: 'No AI tools sanctioned', score: 0 },
            { text: 'Individual experimentation', score: 25 },
            { text: 'Team-level adoption', score: 50 },
            { text: 'Org-wide with best practices', score: 75 },
            { text: 'AI-first development culture', score: 100 }
          ]
        }
      }
    };
    
    // Base questions (generic)
    const baseQuestions = [
      {
        category: 'Foundation',
        key: 'foundation',
        question: 'What is the current state of your design system?',
        options: [
          { text: 'No design system', score: 0 },
          { text: 'Informal or scattered', score: 25 },
          { text: 'Exists with limited adoption', score: 50 },
          { text: 'Deployed with moderate adoption', score: 75 },
          { text: 'Mature with high adoption', score: 100 }
        ]
      },
      {
        category: 'Governance',
        key: 'governance',
        question: 'How is your design system governed?',
        options: [
          { text: 'No governance', score: 0 },
          { text: 'Informal or ad-hoc', score: 25 },
          { text: 'Exists but not enforced', score: 50 },
          { text: 'Active with decision authority', score: 75 },
          { text: 'Cross-system with clear rules', score: 100 }
        ]
      },
      {
        category: 'AI',
        key: 'ai',
        question: 'How are your teams using AI coding tools?',
        options: [
          { text: 'No AI tools', score: 0 },
          { text: 'Limited experimentation', score: 25 },
          { text: 'Some teams using AI', score: 50 },
          { text: 'Widespread adoption', score: 75 },
          { text: 'Integrated into workflows', score: 100 }
        ]
      },
      {
        category: 'Governance',
        key: 'sponsor',
        question: 'Is there executive sponsorship for product system work?',
        options: [
          { text: 'No sponsor', score: 0 },
          { text: 'IC or Manager level', score: 25 },
          { text: 'Director-level', score: 50 },
          { text: 'VP-level', score: 75 },
          { text: 'C-level', score: 100 }
        ]
      },
      {
        category: 'Foundation',
        key: 'collaboration',
        question: 'How well do design and engineering collaborate?',
        options: [
          { text: 'Siloed with friction', score: 0 },
          { text: 'Aligned but inconsistent', score: 50 },
          { text: 'Highly integrated', score: 100 }
        ]
      }
    ];

    let widgetQuestions = [];
    let currentQ = 0;
    let widgetAnswers = [];
    let userEmail = '';

    // ==========================================================================
    // INITIALIZATION
    // ==========================================================================
    
    function initWidget() {
      // Parse URL parameters
      const params = new URLSearchParams(window.location.search);
      
      // Apply config from URL params
      if (params.get('theme')) CONFIG.theme = params.get('theme');
      if (params.get('logo')) CONFIG.logoUrl = params.get('logo');
      if (params.get('title')) CONFIG.title = decodeURIComponent(params.get('title'));
      if (params.get('subtitle')) CONFIG.subtitle = decodeURIComponent(params.get('subtitle'));
      if (params.get('badge')) CONFIG.badgeText = decodeURIComponent(params.get('badge'));
      if (params.get('startText')) CONFIG.startButtonText = decodeURIComponent(params.get('startText'));
      if (params.get('fullUrl')) CONFIG.fullAssessmentUrl = decodeURIComponent(params.get('fullUrl'));
      if (params.get('poweredBy') === 'true') CONFIG.showPoweredBy = true;
      if (params.get('industry')) CONFIG.industry = decodeURIComponent(params.get('industry'));
      if (params.get('callback')) CONFIG.callbackUrl = decodeURIComponent(params.get('callback'));
      if (params.get('color')) CONFIG.primaryColor = params.get('color');
      if (params.get('hideEmail') === 'true') CONFIG.hideEmail = true;
      
      // Apply theme
      if (CONFIG.theme !== 'default') {
        document.getElementById('widget-root').classList.add(`theme-${CONFIG.theme}`);
      }
      
      // Apply custom primary color
      if (CONFIG.primaryColor) {
        const color = CONFIG.primaryColor.startsWith('#') ? CONFIG.primaryColor : `#${CONFIG.primaryColor}`;
        document.documentElement.style.setProperty('--pcri-primary', color);
        // Generate lighter/darker variants
        document.documentElement.style.setProperty('--pcri-primary-light', adjustColor(color, 40));
        document.documentElement.style.setProperty('--pcri-primary-dark', adjustColor(color, -30));
      }
      
      // Apply logo
      if (CONFIG.logoUrl) {
        document.getElementById('custom-logo').src = CONFIG.logoUrl;
        document.getElementById('custom-logo-container').style.display = 'block';
      }
      
      // Apply text customizations
      document.getElementById('widget-title').textContent = CONFIG.title;
      document.getElementById('widget-subtitle').textContent = CONFIG.subtitle;
      document.getElementById('badge-text').textContent = CONFIG.badgeText;
      document.getElementById('start-btn-text').textContent = CONFIG.startButtonText;
      document.getElementById('full-assessment-link').href = CONFIG.fullAssessmentUrl;
      document.getElementById('full-cta-btn').href = CONFIG.fullAssessmentUrl;
      
      // Show powered by
      if (CONFIG.showPoweredBy) {
        document.getElementById('powered-by').style.display = 'block';
      }
      
      // Show industry tag
      if (CONFIG.industry) {
        document.getElementById('industry-tag').textContent = CONFIG.industry;
        document.getElementById('industry-tag-container').style.display = 'block';
      }
      
      // Hide email field
      if (CONFIG.hideEmail) {
        document.querySelector('.form-label').parentElement.style.display = 'none';
      }
      
      // Build questions with industry variants
      buildQuestions();
      
      // Initialize icons
      lucide.createIcons();
    }
    
    function adjustColor(hex, percent) {
      const num = parseInt(hex.replace('#', ''), 16);
      const amt = Math.round(2.55 * percent);
      const R = (num >> 16) + amt;
      const G = (num >> 8 & 0x00FF) + amt;
      const B = (num & 0x0000FF) + amt;
      return '#' + (0x1000000 + 
        (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + 
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + 
        (B < 255 ? B < 1 ? 0 : B : 255)
      ).toString(16).slice(1);
    }
    
    function buildQuestions() {
      widgetQuestions = baseQuestions.map(q => {
        // Check for industry-specific variant
        if (CONFIG.industry && industryQuestions[CONFIG.industry]) {
          const variant = industryQuestions[CONFIG.industry][q.key];
          if (variant) {
            return { ...q, ...variant };
          }
        }
        return q;
      });
    }

    function startWidget() {
      userEmail = document.getElementById('widget-email')?.value || '';
      document.getElementById('intro-view').style.display = 'none';
      document.getElementById('question-view').style.display = 'block';
      renderWidgetQuestion();
    }

    function renderWidgetQuestion() {
      const q = widgetQuestions[currentQ];
      const progress = ((currentQ + 1) / widgetQuestions.length) * 100;
      
      document.getElementById('widget-progress').style.width = `${progress}%`;
      document.getElementById('widget-progress-text').textContent = `${currentQ + 1} of ${widgetQuestions.length}`;
      
      const optionsHtml = q.options.map((opt, idx) => `
        <button class="option-btn" onclick="selectWidgetOption(${idx})">
          ${opt.text}
        </button>
      `).join('');
      
      document.getElementById('widget-question').innerHTML = `
        <div class="fade-in">
          <div class="question-text">${q.question}</div>
          ${optionsHtml}
        </div>
      `;
    }

    function selectWidgetOption(idx) {
      const q = widgetQuestions[currentQ];
      widgetAnswers.push({
        category: q.category,
        key: q.key,
        score: q.options[idx].score,
        answer: q.options[idx].text
      });
      
      currentQ++;
      
      if (currentQ >= widgetQuestions.length) {
        showWidgetResults();
      } else {
        renderWidgetQuestion();
      }
    }

    function showWidgetResults() {
      // Calculate scores by category
      const categoryScores = { Foundation: [], Governance: [], AI: [] };
      
      widgetAnswers.forEach(a => {
        categoryScores[a.category].push(a.score);
      });
      
      const foundationScore = Math.round(categoryScores.Foundation.reduce((a, b) => a + b, 0) / categoryScores.Foundation.length);
      const governanceScore = Math.round(categoryScores.Governance.reduce((a, b) => a + b, 0) / categoryScores.Governance.length);
      const aiScore = Math.round(categoryScores.AI.reduce((a, b) => a + b, 0) / categoryScores.AI.length);
      
      // Calculate PCRI (simplified)
      const pcri = Math.round((foundationScore * 0.35) + (governanceScore * 0.35) + (aiScore * 0.30));
      
      // Determine tier
      let tier = 'Foundation';
      if (pcri >= 75) tier = 'Intelligence';
      else if (pcri >= 55) tier = 'Scale';
      else if (pcri >= 40) tier = 'Momentum';
      
      // Build result data
      const resultData = {
        type: 'pcri_widget_complete',
        email: userEmail,
        pcri: pcri,
        tier: tier,
        foundation: foundationScore,
        governance: governanceScore,
        ai: aiScore,
        industry: CONFIG.industry,
        answers: widgetAnswers,
        timestamp: new Date().toISOString()
      };
      
      // Update UI
      document.getElementById('question-view').style.display = 'none';
      document.getElementById('result-view').style.display = 'block';
      
      document.getElementById('widget-score').textContent = pcri;
      document.getElementById('widget-tier').textContent = tier + ' Tier';
      document.getElementById('w-foundation').textContent = foundationScore + '%';
      document.getElementById('w-governance').textContent = governanceScore + '%';
      document.getElementById('w-ai').textContent = aiScore + '%';
      
      // PostMessage to parent
      if (window.parent !== window) {
        window.parent.postMessage(resultData, '*');
      }
      
      // Webhook callback
      if (CONFIG.callbackUrl) {
        fetch(CONFIG.callbackUrl, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(resultData)
        }).catch(console.error);
      }
    }

    function resetWidget() {
      currentQ = 0;
      widgetAnswers = [];
      document.getElementById('result-view').style.display = 'none';
      document.getElementById('intro-view').style.display = 'block';
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', initWidget);
  </script>
</body>
</html>
