<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product System Maturity & AI Readiness Assessment</title>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    /* ==========================================================================
       SPECTRUM-INSPIRED DESIGN TOKENS
       ========================================================================== */
    :root {
      /* Primary palette (preserved) */
      --spectrum-purple-900: #42247f;
      --spectrum-purple-700: #6436bf;
      --spectrum-purple-500: #8b5cf6;
      --spectrum-purple-400: #a78bfa;
      --spectrum-purple-300: #c4b5fd;
      --spectrum-purple-100: #e0d4f7;
      
      /* Semantic colors */
      --spectrum-green-500: #10b981;
      --spectrum-green-400: #34d399;
      --spectrum-green-300: #6ee7b7;
      --spectrum-blue-500: #3b82f6;
      --spectrum-blue-400: #60a5fa;
      --spectrum-blue-300: #93c5fd;
      --spectrum-amber-500: #f59e0b;
      --spectrum-amber-400: #fbbf24;
      --spectrum-amber-300: #fde047;
      --spectrum-red-500: #ef4444;
      --spectrum-red-400: #f87171;
      --spectrum-red-300: #fca5a5;
      
      /* High contrast badge colors for accessibility (4.5:1 on dark backgrounds) */
      --a11y-badge-critical: #dc2626;   /* Red - 4.5:1 with white */
      --a11y-badge-high: #b45309;       /* Amber-700 - 4.5:1 with white */
      --a11y-badge-medium: #0369a1;     /* Sky-700 - 4.5:1 with white */
      --a11y-badge-low: #15803d;        /* Green-700 - 4.5:1 with white */
      
      /* Background layers */
      --spectrum-bg-base: #1a1a2e;
      --spectrum-bg-layer-1: #16213e;
      --spectrum-bg-layer-2: rgba(255,255,255,0.03);
      --spectrum-bg-elevated: rgba(255,255,255,0.05);
      
      /* Text colors - WCAG AA compliant (4.5:1 minimum for normal text, 3:1 for large) */
      --spectrum-text-primary: #ffffff;
      --spectrum-text-secondary: rgba(255,255,255,0.9);   /* ~8:1 contrast */
      --spectrum-text-tertiary: rgba(255,255,255,0.8);    /* ~6:1 contrast */
      --spectrum-text-disabled: rgba(255,255,255,0.65);   /* ~4.8:1 contrast - meets AA */
      --spectrum-text-placeholder: rgba(255,255,255,0.55); /* ~4.5:1 - borderline AA */
      --spectrum-text-muted: rgba(255,255,255,0.7);       /* ~5:1 contrast for helper text */
      
      /* Borders */
      --spectrum-border-default: rgba(100, 54, 191, 0.3);
      --spectrum-border-hover: rgba(100, 54, 191, 0.5);
      --spectrum-border-focus: rgba(100, 54, 191, 0.8);
      --spectrum-border-subtle: rgba(255,255,255,0.08);
      
      /* Spacing (8px grid) */
      --spectrum-spacing-50: 4px;
      --spectrum-spacing-100: 8px;
      --spectrum-spacing-200: 16px;
      --spectrum-spacing-300: 24px;
      --spectrum-spacing-400: 32px;
      --spectrum-spacing-500: 40px;
      --spectrum-spacing-600: 48px;
      
      /* Typography */
      --spectrum-font-size-75: 0.75rem;     /* 12px (was 11px) */
      --spectrum-font-size-100: 0.875rem;   /* 14px (was 12px) */
      --spectrum-font-size-200: 1rem;       /* 16px (was 14px) */
      --spectrum-font-size-300: 1.0625rem;  /* 17px (was 15px) */
      --spectrum-font-size-400: 1.125rem;   /* 18px (was 16px) */
      --spectrum-font-size-500: 1.25rem;    /* 20px (was 18px) */
      --spectrum-font-size-600: 1.375rem;   /* 22px (was 20px) */
      --spectrum-font-size-700: 1.625rem;   /* 26px (was 24px) */
      --spectrum-font-size-800: 2rem;       /* 32px (was 30px) */
      --spectrum-font-size-900: 2.5rem;     /* 40px (was 36px) */
      
      /* Border radius */
      --spectrum-radius-sm: 4px;
      --spectrum-radius-md: 8px;
      --spectrum-radius-lg: 12px;
      --spectrum-radius-xl: 16px;
      --spectrum-radius-full: 9999px;
      
      /* Shadows */
      --spectrum-shadow-sm: 0 1px 2px rgba(0,0,0,0.2);
      --spectrum-shadow-md: 0 4px 12px rgba(0,0,0,0.25);
      --spectrum-shadow-lg: 0 8px 24px rgba(0,0,0,0.3);
      --spectrum-shadow-xl: 0 16px 48px rgba(0,0,0,0.35);
      
      /* Transitions */
      --spectrum-transition-fast: 130ms ease;
      --spectrum-transition-normal: 200ms ease;
      --spectrum-transition-slow: 300ms ease;
    }
    
    /* ==========================================================================
       BASE STYLES
       ========================================================================== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Adobe Clean', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: var(--spectrum-font-size-300);
      line-height: 1.5;
      background: var(--spectrum-bg-base);
      color: var(--spectrum-text-primary);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* ==========================================================================
       LAYOUT
       ========================================================================== */
    .container {
      max-width: 960px;
      margin: 0 auto;
      padding: var(--spectrum-spacing-300);
    }
    
    /* ==========================================================================
       CARDS
       ========================================================================== */
    .card {
      background: linear-gradient(145deg, var(--spectrum-bg-layer-1) 0%, var(--spectrum-bg-base) 100%);
      border-radius: var(--spectrum-radius-xl);
      padding: var(--spectrum-spacing-400);
      margin-bottom: var(--spectrum-spacing-400);
      border: 1px solid var(--spectrum-border-default);
      box-shadow: var(--spectrum-shadow-lg);
      transition: box-shadow var(--spectrum-transition-normal), border-color var(--spectrum-transition-normal);
    }
    
    .card:hover {
      box-shadow: var(--spectrum-shadow-xl);
    }
    
    /* ==========================================================================
       TYPOGRAPHY
       ========================================================================== */
    h1 {
      font-size: var(--spectrum-font-size-900);
      font-weight: 700;
      line-height: 1.15;
      letter-spacing: -0.02em;
      margin-bottom: var(--spectrum-spacing-200);
      background: linear-gradient(135deg, #fff 0%, var(--spectrum-purple-100) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    h2 {
      font-size: var(--spectrum-font-size-700);
      font-weight: 700;
      line-height: 1.25;
      letter-spacing: -0.01em;
      margin-bottom: var(--spectrum-spacing-300);
      color: var(--spectrum-text-primary);
    }
    
    h3 {
      font-size: var(--spectrum-font-size-400);
      font-weight: 600;
      color: var(--spectrum-purple-400);
      margin-bottom: var(--spectrum-spacing-100);
    }
    
    h4 {
      font-size: var(--spectrum-font-size-300);
      font-weight: 600;
      color: var(--spectrum-text-primary);
      margin-bottom: var(--spectrum-spacing-50);
    }
    
    .section-label {
      font-size: var(--spectrum-font-size-75);
      font-weight: 600;
      color: var(--spectrum-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: var(--spectrum-spacing-100);
    }
    
    /* ==========================================================================
       BUTTONS
       ========================================================================== */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--spectrum-spacing-100);
      padding: var(--spectrum-spacing-100) var(--spectrum-spacing-200);
      min-height: 40px;
      border-radius: var(--spectrum-radius-md);
      font-size: var(--spectrum-font-size-300);
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all var(--spectrum-transition-fast);
      text-decoration: none;
    }
    
    .btn:focus-visible {
      outline: 2px solid var(--spectrum-purple-400);
      outline-offset: 2px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--spectrum-purple-700) 0%, var(--spectrum-purple-900) 100%);
      color: white;
      padding: var(--spectrum-spacing-200) var(--spectrum-spacing-400);
      min-height: 48px;
    }
    
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(100, 54, 191, 0.4);
    }
    
    .btn-primary:active {
      transform: translateY(0);
    }
    
    .btn-secondary {
      background: var(--spectrum-bg-elevated);
      color: var(--spectrum-text-primary);
      border: 1px solid var(--spectrum-border-default);
    }
    
    .btn-secondary:hover {
      background: rgba(255,255,255,0.08);
      border-color: var(--spectrum-border-hover);
    }
    
    .btn-quiet {
      background: transparent;
      color: var(--spectrum-text-secondary);
      padding: var(--spectrum-spacing-100) var(--spectrum-spacing-200);
    }
    
    .btn-quiet:hover {
      background: var(--spectrum-bg-elevated);
      color: var(--spectrum-text-primary);
    }
    
    .btn-lg {
      padding: var(--spectrum-spacing-200) var(--spectrum-spacing-400);
      min-height: 52px;
      font-size: var(--spectrum-font-size-400);
    }
    
    /* ==========================================================================
       FORM CONTROLS
       ========================================================================== */
    .form-group {
      margin-bottom: var(--spectrum-spacing-200);
    }
    
    .form-label {
      display: block;
      font-size: var(--spectrum-font-size-100);
      font-weight: 600;
      color: var(--spectrum-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: var(--spectrum-spacing-100);
    }
    
    .form-input {
      width: 100%;
      min-height: 44px;
      padding: var(--spectrum-spacing-100) var(--spectrum-spacing-200);
      border-radius: var(--spectrum-radius-md);
      border: 1px solid var(--spectrum-border-default);
      background: var(--spectrum-bg-layer-2);
      color: var(--spectrum-text-primary);
      font-size: var(--spectrum-font-size-300);
      transition: border-color var(--spectrum-transition-fast), box-shadow var(--spectrum-transition-fast);
    }
    
    .form-input::placeholder {
      color: var(--spectrum-text-placeholder);
    }
    
    .form-input:hover {
      border-color: var(--spectrum-border-hover);
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--spectrum-purple-700);
      box-shadow: 0 0 0 3px rgba(100, 54, 191, 0.25);
    }
    
    .form-helper {
      font-size: var(--spectrum-font-size-100);
      color: var(--spectrum-text-disabled);
      margin-top: var(--spectrum-spacing-100);
      line-height: 1.5;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spectrum-spacing-300);
    }
    
    /* Radio/Checkbox cards */
    .choice-card {
      display: flex;
      align-items: flex-start;
      gap: var(--spectrum-spacing-200);
      padding: var(--spectrum-spacing-200);
      background: var(--spectrum-bg-layer-2);
      border: 2px solid var(--spectrum-border-default);
      border-radius: var(--spectrum-radius-lg);
      cursor: pointer;
      transition: all var(--spectrum-transition-fast);
    }
    
    .choice-card:hover {
      border-color: var(--spectrum-border-hover);
      background: var(--spectrum-bg-elevated);
    }
    
    .choice-card.selected {
      border-color: var(--spectrum-purple-700);
      background: rgba(100, 54, 191, 0.12);
    }
    
    .choice-card input[type="radio"],
    .choice-card input[type="checkbox"] {
      accent-color: var(--spectrum-purple-700);
      width: 18px;
      height: 18px;
      margin-top: 2px;
      flex-shrink: 0;
    }
    
    /* Tool Chips */
    .tool-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: var(--spectrum-bg-layer-2);
      border: 1px solid var(--spectrum-border-default);
      border-radius: var(--spectrum-radius-full);
      color: var(--spectrum-text-secondary);
      font-size: var(--spectrum-font-size-100);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--spectrum-transition-fast);
    }
    
    .tool-chip:hover {
      border-color: var(--spectrum-border-hover);
      background: var(--spectrum-bg-elevated);
    }
    
    .tool-chip:focus-visible {
      outline: 2px solid var(--spectrum-purple-400);
      outline-offset: 2px;
    }
    
    .tool-chip.selected {
      background: rgba(100, 54, 191, 0.2);
      border-color: var(--spectrum-purple-700);
      color: var(--spectrum-text-primary);
    }
    
    .tool-chip.selected i {
      color: var(--spectrum-purple-400);
    }
    
    /* ==========================================================================
       DETAILS/SUMMARY (Expandable Sections)
       ========================================================================== */
    details {
      border-radius: var(--spectrum-radius-md);
    }
    
    details summary {
      list-style: none;
    }
    
    details summary::-webkit-details-marker {
      display: none;
    }
    
    details[open] summary {
      background: rgba(100, 54, 191, 0.08);
      border-color: var(--spectrum-purple-700);
    }
    
    details[open] summary i[data-lucide="chevron-down"] {
      transform: rotate(180deg);
    }
    
    details summary i[data-lucide="chevron-down"] {
      transition: transform var(--spectrum-transition-fast);
    }
    
    /* ==========================================================================
       EXPANDABLE OPTIONS (Calibration)
       ========================================================================== */
    .expandable-option {
      position: relative;
    }
    
    .expandable-option:hover {
      border-color: var(--spectrum-border-hover) !important;
      border-style: solid !important;
      background: rgba(255,255,255,0.05) !important;
    }
    
    .expandable-option:hover .expand-icon {
      color: var(--spectrum-purple-400) !important;
    }
    
    .expandable-option.expanded {
      border-color: var(--spectrum-purple-700) !important;
      border-style: solid !important;
      background: rgba(100, 54, 191, 0.06) !important;
    }
    
    .expandable-option.expanded .expand-icon {
      transform: rotate(90deg);
      color: var(--spectrum-purple-400) !important;
    }
    
    .expandable-option.expanded .expandable-content {
      max-height: 500px !important;
    }
    
    .expandable-option .expandable-header::after {
      content: "Click to expand";
      position: absolute;
      right: 50px;
      font-size: 0.7rem;
      color: var(--spectrum-text-disabled);
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    
    .expandable-option:hover .expandable-header::after {
      opacity: 1;
    }
    
    .expandable-option.expanded .expandable-header::after {
      content: "Click to collapse";
    }
    
    /* ==========================================================================
       OPTION CARDS (Questions)
       ========================================================================== */
    .option-card {
      width: 100%;
      text-align: left;
      padding: var(--spectrum-spacing-200);
      border-radius: var(--spectrum-radius-lg);
      border: 2px solid var(--spectrum-border-default);
      background: var(--spectrum-bg-layer-2);
      color: var(--spectrum-text-secondary);
      cursor: pointer;
      transition: all var(--spectrum-transition-fast);
    }
    
    .option-card:hover {
      transform: translateY(-2px);
      border-color: var(--spectrum-border-hover);
      background: var(--spectrum-bg-elevated);
      box-shadow: var(--spectrum-shadow-md);
    }
    
    .option-card:focus-visible {
      outline: 2px solid var(--spectrum-purple-400);
      outline-offset: 2px;
    }
    
    .option-card.selected {
      border-color: var(--spectrum-purple-700);
      background: rgba(100, 54, 191, 0.15);
      color: var(--spectrum-text-primary);
    }
    
    /* ==========================================================================
       CONTENT BOXES
       ========================================================================== */
    .content-box {
      background: var(--spectrum-bg-layer-2);
      border-radius: var(--spectrum-radius-lg);
      padding: var(--spectrum-spacing-200);
      border: 1px solid var(--spectrum-border-subtle);
      transition: border-color var(--spectrum-transition-fast);
    }
    
    .content-box:hover {
      border-color: var(--spectrum-border-default);
    }
    
    /* ==========================================================================
       PROGRESS INDICATOR
       ========================================================================== */
    .progress-container {
      margin-bottom: var(--spectrum-spacing-100);
    }
    
    .progress-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spectrum-spacing-100);
    }
    
    .progress-label {
      font-size: var(--spectrum-font-size-200);
      font-weight: 500;
      color: var(--spectrum-text-tertiary);
    }
    
    .progress-value {
      font-size: var(--spectrum-font-size-200);
      font-weight: 600;
      color: var(--spectrum-text-secondary);
    }
    
    .progress-track {
      height: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: var(--spectrum-radius-full);
      overflow: hidden;
    }
    
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--spectrum-purple-700) 0%, var(--spectrum-purple-400) 100%);
      border-radius: var(--spectrum-radius-full);
      transition: width var(--spectrum-transition-slow);
    }
    
    .progress-steps {
      display: flex;
      justify-content: space-between;
      margin-top: var(--spectrum-spacing-100);
    }
    
    .progress-step {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: var(--spectrum-font-size-75);
      color: var(--spectrum-text-disabled);
      transition: color var(--spectrum-transition-fast);
    }
    
    .progress-step .step-icon {
      opacity: 0.5;
      transition: opacity var(--spectrum-transition-fast), color var(--spectrum-transition-fast);
    }
    
    .progress-step.active {
      color: var(--spectrum-purple-400);
      font-weight: 600;
    }
    
    .progress-step.active .step-icon {
      opacity: 1;
      color: var(--spectrum-purple-400);
    }
    
    .progress-step.completed {
      color: var(--spectrum-green-400);
    }
    
    .progress-step.completed .step-icon {
      opacity: 1;
      color: var(--spectrum-green-400);
    }
    
    /* Hide labels on mobile, show only icons */
    @media (max-width: 600px) {
      .progress-step .step-label {
        display: none;
      }
      .progress-step .step-icon {
        width: 18px !important;
        height: 18px !important;
      }
    }
    
    /* ==========================================================================
       BADGES & TAGS
       ========================================================================== */
    .logo-badge {
      display: inline-block;
      background: linear-gradient(135deg, var(--spectrum-purple-700) 0%, var(--spectrum-purple-900) 100%);
      padding: var(--spectrum-spacing-100) var(--spectrum-spacing-200);
      border-radius: var(--spectrum-radius-full);
      font-size: var(--spectrum-font-size-75);
      font-weight: 600;
      letter-spacing: 0.05em;
      margin-bottom: var(--spectrum-spacing-300);
    }
    
    .tag {
      display: inline-flex;
      align-items: center;
      padding: var(--spectrum-spacing-50) var(--spectrum-spacing-100);
      background: rgba(255,255,255,0.1);
      color: var(--spectrum-text-secondary);
      border-radius: var(--spectrum-radius-md);
      font-size: var(--spectrum-font-size-100);
      font-weight: 500;
    }
    
    /* Glossary Terms with Tooltips (Pure CSS) - Keyboard Accessible */
    .glossary-term {
      color: var(--spectrum-purple-300);
      border-bottom: 1px dashed var(--spectrum-purple-400);
      cursor: help;
      position: relative;
      display: inline;
      /* Make focusable via keyboard */
      outline: none;
      border-radius: 2px;
    }
    
    .glossary-term:hover,
    .glossary-term:focus {
      color: var(--spectrum-purple-200);
      border-bottom-color: var(--spectrum-purple-300);
    }
    
    .glossary-term:focus-visible {
      outline: 2px solid var(--spectrum-purple-400);
      outline-offset: 2px;
    }
    
    .glossary-term::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: calc(100% + 12px);
      left: 50%;
      transform: translateX(-50%);
      visibility: hidden;
      opacity: 0;
      background: #1a1a2e;
      color: #f0f0f5;
      padding: 14px 18px;
      border-radius: 10px;
      font-size: 0.95rem;
      line-height: 1.6;
      width: max-content;
      max-width: 300px;
      border: 1px solid rgba(100, 54, 191, 0.4);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.05);
      z-index: 9999;
      pointer-events: none;
      transition: opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease;
      white-space: normal;
      text-align: left;
      font-weight: 400;
    }
    
    /* Tooltip arrow */
    .glossary-term::before {
      content: '';
      position: absolute;
      bottom: calc(100% + 4px);
      left: 50%;
      transform: translateX(-50%);
      border: 8px solid transparent;
      border-top-color: #1a1a2e;
      visibility: hidden;
      opacity: 0;
      z-index: 10000;
      transition: opacity 0.2s ease, visibility 0.2s ease;
    }
    
    .glossary-term:hover::after,
    .glossary-term:focus::after {
      visibility: visible;
      opacity: 1;
      transform: translateX(-50%) translateY(-4px);
    }
    
    .glossary-term:hover::before,
    .glossary-term:focus::before {
      visibility: visible;
      opacity: 1;
    }
    
    .tag-purple {
      background: rgba(100, 54, 191, 0.2);
      color: var(--spectrum-purple-300);
    }
    
    /* ==========================================================================
       ANIMATIONS
       ========================================================================== */
    .fade-in {
      animation: fadeIn var(--spectrum-transition-slow) ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .stagger-1 { animation-delay: 0ms; }
    .stagger-2 { animation-delay: 50ms; }
    .stagger-3 { animation-delay: 100ms; }
    .stagger-4 { animation-delay: 150ms; }
    
    @keyframes countUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .count-up {
      animation: countUp 0.5s ease-out forwards;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .pulse {
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .spin {
      animation: spin 1s linear infinite;
    }
    
    /* Skeleton loading */
    .skeleton {
      background: linear-gradient(90deg, 
        rgba(255,255,255,0.05) 25%, 
        rgba(255,255,255,0.1) 50%, 
        rgba(255,255,255,0.05) 75%
      );
      background-size: 200% 100%;
      animation: skeleton 1.5s ease-in-out infinite;
      border-radius: var(--spectrum-radius-md);
    }
    
    @keyframes skeleton {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    /* ==========================================================================
       UTILITY CLASSES
       ========================================================================== */
    .text-primary { color: var(--spectrum-text-primary); }
    .text-secondary { color: var(--spectrum-text-secondary); }
    .text-tertiary { color: var(--spectrum-text-tertiary); }
    .text-muted { color: var(--spectrum-text-disabled); }
    
    .text-purple { color: var(--spectrum-purple-400); }
    .text-green { color: var(--spectrum-green-400); }
    .text-blue { color: var(--spectrum-blue-400); }
    .text-amber { color: var(--spectrum-amber-400); }
    .text-red { color: var(--spectrum-red-400); }
    
    .font-semibold { font-weight: 600; }
    .font-bold { font-weight: 700; }
    
    .text-sm { font-size: var(--spectrum-font-size-200); }
    .text-base { font-size: var(--spectrum-font-size-300); }
    .text-lg { font-size: var(--spectrum-font-size-500); }
    .text-xl { font-size: var(--spectrum-font-size-700); }
    
    .mb-0 { margin-bottom: 0; }
    .mb-1 { margin-bottom: var(--spectrum-spacing-100); }
    .mb-2 { margin-bottom: var(--spectrum-spacing-200); }
    .mb-3 { margin-bottom: var(--spectrum-spacing-300); }
    .mb-4 { margin-bottom: var(--spectrum-spacing-400); }
    
    .mt-2 { margin-top: var(--spectrum-spacing-200); }
    .mt-3 { margin-top: var(--spectrum-spacing-300); }
    
    .gap-1 { gap: var(--spectrum-spacing-100); }
    .gap-2 { gap: var(--spectrum-spacing-200); }
    .gap-3 { gap: var(--spectrum-spacing-300); }
    
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .flex-wrap { flex-wrap: wrap; }
    .flex-1 { flex: 1; }
    
    .grid { display: grid; }
    .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
    .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
    .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
    .col-span-full { grid-column: 1 / -1; }
    
    .text-center { text-align: center; }
    
    /* ==========================================================================
       QUESTION STYLES
       ========================================================================== */
    .question-helper {
      font-size: var(--spectrum-font-size-200);
      color: var(--spectrum-text-tertiary);
      margin-bottom: var(--spectrum-spacing-200);
      line-height: 1.5;
    }
    
    .question-instruction {
      font-size: var(--spectrum-font-size-75);
      color: var(--spectrum-text-disabled);
      margin-bottom: var(--spectrum-spacing-200);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-weight: 600;
    }
    
    .category-badge {
      display: inline-flex;
      align-items: center;
      padding: var(--spectrum-spacing-50) var(--spectrum-spacing-200);
      border-radius: var(--spectrum-radius-md);
      font-size: var(--spectrum-font-size-100);
      font-weight: 600;
    }
    
    /* ==========================================================================
       RESPONSIVE DESIGN
       ========================================================================== */
    @media (max-width: 768px) {
      :root {
        --spectrum-spacing-400: 24px;
        --spectrum-spacing-300: 20px;
      }
      
      .container {
        padding: var(--spectrum-spacing-200);
      }
      
      .card {
        padding: 24px 20px;
        margin-bottom: var(--spectrum-spacing-300);
      }
      
      h1 {
        font-size: 1.75rem !important;
      }
      
      h2 {
        font-size: var(--spectrum-font-size-600);
      }
      
      .form-row,
      .grid-cols-2,
      .grid-cols-3,
      .grid-cols-4 {
        grid-template-columns: 1fr;
      }
      
      /* Calibration page grids collapse */
      #calibration-container [style*="grid-template-columns: repeat(5"] {
        grid-template-columns: repeat(3, 1fr) !important;
      }
      
      #calibration-container [style*="grid-template-columns: repeat(4"] {
        grid-template-columns: repeat(2, 1fr) !important;
      }
      
      #calibration-container [style*="grid-template-columns: 1fr 1fr"] {
        grid-template-columns: 1fr !important;
      }
      
      /* Calibration action buttons stack */
      #calibration-container > .card > div:last-child {
        flex-direction: column !important;
        gap: 16px !important;
      }
      
      #calibration-container > .card > div:last-child > div:last-child {
        flex-direction: column !important;
        width: 100%;
      }
      
      #calibration-container .btn {
        width: 100%;
        justify-content: center;
      }
      
      /* Intro page two-column grids collapse */
      .card > div[style*="grid-template-columns: 1fr 1fr"] {
        display: flex !important;
        flex-direction: column !important;
        gap: 24px !important;
      }
      
      /* Compact deliverables row - stack on very small screens */
      .card > div[style*="display: flex"][style*="justify-content: center"] {
        gap: 16px !important;
      }
      
      /* Expandable options - hide hover hint on mobile */
      .expandable-option .expandable-header::after {
        display: none !important;
      }
      
      /* Methodology card stack */
      .card > div[style*="linear-gradient"] {
        flex-direction: column !important;
        text-align: center;
      }
      
      .card > div[style*="linear-gradient"] button {
        width: 100%;
      }
      
      .choice-card {
        padding: var(--spectrum-spacing-200);
      }
      
      .btn-lg {
        width: 100%;
      }
      
      .progress-steps {
        display: none;
      }
      
      /* Details/summary adjustments */
      details summary {
        padding: 12px !important;
        font-size: 0.95rem;
      }
      
      details summary span:last-of-type {
        display: none;
      }
    }
    
    @media (max-width: 480px) {
      h1 {
        font-size: 1.5rem !important;
      }
      
      .card {
        padding: 20px 16px;
        border-radius: var(--spectrum-radius-lg);
      }
      
      /* Stack compact deliverables vertically */
      .card > div[style*="display: flex"][style*="justify-content: center"] {
        flex-direction: column !important;
        align-items: center !important;
        gap: 12px !important;
      }
      
      /* Tool chips smaller */
      .tool-chip {
        padding: 6px 10px;
        font-size: 0.8rem;
      }
      
      /* Role cards stack */
      [role="radiogroup"][style*="display: flex"] {
        flex-direction: column !important;
      }
      
      /* Calibration page - system architecture 2 columns on very small screens */
      #calibration-container [style*="grid-template-columns: repeat(5"] {
        grid-template-columns: repeat(2, 1fr) !important;
      }
      
      /* Calibration page - tools single column */
      #calibration-container [style*="grid-template-columns: repeat(4"] {
        grid-template-columns: 1fr !important;
      }
    }
    
    /* ==========================================================================
       ACCESSIBILITY - Reduced Motion (WCAG 2.3.3)
       ========================================================================== */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
      
      .fade-in,
      .count-up,
      .pulse,
      .spin,
      .skeleton {
        animation: none !important;
        opacity: 1 !important;
        transform: none !important;
      }
      
      .progress-bar {
        transition: none !important;
      }
    }
    
    /* ==========================================================================
       ACCESSIBILITY - Skip Link
       ========================================================================== */
    .skip-link {
      position: absolute;
      top: -100px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--spectrum-purple-700);
      color: white;
      padding: var(--spectrum-spacing-100) var(--spectrum-spacing-200);
      border-radius: var(--spectrum-radius-md);
      font-weight: 600;
      text-decoration: none;
      z-index: 9999;
      transition: top var(--spectrum-transition-fast);
    }
    
    .skip-link:focus {
      top: var(--spectrum-spacing-100);
      outline: 2px solid white;
      outline-offset: 2px;
    }
    
    /* ==========================================================================
       ACCESSIBILITY - Screen Reader Only (Visually Hidden)
       ========================================================================== */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    /* ==========================================================================
       ACCESSIBILITY - Focus Indicators
       ========================================================================== */
    .choice-card:focus-within {
      outline: 2px solid var(--spectrum-purple-400);
      outline-offset: 2px;
    }
    
    .form-input:focus-visible {
      outline: none;
      border-color: var(--spectrum-purple-700);
      box-shadow: 0 0 0 3px rgba(100, 54, 191, 0.25);
    }
    
    /* Error states for form validation */
    .form-input[aria-invalid="true"] {
      border-color: var(--spectrum-red-500);
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
    }
    
    .form-error {
      color: var(--spectrum-red-400);
      font-size: var(--spectrum-font-size-100);
      margin-top: var(--spectrum-spacing-50);
      display: flex;
      align-items: center;
      gap: var(--spectrum-spacing-50);
    }
    
    /* Required field indicator */
    .form-label[data-required]::after {
      content: " *";
      color: var(--spectrum-red-400);
    }
    
    /* ==========================================================================
       ACCESSIBILITY - Live Region Announcements
       ========================================================================== */
    .a11y-live-region {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    /* ==========================================================================
       ACCESSIBILITY - High Contrast Mode (Windows/forced-colors)
       ========================================================================== */
    @media (forced-colors: active) {
      /* Ensure buttons have visible borders */
      .btn,
      .btn-primary,
      .btn-secondary,
      .btn-quiet,
      .option-card,
      .choice-card {
        border: 2px solid ButtonText !important;
        forced-color-adjust: none;
      }
      
      .btn-primary {
        background: Highlight !important;
        color: HighlightText !important;
      }
      
      .btn-primary:hover,
      .btn-primary:focus {
        background: ButtonText !important;
        color: ButtonFace !important;
      }
      
      /* Selected states */
      .option-card.selected,
      .choice-card.selected {
        border-color: Highlight !important;
        background: Mark !important;
        color: MarkText !important;
      }
      
      /* Progress bar visibility */
      .progress-track {
        border: 1px solid ButtonText !important;
      }
      
      .progress-bar {
        background: Highlight !important;
      }
      
      /* Cards have visible boundaries */
      .card,
      .content-box {
        border: 1px solid ButtonText !important;
      }
      
      /* Focus indicators */
      :focus,
      :focus-visible {
        outline: 3px solid Highlight !important;
        outline-offset: 2px !important;
      }
      
      /* Form controls */
      .form-input {
        border: 2px solid ButtonText !important;
        background: Field !important;
        color: FieldText !important;
      }
      
      .form-input:focus {
        border-color: Highlight !important;
      }
      
      /* Text colors */
      .text-tertiary,
      .text-muted,
      .form-helper {
        color: GrayText !important;
      }
      
      /* Links */
      a {
        color: LinkText !important;
      }
      
      /* SVG/icons - ensure visibility */
      svg path,
      svg circle {
        stroke: currentColor !important;
      }
    }
    
    /* High contrast preference (prefers-contrast) */
    @media (prefers-contrast: more) {
      :root {
        --spectrum-text-tertiary: rgba(255,255,255,0.9);
        --spectrum-text-disabled: rgba(255,255,255,0.75);
        --spectrum-border-default: rgba(255,255,255,0.5);
        --spectrum-border-hover: rgba(255,255,255,0.7);
      }
      
      .card {
        border-width: 2px;
      }
      
      .btn,
      .option-card,
      .choice-card {
        border-width: 2px;
      }
      
      .progress-track {
        border: 1px solid rgba(255,255,255,0.5);
      }
    }
    
    /* ==========================================================================
       ACCESSIBILITY - Enhanced Touch Targets (Mobile)
       Minimum 44x44px touch targets per WCAG 2.5.5
       ========================================================================== */
    @media (pointer: coarse) {
      /* All buttons minimum 48px height for touch */
      .btn,
      .btn-primary,
      .btn-secondary,
      .btn-quiet {
        min-height: 48px;
        min-width: 48px;
        padding: var(--spectrum-spacing-200) var(--spectrum-spacing-300);
      }
      
      .btn-lg {
        min-height: 56px;
        padding: var(--spectrum-spacing-200) var(--spectrum-spacing-400);
      }
      
      /* Option cards larger touch area */
      .option-card {
        min-height: 56px;
        padding: var(--spectrum-spacing-300);
      }
      
      /* Choice cards larger touch area */
      .choice-card {
        min-height: 64px;
        padding: var(--spectrum-spacing-300);
      }
      
      /* Form inputs larger */
      .form-input {
        min-height: 48px;
        padding: var(--spectrum-spacing-200);
        font-size: 16px; /* Prevent iOS zoom on focus */
      }
      
      /* Radio/checkbox larger */
      .choice-card input[type="radio"],
      .choice-card input[type="checkbox"] {
        width: 24px;
        height: 24px;
        margin-top: 0;
      }
      
      /* Increase spacing between touch targets */
      .flex.flex-col.gap-2 {
        gap: var(--spectrum-spacing-200);
      }
      
      .grid.gap-2 {
        gap: var(--spectrum-spacing-200);
      }
      
      /* Progress steps larger */
      .progress-step {
        padding: var(--spectrum-spacing-100) var(--spectrum-spacing-200);
        min-height: 44px;
        display: flex;
        align-items: center;
      }
      
      /* Links in content need adequate spacing */
      a:not(.btn):not(.skip-link) {
        display: inline-block;
        padding: var(--spectrum-spacing-50) 0;
        min-height: 44px;
        line-height: 1.5;
      }
      
      /* Tag buttons if clickable */
      .tag {
        min-height: 36px;
        padding: var(--spectrum-spacing-100) var(--spectrum-spacing-200);
      }
    }
    
    /* Additional mobile touch improvements */
    @media (max-width: 768px) and (pointer: coarse) {
      /* Stack buttons vertically with full width */
      .form-row {
        gap: var(--spectrum-spacing-300);
      }
      
      /* Larger heading tap targets */
      h1, h2, h3 {
        padding: var(--spectrum-spacing-50) 0;
      }
      
      /* Action buttons full width on mobile */
      nav[aria-label="Actions"] .btn,
      nav[aria-label="Actions"] a,
      nav[aria-label="Actions"] button {
        min-height: 52px;
      }
      
      /* More breathing room in cards */
      .card {
        padding: var(--spectrum-spacing-400);
      }
      
      /* Content boxes more tappable */
      .content-box {
        padding: var(--spectrum-spacing-300);
      }
    }
  </style>
</head>
<body>
  <!-- Skip Link for Keyboard Navigation -->
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <!-- Live Regions for Screen Reader Announcements -->
  <div id="a11y-announcer" class="a11y-live-region" aria-live="polite" aria-atomic="true"></div>
  <div id="a11y-alert" class="a11y-live-region" aria-live="assertive" aria-atomic="true"></div>
  
  <!-- Main Content -->
  <main id="app" class="container" role="main" aria-label="Product System Maturity Assessment">
    <h1 class="sr-only" id="main-content">Product System Maturity & AI Readiness Assessment</h1>
    
    <!-- Intro Section (shown before assessment starts) -->
    <article id="intro-container" role="region" aria-label="Introduction and setup">
      <!-- Hero Section -->
      <div class="card text-center fade-in" style="padding: 48px 32px;">
        <div class="logo-badge" style="margin-bottom: 24px;">KNAPSACK PSRI v<span id="psri-version">1.0</span></div>
        <h1 style="font-size: 2.25rem; line-height: 1.2; margin-bottom: 16px;">Discover Where You Stand on the Path to AI-Ready Product Delivery</h1>
        <p class="text-secondary" style="font-size: 1.125rem; max-width: 600px; margin: 0 auto 24px; line-height: 1.6;">
          Benchmark your product system against 50+ enterprises and get a clear path to AI-ready delivery.
        </p>
        
        <button onclick="startAssessment()" class="btn btn-primary btn-lg" style="padding: 16px 32px; font-size: 1.125rem;">
          <span>Start Assessment</span>
          <i data-lucide="arrow-right" style="width: 20px; height: 20px;" aria-hidden="true"></i>
        </button>
        <p class="text-tertiary text-sm" style="margin-top: 12px;">10 minutes · Personalized results · Score + roadmap included</p>
      </div>

      <!-- Maturity Preview & What's Different -->
      <div class="card fade-in stagger-2" style="padding: 28px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px;">
          <!-- Left: Maturity Journey -->
          <div>
            <h2 class="text-primary" style="font-size: 1.125rem; font-weight: 600; margin-bottom: 6px;">Where will you land?</h2>
            <p class="text-tertiary text-sm" style="margin: 0 0 8px 0;">Each archetype comes with specific challenges and a clear path forward. Our methodology identifies patterns from 50+ enterprises so your roadmap is actionable, not generic.</p>
            <a href="#" onclick="showMethodology(); return false;" class="text-purple text-sm" style="text-decoration: underline; display: inline-block; margin-bottom: 14px;">View methodology →</a>
            <div role="list" aria-label="Maturity stages" style="display: flex; flex-direction: column; gap: 6px;">
              <div role="listitem" style="display: flex; align-items: flex-start; gap: 12px; padding: 10px 14px; background: linear-gradient(90deg, rgba(239, 68, 68, 0.12) 0%, transparent 100%); border-radius: 8px; border-left: 3px solid #ef4444;">
                <div style="flex: 1;">
                  <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 2px;">
                    <span style="font-size: 0.95rem; font-weight: 700; color: #fff;">Builder</span>
                    <span class="text-tertiary text-xs">30% of orgs</span>
                  </div>
                  <p class="text-tertiary text-xs" style="margin: 0;">Establishing core components and governance basics</p>
                </div>
              </div>
              <div role="listitem" style="display: flex; align-items: flex-start; gap: 12px; padding: 10px 14px; background: linear-gradient(90deg, rgba(251, 191, 36, 0.12) 0%, transparent 100%); border-radius: 8px; border-left: 3px solid #fbbf24;">
                <div style="flex: 1;">
                  <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 2px;">
                    <span style="font-size: 0.95rem; font-weight: 700; color: #fff;">Adopter</span>
                    <span class="text-tertiary text-xs">35% of orgs</span>
                  </div>
                  <p class="text-tertiary text-xs" style="margin: 0;">Design system in use, but gaps in adoption or AI readiness</p>
                </div>
              </div>
              <div role="listitem" style="display: flex; align-items: flex-start; gap: 12px; padding: 10px 14px; background: linear-gradient(90deg, rgba(59, 130, 246, 0.12) 0%, transparent 100%); border-radius: 8px; border-left: 3px solid #3b82f6;">
                <div style="flex: 1;">
                  <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 2px;">
                    <span style="font-size: 0.95rem; font-weight: 700; color: #fff;">Optimizer</span>
                    <span class="text-tertiary text-xs">25% of orgs</span>
                  </div>
                  <p class="text-tertiary text-xs" style="margin: 0;">Scaling adoption with metrics, automation emerging</p>
                </div>
              </div>
              <div role="listitem" style="display: flex; align-items: flex-start; gap: 12px; padding: 10px 14px; background: linear-gradient(90deg, rgba(16, 185, 129, 0.12) 0%, transparent 100%); border-radius: 8px; border-left: 3px solid #10b981;">
                <div style="flex: 1;">
                  <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 2px;">
                    <span style="font-size: 0.95rem; font-weight: 700; color: #fff;">Transformer</span>
                    <span class="text-tertiary text-xs">10% of orgs</span>
                  </div>
                  <p class="text-tertiary text-xs" style="margin: 0;">AI-powered delivery with full governance and velocity</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Right: What You'll Discover -->
          <div>
            <h2 class="text-primary" style="font-size: 1.125rem; font-weight: 600; margin-bottom: 16px;">What you'll discover</h2>
            <div style="display: flex; flex-direction: column; gap: 12px;">
              <div style="display: flex; align-items: flex-start; gap: 10px;">
                <i data-lucide="target" style="width: 18px; height: 18px; color: var(--spectrum-purple-400); flex-shrink: 0; margin-top: 2px;" aria-hidden="true"></i>
                <div>
                  <p class="text-secondary text-sm font-semibold" style="margin-bottom: 2px;">Maturity Archetype</p>
                  <p class="text-tertiary text-sm" style="margin: 0;">Where you stand on the AI-readiness journey</p>
                </div>
              </div>
              <div style="display: flex; align-items: flex-start; gap: 10px;">
                <i data-lucide="bar-chart-3" style="width: 18px; height: 18px; color: var(--spectrum-blue-400); flex-shrink: 0; margin-top: 2px;" aria-hidden="true"></i>
                <div>
                  <p class="text-secondary text-sm font-semibold" style="margin-bottom: 2px;">Industry Benchmark</p>
                  <p class="text-tertiary text-sm" style="margin: 0;">Compare to 50+ enterprises in your sector</p>
                </div>
              </div>
              <div style="display: flex; align-items: flex-start; gap: 10px;">
                <i data-lucide="shield-check" style="width: 18px; height: 18px; color: var(--spectrum-green-400); flex-shrink: 0; margin-top: 2px;" aria-hidden="true"></i>
                <div>
                  <p class="text-secondary text-sm font-semibold" style="margin-bottom: 2px;">AI Governance Score</p>
                  <p class="text-tertiary text-sm" style="margin: 0;">Not just tools—can you adopt AI safely?</p>
                </div>
              </div>
              <div style="display: flex; align-items: flex-start; gap: 10px;">
                <i data-lucide="map" style="width: 18px; height: 18px; color: var(--spectrum-amber-400); flex-shrink: 0; margin-top: 2px;" aria-hidden="true"></i>
                <div>
                  <p class="text-secondary text-sm font-semibold" style="margin-bottom: 2px;">Priority Roadmap</p>
                  <p class="text-tertiary text-sm" style="margin: 0;">Personalized actions, not a generic checklist</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
      </div>

    </article>
    
    <!-- Calibration Page (Step 2 - shown after clicking Start Assessment) -->
    <article id="calibration-container" style="display: none;" role="region" aria-label="Personalize your assessment">
      <div class="card fade-in" style="padding: 32px;">
        <!-- Header with Step Indicator -->
        <div style="margin-bottom: 32px; padding-bottom: 20px; border-bottom: 1px solid var(--spectrum-border-subtle);">
          <p class="text-xs text-purple" style="text-transform: uppercase; letter-spacing: 0.1em; margin: 0 0 4px 0; font-weight: 600;">Step 1 of 2</p>
          <h2 class="text-primary" style="font-size: 1.5rem; font-weight: 600; margin: 0;">Personalize Your Assessment</h2>
        </div>
        
        <!-- Why This Matters -->
        <div style="background: linear-gradient(135deg, rgba(100, 54, 191, 0.08) 0%, rgba(59, 130, 246, 0.08) 100%); border-radius: 12px; padding: 16px 20px; margin-bottom: 28px; display: flex; align-items: center; gap: 12px;">
          <i data-lucide="sparkles" style="width: 24px; height: 24px; color: var(--spectrum-purple-400); flex-shrink: 0;" aria-hidden="true"></i>
          <p class="text-secondary text-sm" style="margin: 0;">Better context means <strong>more accurate benchmarks</strong> and <strong>personalized recommendations</strong> tailored to your industry and role.</p>
        </div>
        
        <!-- Required Section -->
        <div style="margin-bottom: 32px;">
          <p class="text-xs text-tertiary" style="text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 16px; font-weight: 600;">Required</p>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px;">
            <div class="form-group" style="margin-bottom: 0;">
              <label class="form-label" for="industry-pref" data-required style="font-size: 0.95rem;">Industry</label>
              <select class="form-input" id="industry-pref" name="industryPref" required aria-required="true" onchange="updateIndustryIndicator()" style="padding: 14px 16px; font-size: 1rem;">
                <option value="" disabled selected>Select your industry</option>
                <option value="Financial Services">Financial Services</option>
                <option value="Insurance">Insurance</option>
                <option value="Healthcare">Healthcare</option>
                <option value="Enterprise Software">Enterprise Software</option>
                <option value="Technology / Media">Technology / Media</option>
                <option value="Retail / E-commerce">Retail / E-commerce</option>
                <option value="Telecommunications / Media">Telecommunications</option>
                <option value="Travel / Hospitality">Travel / Hospitality</option>
                <option value="Government / Public Sector">Government</option>
                <option value="Regulated / Industrial">Industrial</option>
                <option value="Aerospace / Space">Aerospace</option>
                <option value="Education (Nonprofit)">Education</option>
                <option value="Utilities (Electric)">Utilities</option>
                <option value="Other / Unknown">Other</option>
              </select>
              <p class="form-helper">For industry-specific benchmarks</p>
            </div>
            <div class="form-group" style="margin-bottom: 0;">
              <label class="form-label" for="org-domain" data-required style="font-size: 0.95rem;">Organization Domain</label>
              <input class="form-input" id="org-domain" name="orgDomain" type="text" placeholder="acme.com" required aria-required="true" style="padding: 14px 16px; font-size: 1rem;">
              <p class="form-helper">To track progress over time</p>
            </div>
          </div>
          
          <!-- Role Selection -->
          <div>
            <label class="form-label" style="font-size: 0.95rem; margin-bottom: 12px;">Your Role</label>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;" role="radiogroup" aria-label="Select your role">
              <label class="choice-card selected" id="role-executive" style="padding: 20px; cursor: pointer;">
                <input type="radio" name="roleType" value="executive" checked onchange="setRole('executive')">
                <div style="display: flex; align-items: center; gap: 16px; flex: 1;">
                  <div style="width: 48px; height: 48px; background: rgba(100, 54, 191, 0.12); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                    <i data-lucide="briefcase" style="width: 24px; height: 24px; color: var(--spectrum-purple-400);" aria-hidden="true"></i>
                  </div>
                  <div>
                    <p class="font-semibold text-primary" style="margin: 0 0 4px 0; font-size: 1rem;">Executive / Leader</p>
                    <p class="text-tertiary text-sm" style="margin: 0;">Strategy, governance & ROI focus</p>
                  </div>
                </div>
              </label>
              <label class="choice-card" id="role-practitioner" style="padding: 20px; cursor: pointer;">
                <input type="radio" name="roleType" value="practitioner" onchange="setRole('practitioner')">
                <div style="display: flex; align-items: center; gap: 16px; flex: 1;">
                  <div style="width: 48px; height: 48px; background: rgba(59, 130, 246, 0.12); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                    <i data-lucide="code" style="width: 24px; height: 24px; color: var(--spectrum-blue-400);" aria-hidden="true"></i>
                  </div>
                  <div>
                    <p class="font-semibold text-primary" style="margin: 0 0 4px 0; font-size: 1rem;">Practitioner / Builder</p>
                    <p class="text-tertiary text-sm" style="margin: 0;">Tools, workflows & technical depth</p>
                  </div>
                </div>
              </label>
            </div>
          </div>
        </div>
        
        <!-- Optional Section -->
        <div style="margin-bottom: 32px;">
          <p class="text-xs text-tertiary" style="text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 16px; font-weight: 600;">Optional — Enhances your results</p>
          
          <!-- System Landscape -->
          <div style="margin-bottom: 20px;">
            <label class="form-label" style="font-size: 0.95rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
              <i data-lucide="layers" style="width: 18px; height: 18px; color: var(--spectrum-purple-400);" aria-hidden="true"></i>
              Design System Architecture
            </label>
            <div role="radiogroup" aria-label="Select your system landscape" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px;">
              <label class="choice-card selected" id="landscape-single" style="padding: 16px; text-align: center; flex-direction: column;">
                <input type="radio" name="systemLandscape" value="single" checked onchange="setSystemLandscape('single')" style="position: absolute; opacity: 0;">
                <i data-lucide="box" style="width: 24px; height: 24px; color: var(--spectrum-purple-400); margin-bottom: 8px;" aria-hidden="true"></i>
                <p class="font-semibold text-primary text-sm" style="margin: 0 0 4px 0;">Single</p>
                <p class="text-tertiary text-xs" style="margin: 0;">One unified system</p>
              </label>
              <label class="choice-card" id="landscape-federated" style="padding: 16px; text-align: center; flex-direction: column;">
                <input type="radio" name="systemLandscape" value="federated" onchange="setSystemLandscape('federated')" style="position: absolute; opacity: 0;">
                <i data-lucide="git-branch" style="width: 24px; height: 24px; color: var(--spectrum-blue-400); margin-bottom: 8px;" aria-hidden="true"></i>
                <p class="font-semibold text-primary text-sm" style="margin: 0 0 4px 0;">Federated</p>
                <p class="text-tertiary text-xs" style="margin: 0;">Core + extensions</p>
              </label>
              <label class="choice-card" id="landscape-multiple" style="padding: 16px; text-align: center; flex-direction: column;">
                <input type="radio" name="systemLandscape" value="multiple" onchange="setSystemLandscape('multiple')" style="position: absolute; opacity: 0;">
                <i data-lucide="boxes" style="width: 24px; height: 24px; color: var(--spectrum-amber-400); margin-bottom: 8px;" aria-hidden="true"></i>
                <p class="font-semibold text-primary text-sm" style="margin: 0 0 4px 0;">Multiple</p>
                <p class="text-tertiary text-xs" style="margin: 0;">Independent systems</p>
              </label>
              <label class="choice-card" id="landscape-systemOfSystems" style="padding: 16px; text-align: center; flex-direction: column;">
                <input type="radio" name="systemLandscape" value="systemOfSystems" onchange="setSystemLandscape('systemOfSystems')" style="position: absolute; opacity: 0;">
                <i data-lucide="network" style="width: 24px; height: 24px; color: var(--spectrum-green-400); margin-bottom: 8px;" aria-hidden="true"></i>
                <p class="font-semibold text-primary text-sm" style="margin: 0 0 4px 0;">System of Systems</p>
                <p class="text-tertiary text-xs" style="margin: 0;">Multi-tier governance</p>
              </label>
              <label class="choice-card" id="landscape-fragmented" style="padding: 16px; text-align: center; flex-direction: column;">
                <input type="radio" name="systemLandscape" value="fragmented" onchange="setSystemLandscape('fragmented')" style="position: absolute; opacity: 0;">
                <i data-lucide="puzzle" style="width: 24px; height: 24px; color: var(--spectrum-red-400); margin-bottom: 8px;" aria-hidden="true"></i>
                <p class="font-semibold text-primary text-sm" style="margin: 0 0 4px 0;">Fragmented</p>
                <p class="text-tertiary text-xs" style="margin: 0;">Minimal coordination</p>
              </label>
            </div>
            <div id="multi-system-indicator" style="display: none; margin-top: 12px; padding: 10px 14px; background: rgba(59, 130, 246, 0.1); border-radius: 6px; border: 1px solid rgba(59, 130, 246, 0.2);">
              <p class="text-sm text-blue flex items-center gap-2 mb-0">
                <i data-lucide="plus-circle" style="width: 14px; height: 14px;" aria-hidden="true"></i>
                <span>Additional multi-system questions will be included</span>
              </p>
            </div>
          </div>
          
          <!-- Tool Stack -->
          <div>
            <label class="form-label" style="font-size: 0.95rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
              <i data-lucide="wrench" style="width: 18px; height: 18px; color: var(--spectrum-amber-400);" aria-hidden="true"></i>
              Current Tool Stack
              <span class="text-tertiary text-sm" style="font-weight: 400;">(select all that apply)</span>
            </label>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
              <div>
                <p class="text-xs text-tertiary" style="text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 10px; font-weight: 600;">Design</p>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                  <button type="button" class="tool-chip" data-tool="figma" onclick="toggleTool('figma')" aria-pressed="false" style="justify-content: flex-start; width: 100%;">Figma</button>
                  <button type="button" class="tool-chip" data-tool="sketch" onclick="toggleTool('sketch')" aria-pressed="false" style="justify-content: flex-start; width: 100%;">Sketch</button>
                  <button type="button" class="tool-chip" data-tool="tokensStudio" onclick="toggleTool('tokensStudio')" aria-pressed="false" style="justify-content: flex-start; width: 100%;">Tokens Studio</button>
                </div>
              </div>
              <div>
                <p class="text-xs text-tertiary" style="text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 10px; font-weight: 600;">Development</p>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                  <button type="button" class="tool-chip" data-tool="storybook" onclick="toggleTool('storybook')" aria-pressed="false" style="justify-content: flex-start; width: 100%;">Storybook</button>
                  <button type="button" class="tool-chip" data-tool="styleDictionary" onclick="toggleTool('styleDictionary')" aria-pressed="false" style="justify-content: flex-start; width: 100%;">Style Dictionary</button>
                  <button type="button" class="tool-chip" data-tool="custom" onclick="toggleTool('custom')" aria-pressed="false" style="justify-content: flex-start; width: 100%;">Custom-built</button>
                </div>
              </div>
              <div>
                <p class="text-xs text-tertiary" style="text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 10px; font-weight: 600;">Platforms</p>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                  <button type="button" class="tool-chip" data-tool="zeroheight" onclick="toggleTool('zeroheight')" aria-pressed="false" style="justify-content: flex-start; width: 100%;">Zeroheight</button>
                  <button type="button" class="tool-chip" data-tool="supernova" onclick="toggleTool('supernova')" aria-pressed="false" style="justify-content: flex-start; width: 100%;">Supernova</button>
                  <button type="button" class="tool-chip" data-tool="knapsack" onclick="toggleTool('knapsack')" aria-pressed="false" style="justify-content: flex-start; width: 100%; border-color: rgba(100, 54, 191, 0.4);">Knapsack</button>
                  <button type="button" class="tool-chip" data-tool="confluence" onclick="toggleTool('confluence')" aria-pressed="false" style="justify-content: flex-start; width: 100%;">Confluence</button>
                </div>
              </div>
              <div>
                <p class="text-xs text-tertiary" style="text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 10px; font-weight: 600;">Other</p>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                  <button type="button" class="tool-chip" data-tool="manual" onclick="toggleTool('manual')" aria-pressed="false" style="justify-content: flex-start; width: 100%;">Spreadsheets</button>
                  <button type="button" class="tool-chip" data-tool="none" onclick="toggleTool('none')" aria-pressed="false" style="justify-content: flex-start; width: 100%;">No unified tooling</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Hidden Assessment Type Status -->
        <div id="baseline-lookup-status" style="display: none;" class="content-box" style="background: rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.3); margin-bottom: 16px;">
          <p class="text-sm text-blue flex items-center gap-2 mb-0">
            <span class="spin" style="display: inline-block; width: 14px; height: 14px; border: 2px solid var(--spectrum-blue-400); border-top-color: transparent; border-radius: 50%;"></span>
            Looking up previous assessment...
          </p>
        </div>
        
        <!-- Action Buttons -->
        <div style="display: flex; align-items: center; justify-content: space-between; padding-top: 24px; border-top: 1px solid var(--spectrum-border-subtle);">
          <button onclick="goBackToIntro()" class="btn btn-secondary" style="padding: 12px 24px;">
            <i data-lucide="arrow-left" style="width: 18px; height: 18px;" aria-hidden="true"></i>
            <span>Back</span>
          </button>
          <div style="display: flex; align-items: center; gap: 16px;">
            <p class="text-tertiary text-sm" style="margin: 0;">
              <i data-lucide="clock" style="width: 14px; height: 14px; display: inline; vertical-align: middle; margin-right: 4px;" aria-hidden="true"></i>
              ~10 minutes
            </p>
            <button onclick="beginAssessmentQuestions()" class="btn btn-primary btn-lg" style="padding: 14px 28px; font-size: 1rem;">
              <span>Begin Assessment</span>
              <i data-lucide="arrow-right" style="width: 20px; height: 20px;" aria-hidden="true"></i>
            </button>
          </div>
        </div>
      </div>
    </article>

    <!-- Assessment Form -->
    <div id="assessment-container" style="display: none;">
      <!-- Progress Indicator -->
      <div class="card fade-in" style="padding: var(--spectrum-spacing-300);" role="region" aria-label="Assessment Progress">
        <div class="progress-container">
          <div class="progress-header">
            <span class="progress-label" id="progress-category">Getting Started</span>
            <span class="progress-value" id="progress-text" aria-hidden="true">0%</span>
          </div>
          <div class="progress-track" 
               role="progressbar" 
               aria-valuenow="0" 
               aria-valuemin="0" 
               aria-valuemax="100" 
               aria-label="Assessment completion"
               id="progress-track">
            <div id="progress-bar" class="progress-bar" style="width: 0%;"></div>
          </div>
          <nav class="progress-steps" id="progress-steps" aria-label="Assessment categories">
            <span class="progress-step active" data-category="foundation" aria-current="step">
              <i data-lucide="layers" class="step-icon" style="width: 14px; height: 14px;" aria-hidden="true"></i>
              <span class="step-label">Foundation</span>
            </span>
            <span class="progress-step" data-category="ai">
              <i data-lucide="cpu" class="step-icon" style="width: 14px; height: 14px;" aria-hidden="true"></i>
              <span class="step-label">AI</span>
            </span>
            <span class="progress-step" data-category="governance">
              <i data-lucide="shield-check" class="step-icon" style="width: 14px; height: 14px;" aria-hidden="true"></i>
              <span class="step-label">Governance</span>
            </span>
            <span class="progress-step" data-category="delivery">
              <i data-lucide="git-merge" class="step-icon" style="width: 14px; height: 14px;" aria-hidden="true"></i>
              <span class="step-label">Delivery</span>
            </span>
            <span class="progress-step" data-category="culture">
              <i data-lucide="heart-handshake" class="step-icon" style="width: 14px; height: 14px;" aria-hidden="true"></i>
              <span class="step-label">Culture</span>
            </span>
            <span class="progress-step" data-category="multisystem" id="multisystem-step" style="display: none;">
              <i data-lucide="network" class="step-icon" style="width: 14px; height: 14px;" aria-hidden="true"></i>
              <span class="step-label">Multi-System</span>
            </span>
          </nav>
        </div>
      </div>

      <!-- Current Question -->
      <div id="question-container"></div>
    </div>

    <!-- Results -->
    <div id="results-container" style="display: none;">
      <!-- Lead Capture -->
      <section id="lead-form-container" class="card" style="background: rgba(255,255,255,0.03);" aria-labelledby="lead-form-heading">
        <h2 id="lead-form-heading" style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px; font-size: var(--spectrum-font-size-500); font-weight: 600; color: var(--spectrum-text-primary);">
          <i data-lucide="mail" style="width: 20px; height: 20px; color: #a78bfa;" aria-hidden="true"></i>
          Get Your Results
        </h2>
        <p style="font-size: 0.875rem; color: rgba(255,255,255,0.7); margin-bottom: 16px;">
          Share a few details and we'll reveal your full readiness score and recommendations.
        </p>
        <div id="results-preview" class="content-box" style="margin-bottom: 16px; border-color: rgba(100, 54, 191, 0.35);"></div>
        <form id="lead-form" onsubmit="submitLeadForm(event)" aria-label="Contact information form">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="lead-firstName" data-required>First Name</label>
              <input class="form-input" id="lead-firstName" name="firstName" type="text" autocomplete="given-name" required aria-required="true">
            </div>
            <div class="form-group">
              <label class="form-label" for="lead-lastName" data-required>Last Name</label>
              <input class="form-input" id="lead-lastName" name="lastName" type="text" autocomplete="family-name" required aria-required="true">
            </div>
          </div>
          <div class="form-row" style="margin-top: 16px;">
            <div class="form-group">
              <label class="form-label" for="lead-workEmail" data-required>Work Email</label>
              <input class="form-input" id="lead-workEmail" name="workEmail" type="email" autocomplete="email" required aria-required="true">
            </div>
            <div class="form-group">
              <label class="form-label" for="lead-company" data-required>Company</label>
              <input class="form-input" id="lead-company" name="company" type="text" autocomplete="organization" required aria-required="true">
            </div>
          </div>
          <div class="form-row" style="margin-top: 16px;">
            <div class="form-group">
              <label class="form-label" for="lead-companySize">Company Size (optional)</label>
              <select class="form-input" id="lead-companySize" name="companySize">
                <option value="" disabled selected>Select size</option>
                <option value="1-100">1–100</option>
                <option value="101-500">101–500</option>
                <option value="501-2000">501–2,000</option>
                <option value="2001-10000">2,001–10,000</option>
                <option value="10000+">10,000+</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label" for="lead-regulatoryEnv">Regulatory Environment (optional)</label>
              <select class="form-input" id="lead-regulatoryEnv" name="regulatoryEnv">
                <option value="" disabled selected>Select environment</option>
                <option value="Standard">Standard</option>
                <option value="Regulated">Regulated</option>
                <option value="Highly regulated">Highly regulated</option>
              </select>
            </div>
          </div>
          <div class="form-row" style="margin-top: 16px;">
            <div class="form-group">
              <label class="form-label" for="lead-role">Role (optional)</label>
              <input class="form-input" id="lead-role" name="role" type="text" autocomplete="organization-title">
            </div>
          </div>
          <div class="form-group" style="margin-top: 16px;">
            <label class="form-label" for="lead-context">Additional Context (optional)</label>
            <textarea class="form-input" id="lead-context" name="context" rows="4" placeholder="Share any context that could help interpret your results." aria-describedby="context-helper privacy-helper"></textarea>
          </div>
          <p class="form-helper" id="context-helper">We'll only use this to personalize your assessment results.</p>
          <p class="form-helper" id="privacy-helper">Privacy: your details are used only for this assessment and follow-up you request.</p>
          <button type="submit" class="btn btn-primary" style="margin-top: 16px; width: 100%;">
            Reveal My Results
          </button>
        </form>
      </div>

      <div id="results-content" style="display: none;">
      
      <!-- Executive Summary (TL;DR for leadership) -->
      <div id="executive-summary" class="card" style="background: linear-gradient(135deg, rgba(100, 54, 191, 0.12) 0%, rgba(59, 130, 246, 0.12) 100%); border: 2px solid rgba(100, 54, 191, 0.3); position: relative;">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
          <div style="display: flex; align-items: center; gap: 10px;">
            <div style="width: 40px; height: 40px; background: rgba(100, 54, 191, 0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
              <i data-lucide="clipboard-list" style="width: 20px; height: 20px; color: var(--spectrum-purple-400);" aria-hidden="true"></i>
            </div>
            <div>
              <h2 style="font-size: var(--spectrum-font-size-500); font-weight: 700; color: #fff; margin: 0;">Executive Summary</h2>
              <p style="font-size: var(--spectrum-font-size-100); color: rgba(255,255,255,0.6); margin: 0;">Share this with your leadership team</p>
            </div>
          </div>
          <button onclick="toggleExecutiveSummary()" id="exec-summary-toggle" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 6px 12px; color: rgba(255,255,255,0.7); cursor: pointer; font-size: 0.85rem; display: flex; align-items: center; gap: 6px;">
            <i data-lucide="chevron-up" style="width: 16px; height: 16px;" aria-hidden="true"></i>
            <span>Collapse</span>
          </button>
        </div>
        
        <div id="exec-summary-content">
          <!-- Summary Grid -->
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 20px;">
            <div style="background: rgba(255,255,255,0.08); border-radius: 12px; padding: 16px; text-align: center;">
              <p style="font-size: 0.75rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">Your Score</p>
              <p id="exec-score" style="font-size: 2.5rem; font-weight: 800; color: #fff; margin: 0;">—</p>
              <p style="font-size: 0.85rem; color: rgba(255,255,255,0.6);">out of 100</p>
            </div>
            <div style="background: rgba(255,255,255,0.08); border-radius: 12px; padding: 16px; text-align: center;">
              <p style="font-size: 0.75rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">Your Archetype</p>
              <p id="exec-archetype" style="font-size: 1.5rem; font-weight: 700; color: #fff; margin: 0;">—</p>
              <p id="exec-percentile" style="font-size: 0.85rem; color: rgba(255,255,255,0.6);">— of enterprises</p>
            </div>
            <div style="background: rgba(255,255,255,0.08); border-radius: 12px; padding: 16px; text-align: center;">
              <p style="font-size: 0.75rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">Industry Rank</p>
              <p id="exec-rank" style="font-size: 1.5rem; font-weight: 700; color: #fff; margin: 0;">—</p>
              <p id="exec-industry" style="font-size: 0.85rem; color: rgba(255,255,255,0.6);">—</p>
            </div>
          </div>
          
          <!-- Key Insights Row -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div style="background: rgba(16, 185, 129, 0.15); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 16px;">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <i data-lucide="check-circle" style="width: 18px; height: 18px; color: #6ee7b7;" aria-hidden="true"></i>
                <p style="font-size: 0.85rem; font-weight: 600; color: #6ee7b7; margin: 0;">KEY STRENGTH</p>
              </div>
              <p id="exec-strength" style="font-size: 1rem; color: #fff; margin: 0;">—</p>
            </div>
            <div style="background: rgba(251, 146, 60, 0.15); border: 1px solid rgba(251, 146, 60, 0.3); border-radius: 12px; padding: 16px;">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <i data-lucide="alert-triangle" style="width: 18px; height: 18px; color: #fb923c;" aria-hidden="true"></i>
                <p style="font-size: 0.85rem; font-weight: 600; color: #fb923c; margin: 0;">KEY GAP</p>
              </div>
              <p id="exec-gap" style="font-size: 1rem; color: #fff; margin: 0;">—</p>
            </div>
          </div>
          
          <!-- Bottom Line -->
          <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 16px; border: 1px dashed rgba(255,255,255,0.2);">
            <p style="font-size: 0.75rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">THE BOTTOM LINE</p>
            <p id="exec-bottomline" style="font-size: 1.1rem; color: #fff; line-height: 1.6; margin: 0;">—</p>
          </div>
        </div>
      </div>

      <!-- Maturity Journey Timeline -->
      <div id="maturity-journey" class="card">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
          <i data-lucide="route" style="width: 20px; height: 20px; color: var(--spectrum-purple-400);" aria-hidden="true"></i>
          <h2 style="font-size: var(--spectrum-font-size-400); font-weight: 600; color: #fff; margin: 0;">Your Maturity Journey</h2>
        </div>
        
        <!-- Journey Timeline -->
        <div style="position: relative; padding: 20px 0;">
          <!-- Progress Line Background -->
          <div style="position: absolute; top: 50%; left: 0; right: 0; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; transform: translateY(-50%);"></div>
          <!-- Progress Line Filled -->
          <div id="journey-progress-line" style="position: absolute; top: 50%; left: 0; height: 4px; background: linear-gradient(90deg, #ef4444 0%, #fbbf24 33%, #3b82f6 66%, #10b981 100%); border-radius: 2px; transform: translateY(-50%); width: 0%; transition: width 1s ease-out;"></div>
          
          <!-- Journey Stages -->
          <div style="display: flex; justify-content: space-between; position: relative; z-index: 1;">
            <!-- Builder -->
            <div id="journey-stage-builder" class="journey-stage" style="text-align: center; flex: 1;">
              <div style="width: 48px; height: 48px; border-radius: 50%; background: rgba(239, 68, 68, 0.2); border: 3px solid rgba(239, 68, 68, 0.5); display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; transition: all 0.3s;">
                <i data-lucide="hammer" style="width: 20px; height: 20px; color: #ef4444;" aria-hidden="true"></i>
              </div>
              <p style="font-size: 0.9rem; font-weight: 700; color: rgba(255,255,255,0.8); margin-bottom: 4px;">Builder</p>
              <p style="font-size: 0.75rem; color: rgba(255,255,255,0.5);">0-39</p>
            </div>
            
            <!-- Adopter -->
            <div id="journey-stage-adopter" class="journey-stage" style="text-align: center; flex: 1;">
              <div style="width: 48px; height: 48px; border-radius: 50%; background: rgba(251, 191, 36, 0.2); border: 3px solid rgba(251, 191, 36, 0.5); display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; transition: all 0.3s;">
                <i data-lucide="sprout" style="width: 20px; height: 20px; color: #fbbf24;" aria-hidden="true"></i>
              </div>
              <p style="font-size: 0.9rem; font-weight: 700; color: rgba(255,255,255,0.8); margin-bottom: 4px;">Adopter</p>
              <p style="font-size: 0.75rem; color: rgba(255,255,255,0.5);">40-59</p>
            </div>
            
            <!-- Optimizer -->
            <div id="journey-stage-optimizer" class="journey-stage" style="text-align: center; flex: 1;">
              <div style="width: 48px; height: 48px; border-radius: 50%; background: rgba(59, 130, 246, 0.2); border: 3px solid rgba(59, 130, 246, 0.5); display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; transition: all 0.3s;">
                <i data-lucide="sliders" style="width: 20px; height: 20px; color: #3b82f6;" aria-hidden="true"></i>
              </div>
              <p style="font-size: 0.9rem; font-weight: 700; color: rgba(255,255,255,0.8); margin-bottom: 4px;">Optimizer</p>
              <p style="font-size: 0.75rem; color: rgba(255,255,255,0.5);">60-79</p>
            </div>
            
            <!-- Transformer -->
            <div id="journey-stage-transformer" class="journey-stage" style="text-align: center; flex: 1;">
              <div style="width: 48px; height: 48px; border-radius: 50%; background: rgba(16, 185, 129, 0.2); border: 3px solid rgba(16, 185, 129, 0.5); display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; transition: all 0.3s;">
                <i data-lucide="rocket" style="width: 20px; height: 20px; color: #10b981;" aria-hidden="true"></i>
              </div>
              <p style="font-size: 0.9rem; font-weight: 700; color: rgba(255,255,255,0.8); margin-bottom: 4px;">Transformer</p>
              <p style="font-size: 0.75rem; color: rgba(255,255,255,0.5);">80-100</p>
            </div>
          </div>
        </div>
        
        <!-- Current Position Callout -->
        <div id="journey-callout" style="background: rgba(100, 54, 191, 0.15); border: 1px solid rgba(100, 54, 191, 0.3); border-radius: 12px; padding: 16px; margin-top: 16px; display: flex; align-items: center; gap: 16px;">
          <div style="width: 48px; height: 48px; background: rgba(100, 54, 191, 0.3); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
            <i data-lucide="map-pin" style="width: 24px; height: 24px; color: var(--spectrum-purple-400);"></i>
          </div>
          <div>
            <p style="font-size: 0.85rem; color: rgba(255,255,255,0.6); margin-bottom: 4px;">You are here</p>
            <p id="journey-position-text" style="font-size: 1.1rem; font-weight: 600; color: #fff; margin: 0;">—</p>
          </div>
        </div>
      </div>

      <!-- Priority Actions -->
      <div id="priority-actions" class="card">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
          <i data-lucide="target" style="width: 20px; height: 20px; color: var(--spectrum-purple-400);"></i>
          <div>
            <h2 style="font-size: var(--spectrum-font-size-400); font-weight: 600; color: #fff; margin: 0;">Priority Actions</h2>
            <p style="font-size: var(--spectrum-font-size-100); color: rgba(255,255,255,0.6); margin: 0;">Your top 3 areas to focus on based on your assessment</p>
          </div>
        </div>
        
        <div id="priority-actions-grid" style="display: grid; gap: 16px;">
          <!-- Actions will be dynamically inserted here -->
        </div>
      </div>

      <!-- Multi-System Maturity Map (shown for multi-system organizations) -->
      <div id="multi-system-map" class="card" style="display: none;">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
          <i data-lucide="network" style="width: 20px; height: 20px; color: #0ea5e9;"></i>
          <div>
            <h2 style="font-size: var(--spectrum-font-size-400); font-weight: 600; color: #fff; margin: 0;">Multi-System Architecture Assessment</h2>
            <p style="font-size: var(--spectrum-font-size-100); color: rgba(255,255,255,0.6); margin: 0;">How well your systems work together</p>
          </div>
        </div>
        <div id="multi-system-map-content">
          <!-- Content dynamically inserted here -->
        </div>
      </div>

      <!-- Tool Stack Insights (shown when tools are selected) -->
      <div id="tool-stack-insights" class="card" style="display: none;">
        <div id="tool-stack-header" style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
          <i id="tool-stack-icon" data-lucide="wrench" style="width: 20px; height: 20px; color: var(--spectrum-amber-400);"></i>
          <div>
            <h2 id="tool-stack-title" style="font-size: var(--spectrum-font-size-400); font-weight: 600; color: #fff; margin: 0;">Tool Stack Assessment</h2>
            <p id="tool-stack-subtitle" style="font-size: var(--spectrum-font-size-100); color: rgba(255,255,255,0.6); margin: 0;">Insights based on your current setup</p>
          </div>
        </div>
        <div id="tool-stack-insights-content">
          <!-- Content dynamically inserted here -->
        </div>
      </div>

      <!-- Progress Report (shown for follow-up assessments) -->
      <div id="progress-report" class="card" style="display: none; background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(59, 130, 246, 0.15) 100%); border: 2px solid rgba(16, 185, 129, 0.3);"></div>

      <!-- Benchmark Comparison -->
      <div id="benchmark-comparison" class="card"></div>

      <!-- Overall Score -->
      <div class="card" style="background: linear-gradient(135deg, #6436bf 0%, #42247f 100%); padding: 32px;">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px;">
          <div>
            <p style="color: rgba(255,255,255,0.8); font-size: 0.75rem; font-weight: 500; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 1px;">PRODUCT SYSTEM READINESS INDEX (PSRI)</p>
            <div style="display: flex; align-items: baseline; gap: 16px; flex-wrap: wrap;">
              <h2 style="font-size: 3rem; font-weight: 700; color: #fff; margin: 0;" id="psri-display">0</h2>
              <span style="font-size: 1.25rem; color: rgba(255,255,255,0.6);">/100</span>
              <span id="benchmark-label" style="font-size: 0.85rem; font-weight: 700; color: #e0d4f7; text-transform: uppercase; letter-spacing: 1px; background: rgba(255,255,255,0.15); padding: 4px 12px; border-radius: 999px;">Benchmark —</span>
            </div>
            <div style="margin-top: 16px; display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
              <div style="background: rgba(255,255,255,0.15); border-radius: 999px; padding: 6px 14px;">
                <span style="font-size: 0.85rem; letter-spacing: 1px; text-transform: uppercase; color: rgba(255,255,255,0.7);">Tier:</span>
                <span id="readiness-tier" style="font-size: 0.8rem; font-weight: 700; color: #fff; margin-left: 4px;">Foundation</span>
              </div>
              <div style="background: rgba(255,255,255,0.15); border-radius: 999px; padding: 6px 14px;">
                <span style="font-size: 0.85rem; letter-spacing: 1px; text-transform: uppercase; color: rgba(255,255,255,0.7);">AI Readiness:</span>
                <span id="ai-readiness-status" style="font-size: 0.8rem; font-weight: 700; color: #fff; margin-left: 4px;">—</span>
              </div>
              <div id="org-id-badge" style="background: rgba(255,255,255,0.1); border-radius: 999px; padding: 6px 14px; display: none;">
                <span style="font-size: 0.85rem; letter-spacing: 1px; text-transform: uppercase; color: rgba(255,255,255,0.5);">Org:</span>
                <span id="org-id-display" style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-left: 4px;">—</span>
              </div>
            </div>
            <p id="tier-outcome" style="color: rgba(255,255,255,0.85); font-size: 0.875rem; margin-top: 12px;">—</p>
            <p style="color: rgba(255,255,255,0.6); font-size: 0.8rem; margin-top: 6px;">PSRI = (Foundation × 20%) + (AI × 20%) + (Governance × 20%) + (Delivery × 15%) + (Culture × 25%)</p>
            <!-- Hidden legacy score for backward compat -->
            <span id="overall-score" style="display: none;">0</span>
          </div>
          <div style="width: 120px; height: 120px; border-radius: 50%; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; position: relative;" role="img" aria-label="Score visualization">
            <svg viewBox="0 0 36 36" style="width: 120px; height: 120px; transform: rotate(-90deg);" aria-hidden="true">
              <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="2.5"/>
              <path id="psri-ring" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#fff" stroke-width="2.5" stroke-dasharray="0, 100"/>
            </svg>
            <div style="position: absolute; text-align: center;" aria-hidden="true">
              <i data-lucide="gauge" style="width: 28px; height: 28px; color: #fff;" aria-hidden="true"></i>
            </div>
          </div>
        </div>
        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-top: 24px;">
          <div style="background: rgba(255,255,255,0.1); border-radius: 12px; padding: 12px;">
            <p style="font-size: 0.8rem; color: rgba(255,255,255,0.6); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px;">Foundation</p>
            <div style="display: flex; align-items: baseline; gap: 4px;">
              <p style="font-size: 1.25rem; font-weight: 700; color: #fff;" id="foundation-score">0</p>
              <p style="font-size: 0.8rem; color: rgba(255,255,255,0.5);">pts</p>
            </div>
            <div style="height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin-top: 8px; overflow: hidden;">
              <div id="foundation-bar" style="height: 100%; background: #6ee7b7; width: 0%; transition: width 0.5s;"></div>
            </div>
            <p id="foundation-norm" style="font-size: 0.75rem; color: rgba(255,255,255,0.5); margin-top: 4px;">20%</p>
          </div>
          <div style="background: rgba(255,255,255,0.1); border-radius: 12px; padding: 12px;">
            <p style="font-size: 0.8rem; color: rgba(255,255,255,0.6); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px;">AI Readiness</p>
            <div style="display: flex; align-items: baseline; gap: 4px;">
              <p style="font-size: 1.25rem; font-weight: 700; color: #fff;" id="ai-score">0</p>
              <p style="font-size: 0.8rem; color: rgba(255,255,255,0.5);">pts</p>
            </div>
            <div style="height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin-top: 8px; overflow: hidden;">
              <div id="ai-bar" style="height: 100%; background: #c4b5fd; width: 0%; transition: width 0.5s;"></div>
            </div>
            <p id="ai-norm" style="font-size: 0.75rem; color: rgba(255,255,255,0.5); margin-top: 4px;">20%</p>
          </div>
          <div style="background: rgba(255,255,255,0.1); border-radius: 12px; padding: 12px;">
            <p style="font-size: 0.8rem; color: rgba(255,255,255,0.6); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px;">Governance</p>
            <div style="display: flex; align-items: baseline; gap: 4px;">
              <p style="font-size: 1.25rem; font-weight: 700; color: #fff;" id="org-score">0</p>
              <p style="font-size: 0.8rem; color: rgba(255,255,255,0.5);">pts</p>
            </div>
            <div style="height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin-top: 8px; overflow: hidden;">
              <div id="org-bar" style="height: 100%; background: #93c5fd; width: 0%; transition: width 0.5s;"></div>
            </div>
            <p id="org-norm" style="font-size: 0.75rem; color: rgba(255,255,255,0.5); margin-top: 4px;">20%</p>
          </div>
          <div style="background: rgba(255,255,255,0.1); border-radius: 12px; padding: 12px;">
            <p style="font-size: 0.8rem; color: rgba(255,255,255,0.6); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px;">Delivery</p>
            <div style="display: flex; align-items: baseline; gap: 4px;">
              <p style="font-size: 1.25rem; font-weight: 700; color: #fff;" id="delivery-score">0</p>
              <p style="font-size: 0.8rem; color: rgba(255,255,255,0.5);">pts</p>
            </div>
            <div style="height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin-top: 8px; overflow: hidden;">
              <div id="delivery-bar" style="height: 100%; background: #fde047; width: 0%; transition: width 0.5s;"></div>
            </div>
            <p id="delivery-norm" style="font-size: 0.75rem; color: rgba(255,255,255,0.5); margin-top: 4px;">15%</p>
          </div>
          <div style="background: rgba(255,255,255,0.1); border-radius: 12px; padding: 12px; border: 1px solid rgba(251, 146, 60, 0.3);">
            <p style="font-size: 0.8rem; color: #fb923c; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px;">Culture</p>
            <div style="display: flex; align-items: baseline; gap: 4px;">
              <p style="font-size: 1.25rem; font-weight: 700; color: #fff;" id="culture-score">0</p>
              <p style="font-size: 0.8rem; color: rgba(255,255,255,0.5);">pts</p>
            </div>
            <div style="height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin-top: 8px; overflow: hidden;">
              <div id="culture-bar" style="height: 100%; background: #fb923c; width: 0%; transition: width 0.5s;"></div>
            </div>
            <p id="culture-norm" style="font-size: 0.75rem; color: rgba(255,255,255,0.5); margin-top: 4px;">25%</p>
          </div>
        </div>
      </div>

      <!-- Connect with Knapsack CTA -->
      <section class="card" style="background: linear-gradient(135deg, #6436bf 0%, #3b82f6 100%); padding: 32px;" aria-labelledby="cta-heading">
        <div style="display: flex; flex-direction: column; gap: 24px;">
          <div style="flex: 1;">
            <h2 id="cta-heading" style="font-size: 1.5rem; font-weight: 700; color: #fff; margin-bottom: 8px;">Ready to take the next step?</h2>
            <p style="color: rgba(255,255,255,0.85); margin-bottom: 16px;">Schedule a personalized consultation with our product system experts to discuss your assessment results and explore how governed delivery can accelerate your product delivery.</p>
            <ul style="display: flex; flex-wrap: wrap; gap: 12px; font-size: 0.875rem; list-style: none; padding: 0; margin: 0;">
              <li style="display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.2); border-radius: 8px; padding: 8px 12px;">
                <i data-lucide="calendar" style="width: 16px; height: 16px;" aria-hidden="true"></i>
                <span>30-minute consultation</span>
              </li>
              <li style="display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.2); border-radius: 8px; padding: 8px 12px;">
                <i data-lucide="file-text" style="width: 16px; height: 16px;" aria-hidden="true"></i>
                <span>Detailed roadmap</span>
              </li>
              <li style="display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.2); border-radius: 8px; padding: 8px 12px;">
                <i data-lucide="users" style="width: 16px; height: 16px;" aria-hidden="true"></i>
                <span>Expert guidance</span>
              </li>
            </ul>
          </div>
          <nav style="display: flex; flex-direction: column; gap: 12px;" aria-label="Actions">
            <a href="mailto:ipe@knapsack.cloud?subject=Product System Maturity Assessment Results - Consultation Request" onclick="trackEvent('cta_schedule_consult')" style="background: #fff; color: #6436bf; padding: 12px 24px; border-radius: 8px; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; text-align: center;">
              <i data-lucide="mail" style="width: 20px; height: 20px;" aria-hidden="true"></i>
              <span>Schedule Consultation</span>
            </a>
            <button onclick="generatePDFReport()" style="background: rgba(255,255,255,0.2); color: #fff; padding: 12px 24px; border-radius: 8px; font-weight: 500; border: 1px solid rgba(255,255,255,0.3); cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;">
              <i data-lucide="file-text" style="width: 20px; height: 20px;" aria-hidden="true"></i>
              <span>Download PDF Report</span>
            </button>
            <button onclick="downloadResults()" style="background: rgba(255,255,255,0.12); color: #fff; padding: 12px 24px; border-radius: 8px; font-weight: 500; border: 1px solid rgba(255,255,255,0.2); cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;">
              <i data-lucide="download" style="width: 20px; height: 20px;" aria-hidden="true"></i>
              <span>Download JSON</span>
            </button>
            <button onclick="emailResults()" style="background: rgba(255,255,255,0.12); color: #fff; padding: 12px 24px; border-radius: 8px; font-weight: 500; border: 1px solid rgba(255,255,255,0.25); cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;">
              <i data-lucide="mail" style="width: 20px; height: 20px;" aria-hidden="true"></i>
              <span>Email Me a Copy</span>
            </button>
            <button onclick="copyResultsSummary()" style="background: rgba(255,255,255,0.08); color: #fff; padding: 12px 24px; border-radius: 8px; font-weight: 500; border: 1px solid rgba(255,255,255,0.2); cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;">
              <i data-lucide="copy" style="width: 20px; height: 20px;" aria-hidden="true"></i>
              <span>Copy Summary</span>
            </button>
          </nav>
        </div>
      </section>

      <!-- Restart Button -->
      <button onclick="resetAssessment()" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 24px; background: rgba(255,255,255,0.1); color: #fff; border-radius: 8px; font-weight: 500; border: 1px solid rgba(100, 54, 191, 0.3); cursor: pointer; transition: all 0.2s; margin-bottom: 24px;">
        <i data-lucide="refresh-cw" style="width: 20px; height: 20px;" aria-hidden="true"></i>
        Start New Assessment
      </button>
      </div>
    </div>
  </main>

  <script>
    // =========================================================================
    // PSRI CONFIGURATION - Version 1.0
    // =========================================================================
    
    const PSRI_VERSION = '1.2';
    const PSRI_VERSION_DATE = '2026-02-05';
    // v1.2: Added Multi-System Architecture assessment for federated/multi-brand organizations
    // v1.1: Expanded research foundation (DORA, Project Aristotle, Team Topologies, Westrum, NIST AI RMF)
    
    // Google Sheets Web App URL - Replace with your deployed Apps Script URL
    const GOOGLE_SHEETS_WEBAPP_URL = 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL';
    
    // PSRI Pillar Weights (must sum to 1.0)
    // Rationale:
    // - AI Readiness (30%): Primary market differentiator, highest predictive value for engagement success
    // - Foundation (25%): Table stakes for any product system work
    // - Governance (25%): Execution enabler, often the bottleneck for adoption
    // - Delivery (20%): Sustainability factor, indicates org capacity
    const PSRI_WEIGHTS = {
      foundation: 0.20,
      ai: 0.20,
      governance: 0.20,
      delivery: 0.15,
      culture: 0.25
    };
    
    // ==========================================================================
    // ICON SYSTEM - Consistent iconography across the assessment
    // ==========================================================================
    
    // Pillar Icons - Use these EVERYWHERE a pillar is referenced
    const PILLAR_ICONS = {
      foundation: { icon: 'layers', color: '#a78bfa', label: 'Foundation' },
      ai: { icon: 'cpu', color: '#60a5fa', label: 'AI Readiness' },
      governance: { icon: 'shield-check', color: '#34d399', label: 'Governance' },
      delivery: { icon: 'git-merge', color: '#fbbf24', label: 'Delivery' },
      culture: { icon: 'heart-handshake', color: '#f472b6', label: 'Culture' },
      multiSystem: { icon: 'network', color: '#0ea5e9', label: 'Multi-System' }
    };
    
    // Archetype Icons - ONLY for maturity journey stages
    const ARCHETYPE_ICONS = {
      builder: { icon: 'hammer', color: '#ef4444', label: 'Builder' },
      adopter: { icon: 'sprout', color: '#fbbf24', label: 'Adopter' },
      optimizer: { icon: 'sliders', color: '#3b82f6', label: 'Optimizer' },
      transformer: { icon: 'rocket', color: '#10b981', label: 'Transformer' }
    };
    
    // Status Icons - For feedback states
    const STATUS_ICONS = {
      success: { icon: 'check-circle', color: '#10b981' },
      warning: { icon: 'alert-triangle', color: '#f59e0b' },
      error: { icon: 'x-circle', color: '#ef4444' },
      info: { icon: 'info', color: '#6b7280' },
      strength: { icon: 'trending-up', color: '#10b981' },
      gap: { icon: 'alert-circle', color: '#f97316' }
    };
    
    // Helper function to generate icon HTML
    function pillarIcon(pillarKey, size = 16) {
      const pillar = PILLAR_ICONS[pillarKey];
      if (!pillar) return '';
      return `<i data-lucide="${pillar.icon}" style="width: ${size}px; height: ${size}px; color: ${pillar.color};" aria-hidden="true"></i>`;
    }
    
    function archetypeIcon(archetypeKey, size = 20) {
      const archetype = ARCHETYPE_ICONS[archetypeKey];
      if (!archetype) return '';
      return `<i data-lucide="${archetype.icon}" style="width: ${size}px; height: ${size}px; color: ${archetype.color};" aria-hidden="true"></i>`;
    }
    
    function statusIcon(statusKey, size = 16) {
      const status = STATUS_ICONS[statusKey];
      if (!status) return '';
      return `<i data-lucide="${status.icon}" style="width: ${size}px; height: ${size}px; color: ${status.color};" aria-hidden="true"></i>`;
    }
    
    // Gated Progression Thresholds
    // AI Readiness score is discounted if Foundation is below threshold
    const GATED_PROGRESSION = {
      enabled: true,
      foundationThreshold: 40,  // Foundation must be ≥40% for full AI credit
      aiDiscountFactor: 0.5,    // AI score multiplied by this if Foundation below threshold
      governanceThreshold: 30,  // Governance must be ≥30% for full Delivery credit
      deliveryDiscountFactor: 0.7
    };
    
    // Role-based assessment configuration
    // Questions tagged with roles will only show for those roles
    // 'all' = show for everyone, 'executive' = exec only, 'practitioner' = practitioner only
    const ROLE_CONFIG = {
      executive: {
        name: 'Executive / Leader',
        description: 'VP, Director, or strategic decision-maker',
        icon: 'briefcase',
        focus: 'Strategy, governance, and ROI'
      },
      practitioner: {
        name: 'Practitioner / Builder',
        description: 'Designer, engineer, or hands-on contributor',
        icon: 'code',
        focus: 'Tools, workflows, and technical depth'
      }
    };
    
    // Question weights for impact-based scoring (1.0 = standard, 1.5 = high impact, 2.0 = critical)
    // Updated to reflect new questions from Team Topologies, DORA, Project Aristotle, and Westrum research
    const questionWeights = {
      // Product System Foundation (4 questions: 0-3)
      0: 1.5,   // Design system state - high impact
      1: 2.0,   // Governance structure - critical
      2: 1.0,   // Documentation quality - standard
      3: 1.5,   // Accessibility approach - high impact (a11y is increasingly critical)
      
      // AI Readiness (4 questions: 4-7)
      4: 1.5,   // AI tool usage - high impact
      5: 2.0,   // API maturity - critical for AI readiness
      6: 1.5,   // Product data quality - high impact
      7: 1.5,   // AI governance - high impact
      
      // Governance & Adoption (5 questions: 8-12)
      8: 2.0,   // Executive sponsor - critical for success
      9: 1.5,   // Budget commitment - high impact
      10: 1.0,  // Change capacity - standard
      11: 1.0,  // Update communication - standard
      12: 1.5,  // ROI measurement - high impact
      
      // Delivery Workflow (7 questions: 13-19)
      13: 1.0,  // Decision clarity - standard
      14: 1.0,  // Experiment pace - standard
      15: 1.5,  // Cross-functional collaboration - high impact
      16: 1.0,  // Tool chain maturity - standard
      17: 1.0,  // Workflow consistency - standard
      18: 1.5,  // Platform team model (Team Topologies) - high impact
      19: 1.5,  // Deployment frequency (DORA) - high impact
      
      // Culture & Contribution (7 questions: 20-26)
      20: 1.5,  // Contribution model - high impact
      21: 1.0,  // Contributor diversity - standard
      22: 1.5,  // Community health - high impact
      23: 1.5,  // Shared ownership - high impact
      24: 1.0,  // Time allocation - standard
      25: 2.0,  // Psychological safety (Project Aristotle) - critical
      26: 1.5,  // Information flow (Westrum) - high impact
      
      // Multi-System Architecture (6 questions: 27-32) - scored separately
      27: 1.5,  // Token architecture - high impact for multi-system
      28: 1.5,  // Component abstraction - high impact
      29: 2.0,  // Cross-system governance - critical for multi-system success
      30: 1.5,  // Cross-system AI context - high impact
      31: 1.5,  // Cross-system contribution - high impact
      32: 1.0,  // Release coordination - standard
      
      // Deployment (1 question: 33)
      33: 0     // Deployment requirements (no weight - informational only)
    };
    
    // =========================================================================
    // STATE
    // =========================================================================
    
    let currentQuestionIndex = 0;
    let answers = {};
    let deploymentTier = 'D1';
    let recommendedPath = 'J1';
    let pendingResults = null;
    let selectedIndustry = 'Cross-industry';
    let organizationId = '';
    let assessmentType = 'baseline'; // 'baseline' or 'follow-up'
    let baselineData = null; // Stores previous assessment for comparison
    let psriScore = 0; // Product System Readiness Index
    let selectedRole = 'executive'; // 'executive' or 'practitioner'
    let filteredQuestions = []; // Questions filtered by role
    let selectedSystemLandscape = 'single'; // System landscape type
    let systemOfSystemsScore = 0; // Score for multi-system maturity
    let selectedTools = []; // Current tool stack
    
    // Tool Stack Configuration for competitive positioning
    const TOOL_CONFIG = {
      figma: { name: 'Figma', category: 'design', icon: 'pen-tool' },
      sketch: { name: 'Sketch', category: 'design', icon: 'pen-tool' },
      adobexd: { name: 'Adobe XD', category: 'design', icon: 'pen-tool' },
      storybook: { name: 'Storybook', category: 'docs', icon: 'book' },
      zeroheight: { name: 'Zeroheight', category: 'platform', icon: 'layout' },
      supernova: { name: 'Supernova', category: 'platform', icon: 'layout' },
      knapsack: { name: 'Knapsack', category: 'platform', icon: 'package' },
      styleDictionary: { name: 'Style Dictionary', category: 'tokens', icon: 'palette' },
      tokensStudio: { name: 'Tokens Studio', category: 'tokens', icon: 'palette' },
      confluence: { name: 'Confluence / Notion', category: 'wiki', icon: 'file-text' },
      custom: { name: 'Custom-built tools', category: 'custom', icon: 'code' },
      manual: { name: 'Spreadsheets / Manual', category: 'manual', icon: 'table' },
      none: { name: 'No unified tooling', category: 'none', icon: 'help-circle' }
    };
    
    // Tool gap analysis for Knapsack positioning
    const TOOL_GAP_ANALYSIS = {
      // Gap patterns based on tool combinations
      designOnly: {
        pattern: ['figma', 'sketch', 'adobexd'],
        excludes: ['storybook', 'zeroheight', 'supernova', 'knapsack'],
        gap: 'Design-Code Disconnect',
        description: 'Your design assets live separately from code implementation, creating sync issues and inconsistencies.',
        insights: [
          'Design changes require manual handoff to engineering',
          'No single source of truth for component specs',
          'Token updates don\'t automatically propagate'
        ],
        positioning: 'Bridge design to production with a unified platform that keeps Figma and code in sync automatically.'
      },
      storybookOnly: {
        pattern: ['storybook'],
        excludes: ['zeroheight', 'supernova', 'knapsack'],
        gap: 'Documentation Silo',
        description: 'Storybook documents components but lacks governance, design sync, and cross-team workflows.',
        insights: [
          'Designers can\'t contribute directly to documentation',
          'No built-in approval or contribution workflows',
          'Limited support for design tokens and theming'
        ],
        positioning: 'Layer governance and design integration on top of your existing Storybook investment.'
      },
      competitorPlatform: {
        pattern: ['zeroheight', 'supernova'],
        excludes: ['knapsack'],
        gap: 'Limited AI Readiness',
        description: 'Current platform may lack the API architecture and metadata structure needed for AI-powered workflows.',
        insights: [
          'AI tools can\'t access component context programmatically',
          'Limited support for MCP and AI agent integration',
          'Governance may not extend to AI-generated code'
        ],
        positioning: 'Upgrade to an AI-native platform with MCP support and intelligent automation built-in.'
      },
      customBuilt: {
        pattern: ['custom'],
        gap: 'Maintenance Burden',
        description: 'Custom tools require ongoing investment to maintain, often diverting resources from core product work.',
        insights: [
          'Engineering time spent on tooling instead of products',
          'Feature parity with commercial tools is difficult',
          'Onboarding new team members takes longer'
        ],
        positioning: 'Replace custom tooling with a platform that evolves with industry standards—so you can focus on your product.'
      },
      manualProcesses: {
        pattern: ['manual', 'none'],
        gap: 'Scale Bottleneck',
        description: 'Manual processes don\'t scale. As your system grows, governance becomes increasingly difficult.',
        insights: [
          'Token and component changes are error-prone',
          'No audit trail for design decisions',
          'Difficult to enforce consistency across teams'
        ],
        positioning: 'Start with the right foundation—a platform built for scale, governance, and AI readiness from day one.'
      },
      fragmented: {
        pattern: [],
        minTools: 4,
        gap: 'Tool Fragmentation',
        description: 'Multiple point solutions create integration overhead and no single source of truth.',
        insights: [
          'Information scattered across multiple tools',
          'Manual effort to keep tools in sync',
          'Difficult to get a unified view of system health'
        ],
        positioning: 'Consolidate your tool stack into a unified platform that connects design, code, and governance.'
      },
      // Special case for existing Knapsack users
      knapsackUser: {
        isKnapsackUser: true,
        status: 'Unified Platform Active',
        description: 'You\'re already using a unified product system platform. This assessment helps identify optimization opportunities.',
        strengths: [
          'Single source of truth for design and code',
          'Built-in governance and contribution workflows',
          'AI-ready API architecture with MCP support'
        ],
        optimizations: {
          foundation: 'Maximize token coverage and component documentation',
          ai: 'Enable MCP integrations and AI-assisted workflows',
          governance: 'Expand contribution programs and approval workflows',
          delivery: 'Automate release pipelines and sync processes',
          culture: 'Grow community engagement and cross-team adoption'
        }
      }
    };
    
    // System Landscape Configuration
    const SYSTEM_LANDSCAPE_CONFIG = {
      single: {
        name: 'Single Unified System',
        description: 'One design system serves all products and brands',
        icon: 'box',
        showMultiSystemQuestions: false
      },
      federated: {
        name: 'Federated Systems',
        description: 'Shared core with brand/product extensions',
        icon: 'git-branch',
        showMultiSystemQuestions: true
      },
      multiple: {
        name: 'Multiple Independent Systems',
        description: 'Separate systems for different use cases or brands',
        icon: 'boxes',
        showMultiSystemQuestions: true
      },
      systemOfSystems: {
        name: 'System of Systems',
        description: 'Orchestrated multi-tier architecture with governance layer',
        icon: 'network',
        showMultiSystemQuestions: true
      },
      fragmented: {
        name: 'Fragmented/Organic',
        description: 'Systems evolved independently with no coordination',
        icon: 'puzzle',
        showMultiSystemQuestions: true
      }
    };
    
    // Assessment Questions with role tags
    // roles: 'all' = show for everyone, 'executive' = exec only, 'practitioner' = practitioner only
    const questions = [
      // Product System Foundation (20 points total - rebalanced)
      {
        category: 'Product System Foundation',
        weight: 20,
        roles: ['all'],
        question: 'What is the current state of your design system?',
        options: [
          { text: 'No design system exists', score: 0, value: 'none' },
          { text: 'Informal or scattered components', score: 4, value: 'informal' },
          { text: 'Design system exists but limited adoption', score: 6, value: 'limited' },
          { text: 'Design system deployed, moderate adoption (30-70%)', score: 8, value: 'moderate' },
          { text: 'Mature design system with high adoption (>70%)', score: 10, value: 'mature' }
        ]
      },
      {
        category: 'Product System Foundation',
        weight: 20,
        roles: ['all'],
        question: 'How is your design system governed?',
        options: [
          { text: 'No governance structure', score: 0, value: 'none' },
          { text: 'Informal or ad-hoc governance', score: 3, value: 'informal' },
          { text: 'Governance exists but not enforced', score: 5, value: 'exists' },
          { text: 'Active governance with decision authority', score: 8, value: 'active' },
          { text: 'Cross-system governance with clear rules', score: 10, value: 'cross-system' }
        ]
      },
      {
        category: 'Product System Foundation',
        weight: 20,
        roles: ['practitioner'],
        question: 'What is the quality of your design system documentation?',
        helper: 'Examples: basic = usage + visual rules; comprehensive = usage + interaction + accessibility + code references.',
        options: [
          { text: 'No documentation', score: 0, value: 'none' },
          { text: 'Minimal or outdated documentation', score: 2, value: 'minimal' },
          { text: 'Basic documentation exists', score: 4, value: 'basic' },
          { text: 'Comprehensive, up-to-date documentation', score: 7, value: 'comprehensive' },
          { text: 'Living documentation integrated with code', score: 10, value: 'living' }
        ]
      },
      {
        category: 'Product System Foundation',
        weight: 20,
        roles: ['all'],
        question: 'How does your design system approach accessibility?',
        helper: 'Consider WCAG compliance, automated testing, and inclusive design practices.',
        options: [
          { text: 'Accessibility is not a priority', score: 0, value: 'none' },
          { text: 'Some components have accessibility features', score: 3, value: 'some' },
          { text: 'Accessibility is documented but not enforced', score: 5, value: 'documented' },
          { text: 'Components are built accessible-by-default', score: 8, value: 'default' },
          { text: 'Accessibility tested continuously with a11y gates in CI', score: 10, value: 'continuous' }
        ]
      },
      
      // AI Readiness (20 points total)
      {
        category: 'AI Readiness',
        weight: 20,
        roles: ['all'],
        question: 'How are your teams currently using AI coding tools?',
        options: [
          { text: 'No AI tools in use', score: 0, value: 'none' },
          { text: 'Limited experimentation', score: 2, value: 'experimental' },
          { text: 'Some teams using AI tools', score: 4, value: 'some' },
          { text: 'Widespread AI tool adoption', score: 6, value: 'widespread' },
          { text: 'AI tools integrated into workflows', score: 8, value: 'integrated' }
        ]
      },
      {
        category: 'AI Readiness',
        weight: 20,
        roles: ['practitioner'],
        question: 'What is your API maturity and integration architecture?',
        helper: 'Think: documented endpoints, versioning, consistent patterns, reuse across teams.',
        options: [
          { text: 'No APIs or integration architecture', score: 0, value: 'none' },
          { text: 'Basic APIs exist', score: 2, value: 'basic' },
          { text: 'Well-defined APIs with documentation', score: 3, value: 'defined' },
          { text: 'Mature API architecture', score: 5, value: 'mature' },
          { text: 'API-first architecture built for AI workflows', score: 6, value: 'mcp-ready' }
        ]
      },
      {
        category: 'AI Readiness',
        weight: 20,
        roles: ['practitioner'],
        question: 'What is the quality of your product data and metadata?',
        helper: 'Includes tokens, components, states, accessibility metadata, and how consistently it is structured.',
        options: [
          { text: 'No structured data', score: 0, value: 'none' },
          { text: 'Fragmented or inconsistent data', score: 1, value: 'fragmented' },
          { text: 'Some structured data exists', score: 3, value: 'some' },
          { text: 'Well-structured, consistent data', score: 5, value: 'structured' },
          { text: 'Rich metadata with semantic relationships', score: 6, value: 'rich' }
        ]
      },
      {
        category: 'AI Readiness',
        weight: 20,
        roles: ['executive'],
        question: 'What is your organization\'s AI strategy for product development?',
        options: [
          { text: 'No AI strategy defined', score: 0, value: 'none' },
          { text: 'Exploring AI options', score: 2, value: 'exploring' },
          { text: 'Piloting AI in select areas', score: 4, value: 'piloting' },
          { text: 'AI integrated into product roadmap', score: 6, value: 'roadmap' },
          { text: 'AI-first product strategy with governance', score: 8, value: 'ai-first' }
        ]
      },
      
      // Governance & Adoption (20 points total - rebalanced)
      {
        category: 'Governance & Adoption',
        weight: 20,
        roles: ['all'],
        question: 'Is there a clear executive sponsor and decision owner?',
        options: [
          { text: 'No sponsor identified', score: 0, value: 'none' },
          { text: 'Influencer only (IC or Manager)', score: 3, value: 'influencer' },
          { text: 'Director-level champion', score: 6, value: 'director' },
          { text: 'VP-level executive sponsor', score: 8, value: 'vp' },
          { text: 'C-level executive sponsor', score: 10, value: 'c-level' }
        ]
      },
      {
        category: 'Governance & Adoption',
        weight: 20,
        roles: ['executive'],
        question: 'Is there committed investment for product system work?',
        options: [
          { text: 'No budget allocated', score: 0, value: 'none' },
          { text: 'Budget would need to be found', score: 3, value: 'find' },
          { text: 'Budget exists, needs approval', score: 6, value: 'approval' },
          { text: 'Budget allocated and approved', score: 8, value: 'allocated' },
          { text: 'Budget allocated with multi-year commitment', score: 10, value: 'multi-year' }
        ]
      },
      {
        category: 'Governance & Adoption',
        weight: 20,
        roles: ['executive'],
        question: 'What is your team capacity for change management?',
        helper: 'If you are unsure, choose "Not sure yet" and we can help assess.',
        options: [
          { text: 'No capacity for change', score: 0, value: 'none' },
          { text: 'Limited capacity', score: 2, value: 'limited' },
          { text: 'Moderate capacity', score: 5, value: 'moderate' },
          { text: 'Dedicated change management resources', score: 8, value: 'dedicated' },
          { text: 'Strong change management capability', score: 10, value: 'strong' },
          { text: 'Not sure yet', score: 0, value: 'unknown' }
        ]
      },
      {
        category: 'Governance & Adoption',
        weight: 20,
        roles: ['practitioner'],
        question: 'How are design system updates communicated and adopted?',
        options: [
          { text: 'No formal communication process', score: 0, value: 'none' },
          { text: 'Ad-hoc announcements', score: 3, value: 'adhoc' },
          { text: 'Regular release notes and documentation', score: 6, value: 'regular' },
          { text: 'Automated notifications with migration guides', score: 8, value: 'automated' },
          { text: 'Full adoption program with training and support', score: 10, value: 'full' }
        ]
      },
      {
        category: 'Governance & Adoption',
        weight: 20,
        roles: ['executive'],
        question: 'How do you measure the ROI of your design system?',
        helper: 'Consider both efficiency metrics and business outcomes.',
        options: [
          { text: 'We don\'t measure it', score: 0, value: 'none' },
          { text: 'Anecdotally (we think it saves time)', score: 2, value: 'anecdotal' },
          { text: 'Usage metrics (adoption rates, component usage)', score: 5, value: 'usage' },
          { text: 'Efficiency metrics (time saved, consistency scores)', score: 8, value: 'efficiency' },
          { text: 'Business outcomes (velocity, quality, NPS impact)', score: 10, value: 'outcomes' }
        ]
      },
      
      // Delivery Workflow (15 points total - rebalanced)
      {
        category: 'Delivery Workflow',
        weight: 15,
        roles: ['executive'],
        key: 'decisionClarity',
        question: 'How clear are product decision rights and ownership?',
        options: [
          { text: 'Unclear or shifting ownership', score: 0, value: 'low' },
          { text: 'Mostly clear, with some gaps', score: 2, value: 'medium' },
          { text: 'Very clear and consistent', score: 4, value: 'high' }
        ]
      },
      {
        category: 'Delivery Workflow',
        weight: 15,
        roles: ['practitioner'],
        key: 'experimentPace',
        question: 'How fast can you run experiments or validate ideas?',
        options: [
          { text: 'Slow (monthly or longer)', score: 0, value: 'low' },
          { text: 'Steady (every 2–4 weeks)', score: 2, value: 'medium' },
          { text: 'Fast (weekly or faster)', score: 4, value: 'high' }
        ]
      },
      {
        category: 'Delivery Workflow',
        weight: 15,
        roles: ['all'],
        key: 'collaboration',
        question: 'How well do product, design, and engineering collaborate?',
        options: [
          { text: 'Siloed with frequent handoff friction', score: 0, value: 'low' },
          { text: 'Aligned but inconsistent', score: 2, value: 'medium' },
          { text: 'Highly integrated and continuous', score: 4, value: 'high' }
        ]
      },
      {
        category: 'Delivery Workflow',
        weight: 15,
        roles: ['practitioner'],
        key: 'toolchain',
        question: 'How mature is your tool chain for design-to-code delivery?',
        options: [
          { text: 'Fragmented tools, limited automation', score: 0, value: 'low' },
          { text: 'Partially integrated with some automation', score: 2, value: 'medium' },
          { text: 'Integrated tool chain with strong automation', score: 4, value: 'high' }
        ]
      },
      {
        category: 'Delivery Workflow',
        weight: 15,
        roles: ['all'],
        key: 'workflow',
        question: 'How consistent is your delivery workflow from idea to release?',
        options: [
          { text: 'Inconsistent, varies by team', score: 0, value: 'low' },
          { text: 'Mostly consistent with exceptions', score: 2, value: 'medium' },
          { text: 'Consistent and repeatable across teams', score: 4, value: 'high' }
        ]
      },
      // NEW: Platform Team Model (Team Topologies)
      {
        category: 'Delivery Workflow',
        weight: 15,
        roles: ['executive'],
        key: 'platformTeam',
        question: 'Do you have a platform team that reduces cognitive load for product teams?',
        helper: 'Platform teams provide shared services, tooling, and infrastructure so product teams can focus on delivery.',
        options: [
          { text: 'No platform thinking—every team manages their own infrastructure', score: 0, value: 'none' },
          { text: 'Some shared services, but not formalized as a platform', score: 2, value: 'informal' },
          { text: 'Platform team exists but product teams often work around it', score: 3, value: 'emerging' },
          { text: 'Mature platform team with self-service capabilities', score: 4, value: 'mature' },
          { text: 'Platform-as-a-product with clear SLAs and adoption metrics', score: 5, value: 'product' }
        ]
      },
      // NEW: DORA Metrics Alignment
      {
        category: 'Delivery Workflow',
        weight: 15,
        roles: ['practitioner'],
        key: 'deploymentFrequency',
        question: 'How frequently do you deploy changes to production?',
        helper: 'DORA research shows deployment frequency is a key indicator of engineering excellence.',
        options: [
          { text: 'Monthly or less frequently', score: 0, value: 'monthly' },
          { text: 'Weekly', score: 2, value: 'weekly' },
          { text: 'Daily', score: 3, value: 'daily' },
          { text: 'Multiple times per day', score: 4, value: 'ondemand' },
          { text: 'On-demand with automated pipelines', score: 5, value: 'continuous' }
        ]
      },

      // Culture & Contribution (25 points total - NEW PILLAR)
      {
        category: 'Culture & Contribution',
        weight: 25,
        roles: ['all'],
        question: 'Who can contribute to your design system?',
        helper: 'Think about who actually adds components, updates documentation, or improves the system.',
        options: [
          { text: 'A single core team controls everything', score: 0, value: 'closed' },
          { text: 'Core team with occasional outside contributions', score: 3, value: 'limited' },
          { text: 'Open contribution with clear guidelines', score: 6, value: 'open' },
          { text: 'Federated model with distributed ownership', score: 8, value: 'federated' },
          { text: 'True community ownership with product team stewardship', score: 10, value: 'community' }
        ]
      },
      {
        category: 'Culture & Contribution',
        weight: 25,
        roles: ['all'],
        question: 'How diverse is your design system contributor base?',
        options: [
          { text: 'Single discipline (design only or engineering only)', score: 0, value: 'single' },
          { text: 'Primarily one discipline with some cross-over', score: 3, value: 'primary' },
          { text: 'Balanced design and engineering contributions', score: 6, value: 'balanced' },
          { text: 'Cross-functional including product management', score: 8, value: 'cross-func' },
          { text: 'Contributions from across the organization', score: 10, value: 'org-wide' }
        ]
      },
      {
        category: 'Culture & Contribution',
        weight: 25,
        roles: ['all'],
        question: 'Is there an active community around your design system?',
        options: [
          { text: 'No community or community of practice', score: 0, value: 'none' },
          { text: 'Informal Slack channel or occasional discussions', score: 3, value: 'informal' },
          { text: 'Regular community meetings or office hours', score: 6, value: 'regular' },
          { text: 'Active CoP with working groups and shared goals', score: 8, value: 'active' },
          { text: 'Thriving community with champions across teams', score: 10, value: 'thriving' }
        ]
      },
      {
        category: 'Culture & Contribution',
        weight: 25,
        roles: ['executive'],
        question: 'How do teams perceive ownership of the design system?',
        options: [
          { text: '"That\'s the design system team\'s job"', score: 0, value: 'external' },
          { text: 'Viewed as a shared tool but not collectively owned', score: 3, value: 'shared-tool' },
          { text: 'Seen as a collective asset with shared responsibility', score: 6, value: 'collective' },
          { text: 'Teams proactively improve it as part of their work', score: 8, value: 'proactive' },
          { text: 'Design system health is a shared OKR across teams', score: 10, value: 'okr' }
        ]
      },
      {
        category: 'Culture & Contribution',
        weight: 25,
        roles: ['practitioner'],
        question: 'Is time explicitly allocated for design system contribution?',
        options: [
          { text: 'No, contributions are on personal time or ignored', score: 0, value: 'none' },
          { text: 'Occasionally, when there\'s slack time', score: 3, value: 'occasional' },
          { text: 'Yes, but deprioritized under deadline pressure', score: 5, value: 'deprioritized' },
          { text: 'Yes, it\'s part of expected team responsibilities', score: 8, value: 'expected' },
          { text: 'Yes, with dedicated percentage of sprint capacity', score: 10, value: 'dedicated' }
        ]
      },
      // NEW: Psychological Safety (Google Project Aristotle)
      {
        category: 'Culture & Contribution',
        weight: 25,
        roles: ['all'],
        key: 'psychologicalSafety',
        question: 'Do team members feel safe to take risks and propose new ideas?',
        helper: 'Google\'s Project Aristotle found psychological safety is the #1 predictor of team effectiveness.',
        options: [
          { text: 'People fear speaking up or admitting mistakes', score: 0, value: 'low' },
          { text: 'Some teams are open, but it varies by manager', score: 3, value: 'inconsistent' },
          { text: 'Generally safe environment, but risky ideas are discouraged', score: 5, value: 'moderate' },
          { text: 'High trust—people openly share concerns and ideas', score: 8, value: 'high' },
          { text: 'Psychological safety is explicitly cultivated and measured', score: 10, value: 'cultivated' }
        ]
      },
      // NEW: Information Flow (Westrum Organizational Culture)
      {
        category: 'Culture & Contribution',
        weight: 25,
        roles: ['executive'],
        key: 'informationFlow',
        question: 'How freely does information flow across teams in your organization?',
        helper: 'Westrum\'s research shows that generative cultures with high information flow outperform.',
        options: [
          { text: 'Information is hoarded or used for political advantage', score: 0, value: 'pathological' },
          { text: 'Information flows within teams but not across silos', score: 2, value: 'siloed' },
          { text: 'Information is shared on a need-to-know basis', score: 4, value: 'bureaucratic' },
          { text: 'Information is actively shared and collaboration is normal', score: 7, value: 'collaborative' },
          { text: 'Information flows freely; failures are learning opportunities', score: 10, value: 'generative' }
        ]
      },

      // =========================================================================
      // MULTI-SYSTEM QUESTIONS (only shown for federated/multiple/systemOfSystems/fragmented)
      // These questions assess maturity across multiple design systems
      // =========================================================================
      
      // Multi-System: Foundation - Token Architecture
      {
        category: 'Multi-System Architecture',
        weight: 0, // Scored separately as System of Systems score
        roles: ['all'],
        key: 'tokenArchitecture',
        multiSystemOnly: true,
        question: 'How are design tokens structured across your systems?',
        helper: 'Design tokens are the foundation for multi-brand theming and system coordination.',
        options: [
          { text: 'No tokens or hardcoded values in each system', score: 0, value: 'none' },
          { text: 'Each system has its own token set (no sharing)', score: 2, value: 'separate' },
          { text: 'Some shared tokens, but inconsistent implementation', score: 4, value: 'partial' },
          { text: 'Shared semantic tokens with brand-specific value tokens', score: 7, value: 'semantic' },
          { text: 'Tiered token architecture (global → brand → component) with inheritance', score: 10, value: 'tiered' }
        ]
      },
      
      // Multi-System: Foundation - Component Abstraction
      {
        category: 'Multi-System Architecture',
        weight: 0,
        roles: ['practitioner'],
        key: 'componentAbstraction',
        multiSystemOnly: true,
        question: 'How brand-agnostic are your core components?',
        helper: 'Brand-agnostic components enable reuse across multiple brands without duplication.',
        options: [
          { text: 'Components are tightly coupled to specific brands', score: 0, value: 'coupled' },
          { text: 'Some components are shared, but require forking for brands', score: 2, value: 'forked' },
          { text: 'Core components exist, but theming is inconsistent', score: 4, value: 'inconsistent' },
          { text: 'Most components are brand-agnostic with theme slots', score: 7, value: 'abstracted' },
          { text: 'All core components are fully themeable via tokens', score: 10, value: 'themeable' }
        ]
      },
      
      // Multi-System: Governance - Cross-System Governance
      {
        category: 'Multi-System Architecture',
        weight: 0,
        roles: ['all'],
        key: 'crossSystemGovernance',
        multiSystemOnly: true,
        question: 'How do you govern across multiple design systems?',
        helper: 'Cross-system governance ensures consistency and quality across all systems.',
        options: [
          { text: 'Each system has independent governance (no coordination)', score: 0, value: 'independent' },
          { text: 'Informal coordination between system leads', score: 2, value: 'informal' },
          { text: 'Shared standards exist but implementation varies', score: 4, value: 'standards' },
          { text: 'Unified governance body with brand/system representatives', score: 7, value: 'unified' },
          { text: 'Federated governance with automated compliance checks', score: 10, value: 'federated' }
        ]
      },
      
      // Multi-System: AI - Cross-System AI Context
      {
        category: 'Multi-System Architecture',
        weight: 0,
        roles: ['all'],
        key: 'crossSystemAI',
        multiSystemOnly: true,
        question: 'Can AI tools access context from multiple systems?',
        helper: 'AI effectiveness depends on having unified context across all your design systems.',
        options: [
          { text: 'AI tools work with one system only', score: 0, value: 'single' },
          { text: 'AI tools can switch between systems manually', score: 2, value: 'manual' },
          { text: 'Unified API provides cross-system component access', score: 5, value: 'unified-api' },
          { text: 'AI has merged context with brand-aware output', score: 8, value: 'merged' },
          { text: 'AI automatically selects appropriate system based on context', score: 10, value: 'contextual' }
        ]
      },
      
      // Multi-System: Culture - Cross-System Contribution
      {
        category: 'Multi-System Architecture',
        weight: 0,
        roles: ['all'],
        key: 'crossSystemContribution',
        multiSystemOnly: true,
        question: 'Can contributors work across multiple systems?',
        helper: 'Cross-system contribution enables knowledge sharing and reduces silos.',
        options: [
          { text: 'Contributors specialize in one system only', score: 0, value: 'siloed' },
          { text: 'Some cross-training exists, but silos remain', score: 2, value: 'limited' },
          { text: 'Shared contribution guidelines with some cross-system PRs', score: 5, value: 'shared' },
          { text: 'Active cross-system contribution is encouraged', score: 8, value: 'active' },
          { text: 'Single contribution model with multi-system deployment', score: 10, value: 'unified' }
        ]
      },
      
      // Multi-System: Coordination - Sync & Versioning
      {
        category: 'Multi-System Architecture',
        weight: 0,
        roles: ['practitioner'],
        key: 'syncVersioning',
        multiSystemOnly: true,
        question: 'How do you coordinate releases across systems?',
        helper: 'Release coordination is critical for enterprise-scale consistency.',
        options: [
          { text: 'Systems release independently with no coordination', score: 0, value: 'independent' },
          { text: 'Manual coordination via meetings or documents', score: 2, value: 'manual' },
          { text: 'Shared release calendar with aligned cadence', score: 4, value: 'calendar' },
          { text: 'Coordinated versioning with dependency management', score: 7, value: 'coordinated' },
          { text: 'Unified CI/CD with automated cross-system testing', score: 10, value: 'unified' }
        ]
      },

      // Deployment Tier Questions
      {
        category: 'Deployment',
        weight: 0,
        roles: ['all'],
        question: 'What are your compliance and infrastructure requirements?',
        helper: 'Select all that apply. We will use the highest requirement to recommend deployment tier.',
        options: [
          { text: 'Standard SaaS acceptable (SOC 2)', score: 0, value: 'D1', tier: 'D1' },
          { text: 'Dedicated environment needed (SOC 2, GDPR)', score: 0, value: 'D2', tier: 'D2' },
          { text: 'Private cloud required (PCI, HIPAA)', score: 0, value: 'D3', tier: 'D3' },
          { text: 'Self-hosted/on-premises (FedRAMP, Defense)', score: 0, value: 'D4', tier: 'D4' },
          { text: 'Unknown - need to validate', score: 0, value: 'unknown', tier: 'D1' }
        ]
      }
    ];
    
    // Industry-specific question variants
    // These override the base question text/options for specific industries
    const industryVariants = {
      'Financial Services': {
        // Governance question variant
        2: {
          question: 'How is your design system governed for compliance requirements?',
          helper: 'Consider SOX, PCI-DSS, and regulatory audit requirements.',
          options: [
            { text: 'No governance structure', score: 0, value: 'none' },
            { text: 'Informal governance, compliance handled separately', score: 3, value: 'informal' },
            { text: 'Governance exists, compliance-aware but not integrated', score: 5, value: 'exists' },
            { text: 'Active governance with compliance audit trails', score: 8, value: 'active' },
            { text: 'Full compliance integration with automated controls', score: 10, value: 'cross-system' }
          ]
        },
        // AI Readiness variant
        3: {
          question: 'How are your teams using AI coding tools with regulatory considerations?',
          helper: 'Consider data residency, model governance, and audit requirements.',
          options: [
            { text: 'No AI tools approved for use', score: 0, value: 'none' },
            { text: 'Exploring with legal/compliance review', score: 2, value: 'experimental' },
            { text: 'Piloting with compliance guardrails', score: 4, value: 'some' },
            { text: 'Approved tools with usage policies', score: 6, value: 'widespread' },
            { text: 'Governed AI workflows in production', score: 8, value: 'integrated' }
          ]
        }
      },
      'Healthcare': {
        2: {
          question: 'How is your design system governed for HIPAA/PHI requirements?',
          helper: 'Consider PHI handling, audit logging, and access controls.',
          options: [
            { text: 'No governance for PHI components', score: 0, value: 'none' },
            { text: 'Ad-hoc governance, PHI handled elsewhere', score: 3, value: 'informal' },
            { text: 'Governance exists with PHI-aware patterns', score: 5, value: 'exists' },
            { text: 'Active governance with PHI controls', score: 8, value: 'active' },
            { text: 'Full HIPAA compliance baked into system', score: 10, value: 'cross-system' }
          ]
        },
        3: {
          question: 'How are AI tools being adopted with patient data safeguards?',
          helper: 'Consider BAA requirements, PHI isolation, and de-identification.',
          options: [
            { text: 'No AI tools approved for patient-facing work', score: 0, value: 'none' },
            { text: 'Exploring non-PHI use cases only', score: 2, value: 'experimental' },
            { text: 'Piloting with strict data isolation', score: 4, value: 'some' },
            { text: 'Approved for specific non-PHI workflows', score: 6, value: 'widespread' },
            { text: 'Governed AI with full audit logging', score: 8, value: 'integrated' }
          ]
        }
      },
      'Retail / E-commerce': {
        0: {
          question: 'What is the state of your omnichannel design system?',
          helper: 'Consider web, mobile, in-store, and marketplace channels.',
          options: [
            { text: 'No unified design system across channels', score: 0, value: 'none' },
            { text: 'Separate systems per channel', score: 4, value: 'informal' },
            { text: 'Some shared components across channels', score: 6, value: 'limited' },
            { text: 'Unified system with moderate cross-channel adoption', score: 8, value: 'moderate' },
            { text: 'Mature omnichannel system with high adoption', score: 10, value: 'mature' }
          ]
        },
        3: {
          question: 'How are AI tools being used for product/commerce experiences?',
          helper: 'Consider personalization, recommendations, and content generation.',
          options: [
            { text: 'No AI in product experiences', score: 0, value: 'none' },
            { text: 'Experimenting with recommendations', score: 2, value: 'experimental' },
            { text: 'AI for some personalization use cases', score: 4, value: 'some' },
            { text: 'Widespread AI-driven personalization', score: 6, value: 'widespread' },
            { text: 'AI integrated across customer journey', score: 8, value: 'integrated' }
          ]
        }
      },
      'Technology / Media': {
        3: {
          question: 'How embedded is AI in your engineering workflow?',
          helper: 'Consider code generation, testing, documentation, and review.',
          options: [
            { text: 'No AI tools sanctioned', score: 0, value: 'none' },
            { text: 'Individual experimentation allowed', score: 2, value: 'experimental' },
            { text: 'Team-level adoption with guidelines', score: 4, value: 'some' },
            { text: 'Org-wide adoption with best practices', score: 6, value: 'widespread' },
            { text: 'AI-first development culture', score: 8, value: 'integrated' }
          ]
        }
      },
      'Regulated / Industrial': {
        2: {
          question: 'How is your design system governed for safety/regulatory compliance?',
          helper: 'Consider ISO, safety standards, and certification requirements.',
          options: [
            { text: 'No formal governance structure', score: 0, value: 'none' },
            { text: 'Ad-hoc governance, compliance separate', score: 3, value: 'informal' },
            { text: 'Governance with safety-aware patterns', score: 5, value: 'exists' },
            { text: 'Active governance with certification tracking', score: 8, value: 'active' },
            { text: 'Full compliance integration with traceability', score: 10, value: 'cross-system' }
          ]
        }
      },
      'Enterprise Software': {
        0: {
          question: 'What is the state of your multi-product design system?',
          helper: 'Consider how components are shared across your product portfolio.',
          options: [
            { text: 'No shared design system across products', score: 0, value: 'none' },
            { text: 'Informal sharing between some products', score: 4, value: 'informal' },
            { text: 'Shared library with limited adoption', score: 6, value: 'limited' },
            { text: 'Unified system across most products', score: 8, value: 'moderate' },
            { text: 'Platform design system with full adoption', score: 10, value: 'mature' }
          ]
        },
        3: {
          question: 'How are AI tools integrated into your product development?',
          helper: 'Consider code generation, testing, documentation, and feature development.',
          options: [
            { text: 'No AI tools in product development', score: 0, value: 'none' },
            { text: 'Experimenting with AI coding assistants', score: 2, value: 'experimental' },
            { text: 'AI used by some engineering teams', score: 4, value: 'some' },
            { text: 'AI integrated into CI/CD pipelines', score: 6, value: 'widespread' },
            { text: 'AI-first development with governance', score: 8, value: 'integrated' }
          ]
        },
        // Delivery workflow for Enterprise Software
        10: {
          question: 'How consistent is your release process across products?',
          options: [
            { text: 'Each product has its own release process', score: 0, value: 'low' },
            { text: 'Some shared practices, many exceptions', score: 2, value: 'medium' },
            { text: 'Unified release process across products', score: 4, value: 'high' }
          ]
        }
      },
      'Telecommunications / Media': {
        0: {
          question: 'What is the state of your cross-platform design system?',
          helper: 'Consider web, mobile apps, set-top boxes, and other platforms.',
          options: [
            { text: 'No unified system across platforms', score: 0, value: 'none' },
            { text: 'Platform-specific systems', score: 4, value: 'informal' },
            { text: 'Some shared tokens and patterns', score: 6, value: 'limited' },
            { text: 'Unified system with platform adaptations', score: 8, value: 'moderate' },
            { text: 'Full cross-platform design system', score: 10, value: 'mature' }
          ]
        },
        3: {
          question: 'How are AI tools being used for content and experience delivery?',
          helper: 'Consider personalization, recommendations, and content generation.',
          options: [
            { text: 'No AI in content/experience delivery', score: 0, value: 'none' },
            { text: 'Experimenting with recommendations', score: 2, value: 'experimental' },
            { text: 'AI for some content personalization', score: 4, value: 'some' },
            { text: 'AI-driven content and UX optimization', score: 6, value: 'widespread' },
            { text: 'AI integrated across all touchpoints', score: 8, value: 'integrated' }
          ]
        }
      },
      'Education (Nonprofit)': {
        2: {
          question: 'How is your design system governed for accessibility and equity?',
          helper: 'Consider WCAG compliance, multi-language support, and inclusive design.',
          options: [
            { text: 'No formal governance for accessibility', score: 0, value: 'none' },
            { text: 'Ad-hoc accessibility reviews', score: 3, value: 'informal' },
            { text: 'Accessibility guidelines exist', score: 5, value: 'exists' },
            { text: 'Active governance with accessibility testing', score: 8, value: 'active' },
            { text: 'Accessibility baked into all components', score: 10, value: 'cross-system' }
          ]
        },
        3: {
          question: 'How are AI tools being adopted with student data privacy in mind?',
          helper: 'Consider FERPA, COPPA, and student data protection requirements.',
          options: [
            { text: 'No AI tools approved', score: 0, value: 'none' },
            { text: 'Exploring with privacy review', score: 2, value: 'experimental' },
            { text: 'Piloting with data safeguards', score: 4, value: 'some' },
            { text: 'Approved for specific use cases', score: 6, value: 'widespread' },
            { text: 'Governed AI with full compliance', score: 8, value: 'integrated' }
          ]
        },
        8: {
          question: 'Is there committed investment for product system work?',
          helper: 'Consider grant funding, institutional budget, and multi-year planning.',
          options: [
            { text: 'No dedicated budget', score: 0, value: 'none' },
            { text: 'Would need to pursue grants', score: 3, value: 'find' },
            { text: 'Budget exists in annual plan', score: 6, value: 'approval' },
            { text: 'Funded with institutional support', score: 8, value: 'allocated' },
            { text: 'Multi-year commitment secured', score: 10, value: 'multi-year' }
          ]
        }
      },
      'Utilities (Electric)': {
        2: {
          question: 'How is your design system governed for critical infrastructure requirements?',
          helper: 'Consider NERC CIP, grid reliability, and emergency response patterns.',
          options: [
            { text: 'No formal governance structure', score: 0, value: 'none' },
            { text: 'Ad-hoc governance, compliance separate', score: 3, value: 'informal' },
            { text: 'Governance with reliability patterns', score: 5, value: 'exists' },
            { text: 'Active governance with compliance tracking', score: 8, value: 'active' },
            { text: 'Full NERC CIP integration', score: 10, value: 'cross-system' }
          ]
        },
        3: {
          question: 'How are AI tools being adopted for grid/operations interfaces?',
          options: [
            { text: 'No AI in operations interfaces', score: 0, value: 'none' },
            { text: 'Exploring for non-critical systems', score: 2, value: 'experimental' },
            { text: 'Piloting with safety controls', score: 4, value: 'some' },
            { text: 'AI for specific operations use cases', score: 6, value: 'widespread' },
            { text: 'Governed AI with operator oversight', score: 8, value: 'integrated' }
          ]
        }
      },
      'Travel / Hospitality': {
        0: {
          question: 'What is the state of your guest experience design system?',
          helper: 'Consider web, mobile, kiosk, and in-property touchpoints.',
          options: [
            { text: 'No unified guest experience system', score: 0, value: 'none' },
            { text: 'Separate systems per touchpoint', score: 4, value: 'informal' },
            { text: 'Some shared booking/loyalty components', score: 6, value: 'limited' },
            { text: 'Unified system across guest journey', score: 8, value: 'moderate' },
            { text: 'Seamless omnichannel guest experience', score: 10, value: 'mature' }
          ]
        },
        3: {
          question: 'How are AI tools being used for guest experiences?',
          helper: 'Consider personalization, concierge, and dynamic pricing.',
          options: [
            { text: 'No AI in guest experiences', score: 0, value: 'none' },
            { text: 'Experimenting with chatbots', score: 2, value: 'experimental' },
            { text: 'AI for recommendations/pricing', score: 4, value: 'some' },
            { text: 'AI-driven personalization', score: 6, value: 'widespread' },
            { text: 'AI concierge across touchpoints', score: 8, value: 'integrated' }
          ]
        }
      },
      'Insurance': {
        2: {
          question: 'How is your design system governed for insurance compliance?',
          helper: 'Consider state regulations, claims handling, and disclosure requirements.',
          options: [
            { text: 'No governance structure', score: 0, value: 'none' },
            { text: 'Informal governance, compliance separate', score: 3, value: 'informal' },
            { text: 'Governance with compliance patterns', score: 5, value: 'exists' },
            { text: 'Active governance with disclosure tracking', score: 8, value: 'active' },
            { text: 'Full compliance integration', score: 10, value: 'cross-system' }
          ]
        },
        3: {
          question: 'How are AI tools being adopted for underwriting and claims?',
          helper: 'Consider bias testing, explainability, and regulatory requirements.',
          options: [
            { text: 'No AI in insurance processes', score: 0, value: 'none' },
            { text: 'Exploring with compliance review', score: 2, value: 'experimental' },
            { text: 'Piloting with bias controls', score: 4, value: 'some' },
            { text: 'AI for specific workflows', score: 6, value: 'widespread' },
            { text: 'Governed AI with full explainability', score: 8, value: 'integrated' }
          ]
        }
      },
      'Government / Public Sector': {
        2: {
          question: 'How is your design system governed for accessibility and compliance?',
          helper: 'Consider Section 508, FedRAMP, and citizen access requirements.',
          options: [
            { text: 'No formal governance', score: 0, value: 'none' },
            { text: 'Ad-hoc accessibility efforts', score: 3, value: 'informal' },
            { text: 'Section 508 awareness', score: 5, value: 'exists' },
            { text: 'Active governance with compliance testing', score: 8, value: 'active' },
            { text: 'Full accessibility and FedRAMP compliance', score: 10, value: 'cross-system' }
          ]
        },
        3: {
          question: 'How are AI tools being adopted in citizen-facing services?',
          helper: 'Consider bias, transparency, and public accountability requirements.',
          options: [
            { text: 'No AI in citizen services', score: 0, value: 'none' },
            { text: 'Exploring with ethics review', score: 2, value: 'experimental' },
            { text: 'Piloting with transparency controls', score: 4, value: 'some' },
            { text: 'AI for specific service workflows', score: 6, value: 'widespread' },
            { text: 'Governed AI with public accountability', score: 8, value: 'integrated' }
          ]
        },
        8: {
          question: 'Is there committed investment for product system work?',
          helper: 'Consider appropriations, grants, and multi-year funding.',
          options: [
            { text: 'No dedicated budget', score: 0, value: 'none' },
            { text: 'Would need new appropriation', score: 3, value: 'find' },
            { text: 'In current year budget', score: 6, value: 'approval' },
            { text: 'Funded and approved', score: 8, value: 'allocated' },
            { text: 'Multi-year commitment', score: 10, value: 'multi-year' }
          ]
        }
      },
      'Aerospace / Space': {
        2: {
          question: 'How is your design system governed for mission-critical requirements?',
          helper: 'Consider DO-178C, AS9100, and security clearance requirements.',
          options: [
            { text: 'No formal governance structure', score: 0, value: 'none' },
            { text: 'Ad-hoc governance, compliance separate', score: 3, value: 'informal' },
            { text: 'Governance with safety-critical patterns', score: 5, value: 'exists' },
            { text: 'Active governance with full traceability', score: 8, value: 'active' },
            { text: 'Certified system with automated verification', score: 10, value: 'cross-system' }
          ]
        },
        3: {
          question: 'How are AI tools being adopted with security/classification requirements?',
          options: [
            { text: 'No AI tools approved', score: 0, value: 'none' },
            { text: 'Exploring unclassified use cases', score: 2, value: 'experimental' },
            { text: 'Piloting with air-gapped environments', score: 4, value: 'some' },
            { text: 'Approved for specific cleared workflows', score: 6, value: 'widespread' },
            { text: 'Governed AI with security controls', score: 8, value: 'integrated' }
          ]
        }
      }
    };
    
    // Filter questions by selected role and apply industry variants
    function filterQuestionsByRole(role) {
      // First filter by role
      let filtered = questions.filter(q => {
        if (!q.roles || q.roles.includes('all')) return true;
        return q.roles.includes(role);
      });
      
      // Then filter by system landscape (exclude multi-system questions for single-system orgs)
      const showMultiSystem = SYSTEM_LANDSCAPE_CONFIG[selectedSystemLandscape]?.showMultiSystemQuestions;
      if (!showMultiSystem) {
        filtered = filtered.filter(q => !q.multiSystemOnly);
      }
      
      // Apply industry-specific variants if available
      if (selectedIndustry && industryVariants[selectedIndustry]) {
        const variants = industryVariants[selectedIndustry];
        return filtered.map((q, idx) => {
          // Find original index in base questions array
          const originalIdx = questions.indexOf(q);
          if (variants[originalIdx]) {
            return { ...q, ...variants[originalIdx] };
          }
          return q;
        });
      }
      
      return filtered;
    }
    
    // Industries with tailored questions
    const industriesWithVariants = [
      'Financial Services',
      'Healthcare',
      'Retail / E-commerce',
      'Technology / Media',
      'Regulated / Industrial',
      'Aerospace / Space',
      'Enterprise Software',
      'Telecommunications / Media',
      'Education (Nonprofit)',
      'Utilities (Electric)',
      'Travel / Hospitality',
      'Insurance',
      'Government / Public Sector'
    ];
    
    // Update industry indicator
    function updateIndustryIndicator() {
      const industry = document.getElementById('industry-pref').value;
      const indicator = document.getElementById('industry-indicator');
      if (industriesWithVariants.includes(industry)) {
        indicator.style.display = 'block';
      } else {
        indicator.style.display = 'none';
      }
    }
    
    // Set role and update UI
    function setRole(role) {
      selectedRole = role;
      const execOption = document.getElementById('role-executive');
      const practOption = document.getElementById('role-practitioner');
      
      // Update choice card selection using class toggle
      if (role === 'executive') {
        execOption.classList.add('selected');
        practOption.classList.remove('selected');
      } else {
        practOption.classList.add('selected');
        execOption.classList.remove('selected');
      }
      
      // Update filtered questions
      filteredQuestions = filterQuestionsByRole(role);
    }
    
    function setSystemLandscape(landscape) {
      selectedSystemLandscape = landscape;
      const options = document.querySelectorAll('[id^="landscape-"].choice-card');
      options.forEach(opt => {
        if (opt.id === `landscape-${landscape}`) {
          opt.classList.add('selected');
        } else {
          opt.classList.remove('selected');
        }
      });
      
      // Update preview text
      const previewLabels = {
        single: 'Single Unified System',
        federated: 'Federated Systems',
        multiple: 'Multiple Independent',
        systemOfSystems: 'System of Systems',
        fragmented: 'Fragmented'
      };
      const preview = document.getElementById('landscape-preview');
      if (preview) {
        preview.textContent = previewLabels[landscape] || 'Single Unified System';
      }
      
      // Show/hide multi-system indicator
      const indicator = document.getElementById('multi-system-indicator');
      const config = SYSTEM_LANDSCAPE_CONFIG[landscape];
      if (indicator && config) {
        indicator.style.display = config.showMultiSystemQuestions ? 'block' : 'none';
      }
      
      // Re-filter questions based on new landscape
      filteredQuestions = filterQuestionsByRole(selectedRole);
    }
    
    function toggleTool(toolId) {
      const chip = document.querySelector(`.tool-chip[data-tool="${toolId}"]`);
      if (!chip) return;
      
      // Special handling for "none" - deselect all others
      if (toolId === 'none') {
        if (selectedTools.includes('none')) {
          selectedTools = [];
          chip.classList.remove('selected');
          chip.setAttribute('aria-pressed', 'false');
        } else {
          selectedTools = ['none'];
          document.querySelectorAll('.tool-chip').forEach(c => {
            c.classList.remove('selected');
            c.setAttribute('aria-pressed', 'false');
          });
          chip.classList.add('selected');
          chip.setAttribute('aria-pressed', 'true');
        }
      } else {
        // Deselect "none" if selecting any tool
        const noneChip = document.querySelector('.tool-chip[data-tool="none"]');
        if (noneChip) {
          noneChip.classList.remove('selected');
          noneChip.setAttribute('aria-pressed', 'false');
        }
        selectedTools = selectedTools.filter(t => t !== 'none');
        
        // Toggle the selected tool
        if (selectedTools.includes(toolId)) {
          selectedTools = selectedTools.filter(t => t !== toolId);
          chip.classList.remove('selected');
          chip.setAttribute('aria-pressed', 'false');
        } else {
          selectedTools.push(toolId);
          chip.classList.add('selected');
          chip.setAttribute('aria-pressed', 'true');
        }
      }
      
      // Announce selection change to screen readers
      const toolName = TOOL_CONFIG[toolId]?.name || toolId;
      const isSelected = selectedTools.includes(toolId);
      announceToScreenReader(`${toolName} ${isSelected ? 'selected' : 'deselected'}. ${selectedTools.length} tools selected.`);
      
      // Update tools preview text
      updateToolsPreview();
    }
    
    function updateToolsPreview() {
      const preview = document.getElementById('tools-preview');
      if (!preview) return;
      
      if (selectedTools.length === 0) {
        preview.textContent = 'Optional';
      } else if (selectedTools.includes('none')) {
        preview.textContent = 'No unified tooling';
      } else if (selectedTools.length === 1) {
        preview.textContent = TOOL_CONFIG[selectedTools[0]]?.name || selectedTools[0];
      } else if (selectedTools.length <= 3) {
        preview.textContent = selectedTools.map(t => TOOL_CONFIG[t]?.name || t).join(', ');
      } else {
        preview.textContent = `${selectedTools.length} tools selected`;
      }
    }
    
    function analyzeToolStack() {
      if (selectedTools.length === 0) return null;
      
      // Check for Knapsack first - special handling for existing users
      if (selectedTools.includes('knapsack')) {
        return { ...TOOL_GAP_ANALYSIS.knapsackUser, otherTools: selectedTools.filter(t => t !== 'knapsack') };
      }
      
      // Check for "none" first
      if (selectedTools.includes('none')) {
        return TOOL_GAP_ANALYSIS.manualProcesses;
      }
      
      // Check for manual processes
      if (selectedTools.includes('manual') && selectedTools.length <= 2) {
        return TOOL_GAP_ANALYSIS.manualProcesses;
      }
      
      // Check for fragmentation (4+ tools)
      if (selectedTools.length >= 4) {
        return { ...TOOL_GAP_ANALYSIS.fragmented, toolCount: selectedTools.length };
      }
      
      // Check for custom-built
      if (selectedTools.includes('custom')) {
        return TOOL_GAP_ANALYSIS.customBuilt;
      }
      
      // Check for competitor platforms
      if ((selectedTools.includes('zeroheight') || selectedTools.includes('supernova')) && 
          !selectedTools.includes('knapsack')) {
        return TOOL_GAP_ANALYSIS.competitorPlatform;
      }
      
      // Check for Storybook only (no platform)
      if (selectedTools.includes('storybook') && 
          !selectedTools.includes('zeroheight') && 
          !selectedTools.includes('supernova') && 
          !selectedTools.includes('knapsack')) {
        return TOOL_GAP_ANALYSIS.storybookOnly;
      }
      
      // Check for design-only
      const designTools = selectedTools.filter(t => ['figma', 'sketch', 'adobexd'].includes(t));
      const hasDocPlatform = selectedTools.some(t => ['storybook', 'zeroheight', 'supernova', 'knapsack'].includes(t));
      if (designTools.length > 0 && !hasDocPlatform) {
        return TOOL_GAP_ANALYSIS.designOnly;
      }
      
      // Default - fragmented if multiple tools, otherwise null
      if (selectedTools.length >= 3) {
        return { ...TOOL_GAP_ANALYSIS.fragmented, toolCount: selectedTools.length };
      }
      
      return null;
    }
    
    // Update progress step indicators
    function updateProgressSteps(category) {
      const steps = document.querySelectorAll('.progress-step');
      const categoryMap = {
        'Product System Foundation': 'foundation',
        'AI Readiness': 'ai',
        'Governance & Adoption': 'governance',
        'Delivery Workflow': 'delivery',
        'Culture & Contribution': 'culture',
        'Multi-System Architecture': 'multisystem',
        'Deployment': 'multisystem'
      };
      
      const currentKey = categoryMap[category] || 'foundation';
      const showMultiSystem = SYSTEM_LANDSCAPE_CONFIG[selectedSystemLandscape]?.showMultiSystemQuestions;
      const order = showMultiSystem 
        ? ['foundation', 'ai', 'governance', 'delivery', 'culture', 'multisystem']
        : ['foundation', 'ai', 'governance', 'delivery', 'culture'];
      const currentIndex = order.indexOf(currentKey);
      
      steps.forEach(step => {
        const stepKey = step.dataset.category;
        const stepIndex = order.indexOf(stepKey);
        
        step.classList.remove('active', 'completed');
        step.removeAttribute('aria-current');
        
        if (stepIndex < currentIndex) {
          step.classList.add('completed');
        } else if (stepIndex === currentIndex) {
          step.classList.add('active');
          step.setAttribute('aria-current', 'step');
        }
      });
      
      // Update category label
      const categoryLabel = document.getElementById('progress-category');
      if (categoryLabel) {
        categoryLabel.textContent = category;
      }
      
      // Announce progress change to screen readers
      const completedCount = currentIndex;
      const totalSteps = order.length;
      announceToScreenReader(`${category} section. Step ${currentIndex + 1} of ${totalSteps}.`);
    }

    // =========================================================================
    // INTERNAL: Investment Path Logic (for resource planning & procurement only)
    // NOT customer-facing - keep for backend data and internal sales alignment
    // =========================================================================
    const journeyDetails = {
      J1: { shortName: 'Foundation', internalTier: 'Foundation Tier', resourceLevel: 'light' },
      J2: { shortName: 'Momentum', internalTier: 'Momentum Tier', resourceLevel: 'moderate' },
      J3: { shortName: 'Scale', internalTier: 'Scale Tier', resourceLevel: 'full' },
      J4: { shortName: 'Intelligence', internalTier: 'Intelligence Tier', resourceLevel: 'expansion' }
    };

    // =========================================================================
    // CUSTOMER-FACING: Maturity Archetypes
    // These are shown to users based on their PSRI score
    // =========================================================================
    const archetypeDetails = {
      builder: {
        name: 'Foundation Builder',
        shortName: 'Builder',
        color: '#ef4444', // red
        colorClass: 'red',
        scoreRange: '0-39',
        headline: 'You\'re building the foundation for future success.',
        description: 'Your organization is in the early stages of product system maturity. The focus should be on establishing core components, documentation, and initial governance.',
        focus: [
          'Establish a component library with design tokens',
          'Create baseline documentation for existing components',
          'Identify an executive sponsor and secure initial investment',
          'Build a small, cross-functional core team'
        ],
        outcomes: [
          'Consistent visual language across products',
          'Reduced duplication of design and engineering effort',
          'Foundation for future AI-readiness'
        ],
        timeframe: '6-12 months to advance to Adopter'
      },
      adopter: {
        name: 'Advancing Adopter',
        shortName: 'Adopter',
        color: '#fbbf24', // amber
        colorClass: 'amber',
        scoreRange: '40-59',
        headline: 'You have a system in place—now it\'s time to scale adoption.',
        description: 'Your design system exists but adoption is uneven. The focus should be on driving consistent usage, improving governance, and preparing for AI integration.',
        focus: [
          'Drive adoption from 40% to 70%+ across teams',
          'Establish contribution guidelines and community practices',
          'Implement structured metadata for AI readiness',
          'Create training and onboarding programs'
        ],
        outcomes: [
          'Significantly faster time-to-market',
          'Improved consistency and brand alignment',
          'Clear path to AI-assisted development'
        ],
        timeframe: '6-9 months to advance to Optimizer'
      },
      optimizer: {
        name: 'Scaling Optimizer',
        shortName: 'Optimizer',
        color: '#3b82f6', // blue
        colorClass: 'blue',
        scoreRange: '60-79',
        headline: 'Your system is mature—optimize for scale and efficiency.',
        description: 'You have high adoption and solid governance. The focus should be on optimization, advanced automation, and preparing for enterprise-wide AI enablement.',
        focus: [
          'Optimize component performance and accessibility',
          'Implement advanced analytics and usage tracking',
          'Pilot AI-assisted development workflows',
          'Expand to multi-brand or multi-platform support'
        ],
        outcomes: [
          'Measurable efficiency gains (30-50% faster delivery)',
          'Data-driven decisions on system evolution',
          'Competitive advantage through AI-ready delivery'
        ],
        timeframe: '6-12 months to advance to Transformer'
      },
      transformer: {
        name: 'Leading Transformer',
        shortName: 'Transformer',
        color: '#10b981', // green
        colorClass: 'green',
        scoreRange: '80-100',
        headline: 'You\'re a leader—focus on innovation and AI-first delivery.',
        description: 'Your product system is a competitive advantage. The focus should be on AI-first workflows, continuous innovation, and sharing best practices.',
        focus: [
          'Enable governed AI-first development workflows',
          'Implement continuous compliance and audit automation',
          'Establish innovation labs for emerging patterns',
          'Share learnings through communities of practice'
        ],
        outcomes: [
          'Industry-leading delivery speed and consistency',
          'Safe, governed AI execution at scale',
          'Continuous competitive differentiation'
        ],
        timeframe: 'Maintain leadership through continuous improvement'
      }
    };

    // Map PSRI score to customer-facing archetype
    function getArchetypeFromScore(psriScore) {
      if (psriScore >= 80) return 'transformer';
      if (psriScore >= 60) return 'optimizer';
      if (psriScore >= 40) return 'adopter';
      return 'builder';
    }

    // Map internal journey to archetype (for backwards compatibility)
    function getArchetypeFromJourney(journeyId) {
      const mapping = { J1: 'builder', J2: 'adopter', J3: 'optimizer', J4: 'transformer' };
      return mapping[journeyId] || 'builder';
    }


    function trackEvent(name, payload = {}) {
      const data = { event: name, ...payload, timestamp: new Date().toISOString() };
      if (window.dataLayer && typeof window.dataLayer.push === 'function') {
        window.dataLayer.push(data);
      } else if (window.gtag) {
        window.gtag('event', name, payload);
      } else if (window.analytics && typeof window.analytics.track === 'function') {
        window.analytics.track(name, payload);
      } else {
        console.info('trackEvent', data);
      }
    }
    
    // =========================================================================
    // ACCESSIBILITY HELPERS
    // =========================================================================
    
    /**
     * Announce message to screen readers via live region
     * @param {string} message - Message to announce
     * @param {boolean} assertive - Use assertive (true) or polite (false) announcement
     */
    /**
     * Announce message to screen readers (alias for announce)
     * @param {string} message - Message to announce
     * @param {boolean} assertive - Use assertive announcement
     */
    function announceToScreenReader(message, assertive = false) {
      announce(message, assertive);
    }
    
    /**
     * Create accessible Lucide icons
     * Wraps lucide.createIcons() and adds aria-hidden to all generated SVGs
     */
    function createAccessibleIcons() {
      createAccessibleIcons();
      // Add aria-hidden to all Lucide-generated SVGs for accessibility
      document.querySelectorAll('svg.lucide').forEach(svg => {
        if (!svg.hasAttribute('aria-hidden')) {
          svg.setAttribute('aria-hidden', 'true');
        }
        // Ensure SVGs are not focusable
        svg.setAttribute('focusable', 'false');
      });
    }
    
    /**
     * Show inline error message for a form field
     * @param {string} fieldId - ID of the form field
     * @param {string} message - Error message to display
     */
    function showInlineError(fieldId, message) {
      const field = document.getElementById(fieldId);
      if (!field) return;
      
      // Check if error already exists
      let errorEl = document.getElementById(`${fieldId}-error`);
      if (!errorEl) {
        errorEl = document.createElement('p');
        errorEl.id = `${fieldId}-error`;
        errorEl.className = 'form-error';
        errorEl.setAttribute('role', 'alert');
        field.parentNode.appendChild(errorEl);
        
        // Link error to field
        const existingDescribedBy = field.getAttribute('aria-describedby') || '';
        field.setAttribute('aria-describedby', `${existingDescribedBy} ${fieldId}-error`.trim());
      }
      
      errorEl.innerHTML = `<i data-lucide="alert-circle" style="width: 14px; height: 14px;" aria-hidden="true"></i> ${message}`;
      errorEl.style.display = 'flex';
      createAccessibleIcons();
    }
    
    /**
     * Hide inline error message for a form field
     * @param {string} fieldId - ID of the form field
     */
    function hideInlineError(fieldId) {
      const errorEl = document.getElementById(`${fieldId}-error`);
      if (errorEl) {
        errorEl.style.display = 'none';
      }
    }
    
    function announce(message, assertive = false) {
      const region = document.getElementById(assertive ? 'a11y-alert' : 'a11y-announcer');
      if (region) {
        // Clear first to ensure re-announcement of same message
        region.textContent = '';
        // Use requestAnimationFrame to ensure DOM updates
        requestAnimationFrame(() => {
          region.textContent = message;
        });
      }
    }
    
    /**
     * Set focus to an element with optional scroll behavior
     * @param {string|HTMLElement} elementOrSelector - Element or selector to focus
     * @param {boolean} scroll - Whether to scroll into view
     */
    function setFocus(elementOrSelector, scroll = true) {
      const el = typeof elementOrSelector === 'string' 
        ? document.querySelector(elementOrSelector) 
        : elementOrSelector;
      
      if (el) {
        // Make element focusable if it isn't already
        if (!el.hasAttribute('tabindex') && !['A', 'BUTTON', 'INPUT', 'SELECT', 'TEXTAREA'].includes(el.tagName)) {
          el.setAttribute('tabindex', '-1');
        }
        
        if (scroll) {
          el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // Delay focus slightly to ensure DOM is ready
        setTimeout(() => el.focus(), 100);
      }
    }
    
    /**
     * Update progress bar ARIA attributes
     * @param {number} value - Current progress value (0-100)
     * @param {string} category - Current category name
     */
    function updateProgressAria(value, category) {
      const progressTrack = document.getElementById('progress-track');
      if (progressTrack) {
        progressTrack.setAttribute('aria-valuenow', Math.round(value));
        progressTrack.setAttribute('aria-valuetext', `${Math.round(value)}% complete, currently on ${category}`);
      }
      
      // Update step indicators
      const steps = document.querySelectorAll('.progress-step');
      const categoryMap = {
        'Product System Foundation': 'foundation',
        'AI Readiness': 'ai',
        'Governance & Adoption': 'governance',
        'Delivery Workflow': 'delivery',
        'Culture & Contribution': 'culture',
        'Deployment': 'culture'
      };
      const currentKey = categoryMap[category] || 'foundation';
      
      steps.forEach(step => {
        step.removeAttribute('aria-current');
        if (step.dataset.category === currentKey) {
          step.setAttribute('aria-current', 'step');
        }
      });
    }
    
    // =========================================================================
    // GOOGLE SHEETS INTEGRATION
    // =========================================================================
    
    async function saveToGoogleSheets(data) {
      if (!GOOGLE_SHEETS_WEBAPP_URL || GOOGLE_SHEETS_WEBAPP_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL') {
        console.warn('Google Sheets Web App URL not configured. Saving to localStorage as fallback.');
        saveToLocalStorage(data);
        return { success: false, error: 'Not configured', queued: true };
      }
      
      try {
        const response = await fetch(GOOGLE_SHEETS_WEBAPP_URL, {
          method: 'POST',
          mode: 'no-cors', // Required for Apps Script Web Apps
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        // no-cors mode doesn't allow reading response, so we assume success
        console.info('Assessment data sent to Google Sheets');
        showToast('Assessment saved successfully!', 'success');
        return { success: true };
      } catch (error) {
        console.error('Failed to save to Google Sheets:', error);
        // Fallback: save to localStorage for later retry
        saveToLocalStorage(data);
        showToast('Saved locally - will sync when connection restored', 'warning');
        return { success: false, error: error.message, queued: true };
      }
    }
    
    /**
     * Save assessment to localStorage as fallback
     */
    function saveToLocalStorage(data) {
      try {
        const pending = JSON.parse(localStorage.getItem('ipe_pending_assessments') || '[]');
        pending.push({ ...data, savedAt: new Date().toISOString(), synced: false });
        localStorage.setItem('ipe_pending_assessments', JSON.stringify(pending));
        console.info('Assessment saved to localStorage for later sync');
      } catch (e) {
        console.error('Failed to save to localStorage:', e);
      }
    }
    
    /**
     * Retry syncing pending assessments from localStorage
     */
    async function syncPendingAssessments() {
      if (!GOOGLE_SHEETS_WEBAPP_URL || GOOGLE_SHEETS_WEBAPP_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL') {
        return;
      }
      
      const pending = JSON.parse(localStorage.getItem('ipe_pending_assessments') || '[]');
      const unsynced = pending.filter(a => !a.synced);
      
      if (unsynced.length === 0) return;
      
      console.info(`Attempting to sync ${unsynced.length} pending assessments...`);
      
      for (const assessment of unsynced) {
        try {
          await fetch(GOOGLE_SHEETS_WEBAPP_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(assessment)
          });
          assessment.synced = true;
        } catch (e) {
          console.warn('Failed to sync assessment:', e);
        }
      }
      
      localStorage.setItem('ipe_pending_assessments', JSON.stringify(pending));
      const syncedCount = pending.filter(a => a.synced).length;
      if (syncedCount > 0) {
        console.info(`Synced ${syncedCount} pending assessments`);
      }
    }
    
    /**
     * Show a toast notification
     */
    function showToast(message, type = 'info') {
      // Remove existing toasts
      document.querySelectorAll('.ipe-toast').forEach(t => t.remove());
      
      const colors = {
        success: { bg: 'rgba(16, 185, 129, 0.95)', icon: 'check-circle' },
        warning: { bg: 'rgba(251, 191, 36, 0.95)', icon: 'alert-triangle' },
        error: { bg: 'rgba(239, 68, 68, 0.95)', icon: 'x-circle' },
        info: { bg: 'rgba(59, 130, 246, 0.95)', icon: 'info' }
      };
      
      const { bg, icon } = colors[type] || colors.info;
      
      const toast = document.createElement('div');
      toast.className = 'ipe-toast';
      toast.setAttribute('role', 'status');
      toast.setAttribute('aria-live', 'polite');
      toast.style.cssText = `
        position: fixed;
        bottom: 24px;
        right: 24px;
        background: ${bg};
        color: #fff;
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 0.9rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        z-index: 10000;
        animation: slideInToast 0.3s ease;
      `;
      
      toast.innerHTML = `<i data-lucide="${icon}" style="width: 18px; height: 18px;"></i> ${message}`;
      document.body.appendChild(toast);
      lucide.createIcons();
      
      // Auto-dismiss after 4 seconds
      setTimeout(() => {
        toast.style.animation = 'fadeOutToast 0.3s ease forwards';
        setTimeout(() => toast.remove(), 300);
      }, 4000);
    }
    
    // Add toast animations to page
    const toastStyles = document.createElement('style');
    toastStyles.textContent = `
      @keyframes slideInToast {
        from { opacity: 0; transform: translateX(100px); }
        to { opacity: 1; transform: translateX(0); }
      }
      @keyframes fadeOutToast {
        from { opacity: 1; transform: translateX(0); }
        to { opacity: 0; transform: translateX(100px); }
      }
    `;
    document.head.appendChild(toastStyles);
    
    // Try to sync pending assessments on page load
    window.addEventListener('load', () => {
      setTimeout(syncPendingAssessments, 2000);
    });
    
    // Also try to sync when coming back online
    window.addEventListener('online', syncPendingAssessments);
    
    async function lookupBaseline(orgId) {
      if (!GOOGLE_SHEETS_WEBAPP_URL || GOOGLE_SHEETS_WEBAPP_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL') {
        console.warn('Google Sheets Web App URL not configured. Cannot lookup baseline.');
        return null;
      }
      
      try {
        const url = `${GOOGLE_SHEETS_WEBAPP_URL}?action=lookup&orgId=${encodeURIComponent(orgId)}`;
        const response = await fetch(url);
        
        if (!response.ok) return null;
        
        const data = await response.json();
        return data.baseline || null;
      } catch (error) {
        console.error('Failed to lookup baseline:', error);
        return null;
      }
    }
    
    function buildAssessmentPayload(results, formData = {}) {
      return {
        timestamp: new Date().toISOString(),
        organizationId: organizationId,
        assessmentType: assessmentType,
        industry: selectedIndustry,
        respondentRole: selectedRole,
        psriVersion: PSRI_VERSION,
        
        // PSRI Score
        psriScore: results.psriScore,
        
        // Normalized pillar scores (0-100)
        foundationNorm: results.foundationNorm,
        aiNorm: results.aiNorm,
        governanceNorm: results.orgNorm,
        deliveryNorm: results.deliveryNorm,
        
        // Display scores (legacy format)
        foundationScore: results.foundationScore,
        aiScore: results.aiScore,
        orgScore: results.orgScore,
        deliveryScore: results.deliveryScore,
        totalScore: results.totalScore,
        
        // Path and tier (internal use only)
        recommendedPath: recommendedPath,
        deploymentTier: deploymentTier,
        // Customer-facing archetype
        archetype: archetypeDetails[getArchetypeFromScore(results.psriScore)]?.name || 'Foundation Builder',
        archetypeKey: getArchetypeFromScore(results.psriScore),
        
        // Lead info (if provided)
        firstName: formData.firstName || '',
        lastName: formData.lastName || '',
        email: formData.workEmail || '',
        company: formData.company || '',
        companySize: formData.companySize || '',
        regulatoryEnv: formData.regulatoryEnv || '',
        role: formData.role || '',
        context: formData.context || '',
        
        // Raw answers for detailed analysis
        answers: JSON.stringify(answers)
      };
    }
    
    function setAssessmentType(type) {
      assessmentType = type;
      const baselineOption = document.getElementById('baseline-option');
      const followupOption = document.getElementById('followup-option');
      
      if (type === 'baseline') {
        baselineOption?.classList.add('selected');
        followupOption?.classList.remove('selected');
        baselineData = null;
      } else {
        baselineOption?.classList.remove('selected');
        followupOption?.classList.add('selected');
        
        // Attempt to lookup baseline if org domain is set
        const orgDomain = document.getElementById('org-domain')?.value;
        if (orgDomain) {
          lookupBaselineForOrg(orgDomain);
        }
      }
    }
    
    async function lookupBaselineForOrg(orgDomain) {
      const statusEl = document.getElementById('baseline-lookup-status');
      if (!statusEl) return;
      
      statusEl.style.display = 'block';
      statusEl.innerHTML = `
        <p style="font-size: 0.8rem; color: #93c5fd; display: flex; align-items: center; gap: 6px;">
          <span style="display: inline-block; width: 14px; height: 14px; border: 2px solid #93c5fd; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></span>
          Looking up previous assessment for ${orgDomain}...
        </p>
      `;
      
      const baseline = await lookupBaseline(orgDomain);
      
      if (baseline) {
        baselineData = baseline;
        statusEl.style.background = 'rgba(16, 185, 129, 0.15)';
        statusEl.style.borderColor = 'rgba(16, 185, 129, 0.3)';
        statusEl.innerHTML = `
          <p style="font-size: 0.8rem; color: #6ee7b7; display: flex; align-items: center; gap: 6px;">
            <i data-lucide="check-circle" style="width: 14px; height: 14px;"></i>
            Found baseline from ${new Date(baseline.timestamp).toLocaleDateString()}: PSRI ${baseline.psriScore}/100
          </p>
        `;
        createAccessibleIcons();
      } else {
        statusEl.style.background = 'rgba(251, 191, 36, 0.15)';
        statusEl.style.borderColor = 'rgba(251, 191, 36, 0.3)';
        statusEl.innerHTML = `
          <p style="font-size: 0.8rem; color: #fde047; display: flex; align-items: center; gap: 6px;">
            <i data-lucide="alert-circle" style="width: 14px; height: 14px;"></i>
            No previous assessment found. This will be saved as your baseline.
          </p>
        `;
        assessmentType = 'baseline';
        document.querySelector('input[value="baseline"]').checked = true;
        setAssessmentType('baseline');
        createAccessibleIcons();
      }
    }
    
    // Add CSS for spinner animation
    const spinnerStyle = document.createElement('style');
    spinnerStyle.textContent = '@keyframes spin { to { transform: rotate(360deg); } }';
    document.head.appendChild(spinnerStyle);


    function renderQuestion() {
      if (currentQuestionIndex >= filteredQuestions.length) {
        announce('Assessment complete. Loading your results.');
        calculateResults();
        return;
      }

      const question = filteredQuestions[currentQuestionIndex];
      const questionNum = currentQuestionIndex + 1;
      const totalQuestions = filteredQuestions.length;
      trackEvent('question_view', { index: currentQuestionIndex, category: question.category, total: totalQuestions, role: selectedRole });
      const progress = (questionNum / totalQuestions) * 100;
      
      document.getElementById('progress-text').textContent = `${Math.round(progress)}%`;
      document.getElementById('progress-bar').style.width = `${progress}%`;
      
      // Update progress step indicators
      updateProgressSteps(question.category);
      
      // Update ARIA for progress bar
      updateProgressAria(progress, question.category);
      
      // Announce question to screen readers
      announce(`Question ${questionNum} of ${totalQuestions}. ${question.category}. ${question.question}`);

      const categoryColors = {
        'Product System Foundation': { bg: 'rgba(16, 185, 129, 0.15)', border: 'rgba(16, 185, 129, 0.3)', text: 'var(--spectrum-green-400)', icon: 'layers' },
        'Governance & Adoption': { bg: 'rgba(59, 130, 246, 0.15)', border: 'rgba(59, 130, 246, 0.3)', text: 'var(--spectrum-blue-400)', icon: 'shield' },
        'Delivery Workflow': { bg: 'rgba(251, 191, 36, 0.15)', border: 'rgba(251, 191, 36, 0.3)', text: 'var(--spectrum-amber-400)', icon: 'zap' },
        'AI Readiness': { bg: 'rgba(139, 92, 246, 0.15)', border: 'rgba(139, 92, 246, 0.3)', text: 'var(--spectrum-purple-400)', icon: 'sparkles' },
        'Culture & Contribution': { bg: 'rgba(251, 146, 60, 0.15)', border: 'rgba(251, 146, 60, 0.3)', text: '#fb923c', icon: 'users' },
        'Multi-System Architecture': { bg: 'rgba(14, 165, 233, 0.15)', border: 'rgba(14, 165, 233, 0.3)', text: '#0ea5e9', icon: 'network' },
        'Deployment': { bg: 'rgba(255,255,255,0.05)', border: 'rgba(255,255,255,0.1)', text: 'var(--spectrum-text-secondary)', icon: 'server' }
      };

      const colorStyle = categoryColors[question.category] || categoryColors['Deployment'];
      const isMultiSelect = question.category === 'Deployment';

      const optionsHtml = question.options.map((opt, idx) => {
        const selectedValues = Array.isArray(answers[currentQuestionIndex]) ? answers[currentQuestionIndex] : [];
        const isSelected = isMultiSelect ? selectedValues.includes(opt.value) : answers[currentQuestionIndex] === opt.value;
        return `
          <button
            onclick="${isMultiSelect ? `toggleMultiOption(${idx})` : `selectOption(${idx})`}"
            class="option-card ${isSelected ? 'selected' : ''}"
            role="${isMultiSelect ? 'checkbox' : 'radio'}"
            aria-checked="${isSelected}"
            id="option-${idx}"
          >
            <div class="flex items-center justify-between gap-2">
              <span class="text-base">${opt.text}</span>
              ${isSelected ? '<i data-lucide="check-circle" style="width: 20px; height: 20px; color: var(--spectrum-purple-400); flex-shrink: 0;" aria-hidden="true"></i>' : '<div style="width: 20px; height: 20px; border: 2px solid var(--spectrum-border-default); border-radius: 50%; flex-shrink: 0;" aria-hidden="true"></div>'}
            </div>
          </button>
        `;
      }).join('');

      const questionId = `question-${currentQuestionIndex}`;
      const helperId = question.helper ? `helper-${currentQuestionIndex}` : '';
      
      document.getElementById('question-container').innerHTML = `
        <div class="card fade-in" role="region" aria-labelledby="${questionId}">
          <div class="flex items-center gap-2 mb-3">
            <span class="category-badge" style="background: ${colorStyle.bg}; color: ${colorStyle.text};" aria-hidden="true">
              <i data-lucide="${colorStyle.icon}" style="width: 14px; height: 14px; margin-right: 6px;" aria-hidden="true"></i>
              ${question.category}
            </span>
            ${question.weight > 0 ? `<span class="text-sm text-muted" aria-hidden="true">${question.weight} points max</span>` : ''}
          </div>
          <p class="sr-only">Question ${questionNum} of ${totalQuestions}, ${question.category} section</p>
          <h2 id="${questionId}" class="mb-2" style="font-size: var(--spectrum-font-size-500);" tabindex="-1">${question.question}</h2>
          ${question.helper ? `<p class="question-helper" id="${helperId}">${question.helper}</p>` : ''}
          <p class="question-instruction" id="instruction-${currentQuestionIndex}">${isMultiSelect ? 'Select all that apply. Press Tab to navigate options, Space or Enter to select.' : 'Select one option. Press Tab to navigate options, Enter to select.'}</p>
          <div class="flex flex-col gap-2" role="${isMultiSelect ? 'group' : 'radiogroup'}" aria-labelledby="${questionId}" ${helperId ? `aria-describedby="${helperId} instruction-${currentQuestionIndex}"` : `aria-describedby="instruction-${currentQuestionIndex}"`}>${optionsHtml}</div>
          ${isMultiSelect ? `
            <button onclick="advanceFromMultiSelect()" class="btn btn-primary mt-3">
              Continue
              <i data-lucide="arrow-right" style="width: 16px; height: 16px;" aria-hidden="true"></i>
            </button>
          ` : ''}
          ${currentQuestionIndex > 0 ? `
            <button onclick="goBack()" class="btn btn-quiet mt-3">
              <i data-lucide="arrow-left" style="width: 16px; height: 16px;" aria-hidden="true"></i>
              Previous question
            </button>
          ` : ''}
        </div>
      `;

      createAccessibleIcons();
      
      // Focus the question heading for screen readers
      setTimeout(() => {
        const heading = document.getElementById(questionId);
        if (heading) heading.focus();
      }, 100);
    }

    function selectOption(index) {
      const question = filteredQuestions[currentQuestionIndex];
      const option = question.options[index];
      
      answers[currentQuestionIndex] = option.value;
      trackEvent('option_select', { index: currentQuestionIndex, category: question.category, value: option.value, role: selectedRole });
      
      if (option.tier) {
        deploymentTier = option.tier;
      }
      
      // Announce selection for screen readers
      announce(`Selected: ${option.text}. Moving to next question.`);
      
      currentQuestionIndex++;
      setTimeout(() => renderQuestion(), 300);
    }

    function toggleMultiOption(index) {
      const question = filteredQuestions[currentQuestionIndex];
      const option = question.options[index];
      const selectedValues = Array.isArray(answers[currentQuestionIndex]) ? [...answers[currentQuestionIndex]] : [];
      const existingIndex = selectedValues.indexOf(option.value);

      if (existingIndex >= 0) {
        selectedValues.splice(existingIndex, 1);
        announce(`Deselected: ${option.text}. ${selectedValues.length} options selected.`);
      } else {
        selectedValues.push(option.value);
        announce(`Selected: ${option.text}. ${selectedValues.length} options selected.`);
      }

      trackEvent('option_toggle', { index: currentQuestionIndex, category: question.category, value: option.value, selected: existingIndex < 0 });
      answers[currentQuestionIndex] = selectedValues;
      renderQuestion();
    }

    function advanceFromMultiSelect() {
      const question = filteredQuestions[currentQuestionIndex];
      const selectedValues = Array.isArray(answers[currentQuestionIndex]) ? answers[currentQuestionIndex] : [];
      const tierPriority = { D1: 1, D2: 2, D3: 3, D4: 4 };

      if (selectedValues.length === 0) {
        answers[currentQuestionIndex] = ['unknown'];
        deploymentTier = 'D1';
      } else {
        const selectedOptions = question.options.filter(opt => selectedValues.includes(opt.value));
        const highestTier = selectedOptions.reduce((highest, opt) => {
          if (!opt.tier) return highest;
          if (!highest) return opt.tier;
          return tierPriority[opt.tier] > tierPriority[highest] ? opt.tier : highest;
        }, null);
        deploymentTier = highestTier || 'D1';
      }

      currentQuestionIndex++;
      trackEvent('multi_select_continue', { index: currentQuestionIndex - 1, category: question.category, selected: selectedValues });
      setTimeout(() => renderQuestion(), 300);
    }

    function goBack() {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        delete answers[currentQuestionIndex];
        renderQuestion();
      }
    }

    function calculateResults() {
      let foundationScore = 0;
      let foundationMaxWeighted = 0;
      let aiScore = 0;
      let aiMaxWeighted = 0;
      let orgScore = 0;
      let orgMaxWeighted = 0;
      let deliveryScore = 0;
      let deliveryMaxWeighted = 0;
      let cultureScore = 0;
      let cultureMaxWeighted = 0;
      let multiSystemScore = 0;
      let multiSystemMaxWeighted = 0;

      // Use filtered questions based on role
      filteredQuestions.forEach((q, idx) => {
        if (q.category === 'Deployment') return;
        
        // Get weight from original question index if available, else default
        const originalIdx = questions.indexOf(q);
        const weight = questionWeights[originalIdx] || 1.0;
        const answerValue = answers[idx];
        const selectedOption = q.options.find(opt => opt.value === answerValue);
        const maxScore = Math.max(...q.options.map(o => o.score));
        
        if (q.category === 'Product System Foundation') {
          foundationMaxWeighted += maxScore * weight;
          if (selectedOption) foundationScore += selectedOption.score * weight;
        } else if (q.category === 'AI Readiness') {
          aiMaxWeighted += maxScore * weight;
          if (selectedOption) aiScore += selectedOption.score * weight;
        } else if (q.category === 'Governance & Adoption') {
          orgMaxWeighted += maxScore * weight;
          if (selectedOption) orgScore += selectedOption.score * weight;
        } else if (q.category === 'Delivery Workflow') {
          deliveryMaxWeighted += maxScore * weight;
          if (selectedOption) deliveryScore += selectedOption.score * weight;
        } else if (q.category === 'Culture & Contribution') {
          cultureMaxWeighted += maxScore * weight;
          if (selectedOption) cultureScore += selectedOption.score * weight;
        } else if (q.category === 'Multi-System Architecture') {
          multiSystemMaxWeighted += maxScore * weight;
          if (selectedOption) multiSystemScore += selectedOption.score * weight;
        }
      });

      // Normalize each pillar to 0-100 scale (raw scores before gating)
      const foundationNormRaw = foundationMaxWeighted > 0 ? Math.round((foundationScore / foundationMaxWeighted) * 100) : 0;
      const aiNormRaw = aiMaxWeighted > 0 ? Math.round((aiScore / aiMaxWeighted) * 100) : 0;
      const orgNormRaw = orgMaxWeighted > 0 ? Math.round((orgScore / orgMaxWeighted) * 100) : 0;
      const deliveryNormRaw = deliveryMaxWeighted > 0 ? Math.round((deliveryScore / deliveryMaxWeighted) * 100) : 0;
      const cultureNormRaw = cultureMaxWeighted > 0 ? Math.round((cultureScore / cultureMaxWeighted) * 100) : 0;
      
      // Multi-System score (calculated separately, not part of PSRI)
      const multiSystemNorm = multiSystemMaxWeighted > 0 ? Math.round((multiSystemScore / multiSystemMaxWeighted) * 100) : null;
      systemOfSystemsScore = multiSystemNorm || 0;
      
      // Apply gated progression logic
      // AI Readiness is discounted if Foundation is below threshold
      // Delivery is discounted if Governance is below threshold
      // Culture gates the overall PSRI multiplier
      let foundationNorm = foundationNormRaw;
      let aiNorm = aiNormRaw;
      let orgNorm = orgNormRaw;
      let deliveryNorm = deliveryNormRaw;
      let cultureNorm = cultureNormRaw;
      let gatingApplied = { ai: false, delivery: false };
      
      if (GATED_PROGRESSION.enabled) {
        // Gate 1: Foundation gates AI Readiness
        if (foundationNormRaw < GATED_PROGRESSION.foundationThreshold) {
          aiNorm = Math.round(aiNormRaw * GATED_PROGRESSION.aiDiscountFactor);
          gatingApplied.ai = true;
        }
        
        // Gate 2: Governance gates Delivery
        if (orgNormRaw < GATED_PROGRESSION.governanceThreshold) {
          deliveryNorm = Math.round(deliveryNormRaw * GATED_PROGRESSION.deliveryDiscountFactor);
          gatingApplied.delivery = true;
        }
      }

      // Calculate PSRI (Product System Readiness Index) using weighted pillars
      // Uses gated scores for composite, raw scores stored separately for transparency
      psriScore = Math.round(
        (foundationNorm * PSRI_WEIGHTS.foundation) +
        (aiNorm * PSRI_WEIGHTS.ai) +
        (orgNorm * PSRI_WEIGHTS.governance) +
        (deliveryNorm * PSRI_WEIGHTS.delivery) +
        (cultureNorm * PSRI_WEIGHTS.culture)
      );

      // Legacy total for backward compatibility (raw points)
      const totalScore = psriScore;
      
      // Map normalized scores back to display ranges for UI
      const foundationDisplay = Math.round((foundationNorm / 100) * 20);
      const aiDisplay = Math.round((aiNorm / 100) * 20);
      const orgDisplay = Math.round((orgNorm / 100) * 20);
      const deliveryDisplay = Math.round((deliveryNorm / 100) * 15);
      const cultureDisplay = Math.round((cultureNorm / 100) * 25);

      // Determine Investment Path based on PSRI and pillar scores
      // Now also considers culture as a key factor
      recommendedPath = 'J1';
      
      if (psriScore >= 75 && foundationNorm >= 70 && orgNorm >= 60 && cultureNorm >= 60) {
        recommendedPath = 'J4';
      } else if (psriScore >= 55 && foundationNorm >= 60 && orgNorm >= 55 && cultureNorm >= 50) {
        recommendedPath = 'J3';
      } else if (psriScore >= 45 && orgNorm >= 50 && cultureNorm >= 40) {
        recommendedPath = 'J2';
      } else {
        recommendedPath = 'J1';
      }

      // Store results with both normalized and display values
      pendingResults = { 
        foundationScore: foundationDisplay, 
        aiScore: aiDisplay, 
        orgScore: orgDisplay, 
        deliveryScore: deliveryDisplay,
        cultureScore: cultureDisplay,
        totalScore,
        // Normalized values (0-100) for each pillar (after gating)
        foundationNorm,
        aiNorm,
        orgNorm,
        deliveryNorm,
        cultureNorm,
        // Raw normalized values (before gating) for transparency
        foundationNormRaw,
        aiNormRaw,
        orgNormRaw,
        deliveryNormRaw,
        cultureNormRaw,
        // Gating info
        gatingApplied,
        psriScore,
        psriVersion: PSRI_VERSION,
        // Multi-System Architecture score (only for multi-system orgs)
        multiSystemNorm,
        systemLandscape: selectedSystemLandscape,
        isMultiSystem: SYSTEM_LANDSCAPE_CONFIG[selectedSystemLandscape]?.showMultiSystemQuestions || false
      };
      
      trackEvent('assessment_complete', { 
        psriScore,
        psriVersion: PSRI_VERSION,
        foundationNorm, 
        aiNorm, 
        orgNorm, 
        deliveryNorm,
        cultureNorm,
        foundationNormRaw,
        aiNormRaw,
        orgNormRaw,
        deliveryNormRaw,
        cultureNormRaw,
        gatingApplied: JSON.stringify(gatingApplied),
        recommendedPath, 
        deploymentTier,
        assessmentType,
        organizationId,
        systemLandscape: selectedSystemLandscape,
        multiSystemNorm: multiSystemNorm || 0,
        isMultiSystem: SYSTEM_LANDSCAPE_CONFIG[selectedSystemLandscape]?.showMultiSystemQuestions || false,
        toolStack: selectedTools.join(','),
        toolGap: analyzeToolStack()?.gap || 'none'
      });
      
      document.getElementById('assessment-container').style.display = 'none';
      document.getElementById('results-container').style.display = 'block';
      document.getElementById('lead-form-container').style.display = 'block';
      document.getElementById('results-content').style.display = 'none';
      renderResultsPreview(pendingResults);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function renderProgressReport(results) {
      const progressEl = document.getElementById('progress-report');
      if (!progressEl || !baselineData) {
        progressEl.style.display = 'none';
        return;
      }
      
      const psriDelta = results.psriScore - (baselineData.psriScore || 0);
      const foundationDelta = results.foundationNorm - (baselineData.foundationNorm || 0);
      const aiDelta = results.aiNorm - (baselineData.aiNorm || 0);
      const govDelta = results.orgNorm - (baselineData.governanceNorm || 0);
      const deliveryDelta = results.deliveryNorm - (baselineData.deliveryNorm || 0);
      
      const formatDelta = (val) => val >= 0 ? `+${val}` : `${val}`;
      const deltaColor = (val) => val > 0 ? '#6ee7b7' : val < 0 ? '#f87171' : 'rgba(255,255,255,0.6)';
      const deltaIcon = (val) => val > 0 ? 'trending-up' : val < 0 ? 'trending-down' : 'minus';
      
      const baselineDate = new Date(baselineData.timestamp).toLocaleDateString('en-US', { 
        year: 'numeric', month: 'short', day: 'numeric' 
      });
      
      progressEl.style.display = 'block';
      progressEl.innerHTML = `
        <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px; color: #fff;">
          <i data-lucide="git-compare" style="width: 20px; height: 20px; color: #6ee7b7;"></i>
          Progress Since Baseline (${baselineDate})
        </h3>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 20px;">
          <div class="content-box" style="background: rgba(255,255,255,0.05); text-align: center; padding: 24px;">
            <p style="font-size: 0.75rem; color: rgba(255,255,255,0.6); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px;">PSRI Change</p>
            <div style="display: flex; align-items: center; justify-content: center; gap: 12px;">
              <span style="font-size: 2.5rem; font-weight: 700; color: ${deltaColor(psriDelta)};">${formatDelta(psriDelta)}</span>
              <i data-lucide="${deltaIcon(psriDelta)}" style="width: 32px; height: 32px; color: ${deltaColor(psriDelta)};"></i>
            </div>
            <p style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-top: 8px;">
              ${baselineData.psriScore} → ${results.psriScore}
            </p>
          </div>
          
          <div class="content-box" style="background: rgba(255,255,255,0.05); padding: 16px;">
            <p style="font-size: 0.75rem; color: rgba(255,255,255,0.6); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px;">Archetype Movement</p>
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="padding: 8px 12px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                <span style="font-size: 0.8rem; color: rgba(255,255,255,0.7);">${baselineData.archetype || 'Foundation Builder'}</span>
              </div>
              <i data-lucide="arrow-right" style="width: 20px; height: 20px; color: rgba(255,255,255,0.5);"></i>
              <div style="padding: 8px 12px; background: rgba(100, 54, 191, 0.3); border-radius: 8px; border: 1px solid #6436bf;">
                <span style="font-size: 0.8rem; font-weight: 600; color: #fff;">${archetypeDetails[getArchetypeFromScore(results.psriScore)]?.name || 'Foundation Builder'}</span>
              </div>
            </div>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
          ${[
            { label: 'Foundation', baseline: baselineData.foundationNorm, current: results.foundationNorm, delta: foundationDelta },
            { label: 'AI Readiness', baseline: baselineData.aiNorm, current: results.aiNorm, delta: aiDelta },
            { label: 'Governance', baseline: baselineData.governanceNorm, current: results.orgNorm, delta: govDelta },
            { label: 'Delivery', baseline: baselineData.deliveryNorm, current: results.deliveryNorm, delta: deliveryDelta }
          ].map(pillar => `
            <div class="content-box" style="text-align: center;">
              <p style="font-size: 0.85rem; color: rgba(255,255,255,0.5); margin-bottom: 6px;">${pillar.label}</p>
              <div style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                <span style="font-size: 1.1rem; font-weight: 700; color: ${deltaColor(pillar.delta)};">${formatDelta(pillar.delta)}</span>
                <i data-lucide="${deltaIcon(pillar.delta)}" style="width: 14px; height: 14px; color: ${deltaColor(pillar.delta)};"></i>
              </div>
              <p style="font-size: 0.85rem; color: rgba(255,255,255,0.5); margin-top: 4px;">${pillar.baseline || 0}% → ${pillar.current}%</p>
            </div>
          `).join('')}
        </div>
        
        <div style="margin-top: 16px; padding: 12px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.3);">
          <p style="font-size: 0.8rem; color: #6ee7b7;">
            ${psriDelta > 10 
              ? '🎉 Significant progress! Your organization has made measurable improvements across key dimensions.' 
              : psriDelta > 0 
              ? '📈 Positive movement. Continue focusing on your weakest pillar to accelerate progress.'
              : psriDelta === 0
              ? '➡️ Score unchanged. Review recommendations below to identify quick wins.'
              : '⚠️ Score decreased. This may indicate organizational changes or more accurate self-assessment.'}
          </p>
        </div>
      `;
      
      createAccessibleIcons();
    }

    function renderResults(results) {
      if (!results) return;

      const { foundationScore, aiScore, orgScore, deliveryScore, cultureScore, totalScore } = results;
      const archetypeKey = getArchetypeFromScore(results.psriScore || totalScore);
      const archetype = archetypeDetails[archetypeKey];

      document.getElementById('lead-form-container').style.display = 'none';
      document.getElementById('results-content').style.display = 'block';
      trackEvent('results_reveal', { totalScore, psriScore: results.psriScore, recommendedPath, deploymentTier, assessmentType, organizationId });
      
      // Announce results for screen readers
      const displayPsriValue = results.psriScore || totalScore;
      announce(`Your assessment results are ready. Your Product System Readiness Index score is ${displayPsriValue} out of 100. Your maturity stage is ${archetype.name}.`, true);
      
      // Focus results container for screen readers
      setFocus('#results-content');
      
      // Render progress report if follow-up assessment
      if (assessmentType === 'follow-up' && baselineData) {
        renderProgressReport(results);
      }
      
      // Get normalized values (or calculate from display if not present)
      const foundationNorm = results.foundationNorm || Math.round((foundationScore / 20) * 100);
      const aiNorm = results.aiNorm || Math.round((aiScore / 20) * 100);
      const orgNorm = results.orgNorm || Math.round((orgScore / 20) * 100);
      const deliveryNorm = results.deliveryNorm || Math.round((deliveryScore / 15) * 100);
      const cultureNorm = results.cultureNorm || Math.round((cultureScore / 25) * 100);
      const displayPsri = results.psriScore || totalScore;
      
      // PSRI Display with animation
      animateCounter(document.getElementById('psri-display'), displayPsri, 1200);
      document.getElementById('overall-score').textContent = totalScore;
      document.getElementById('readiness-tier').textContent = archetype.shortName;
      
      // Trigger staggered card animations
      setTimeout(() => animateResultCards(), 200);
      
      // Animate PSRI ring
      const psriRing = document.getElementById('psri-ring');
      if (psriRing) {
        setTimeout(() => {
          psriRing.style.strokeDasharray = `${displayPsri}, 100`;
          psriRing.style.transition = 'stroke-dasharray 1s ease-out';
        }, 100);
      }
      
      const benchmarkData = generateBenchmarkComparison(displayPsri, foundationScore, aiScore, orgScore, recommendedPath, selectedIndustry);
      document.getElementById('benchmark-label').textContent = getBenchmarkLabel(displayPsri, benchmarkData);
      
      // Pillar scores with animation
      animateCounter(document.getElementById('foundation-score'), foundationScore, 800);
      animateCounter(document.getElementById('ai-score'), aiScore, 900);
      animateCounter(document.getElementById('org-score'), orgScore, 1000);
      animateCounter(document.getElementById('delivery-score'), deliveryScore, 1100);
      animateCounter(document.getElementById('culture-score'), cultureScore, 1200);
      
      // Normalized percentages
      const foundationNormEl = document.getElementById('foundation-norm');
      if (foundationNormEl) foundationNormEl.textContent = `${foundationNorm}%`;
      const aiNormEl = document.getElementById('ai-norm');
      if (aiNormEl) aiNormEl.textContent = `${aiNorm}%`;
      const orgNormEl = document.getElementById('org-norm');
      if (orgNormEl) orgNormEl.textContent = `${orgNorm}%`;
      const deliveryNormEl = document.getElementById('delivery-norm');
      if (deliveryNormEl) deliveryNormEl.textContent = `${deliveryNorm}%`;
      const cultureNormEl = document.getElementById('culture-norm');
      if (cultureNormEl) cultureNormEl.textContent = `${cultureNorm}%`;
      
      // Progress bars
      setTimeout(() => {
        const foundationBar = document.getElementById('foundation-bar');
        if (foundationBar) foundationBar.style.width = `${foundationNorm}%`;
        const aiBar = document.getElementById('ai-bar');
        if (aiBar) aiBar.style.width = `${aiNorm}%`;
        const orgBar = document.getElementById('org-bar');
        if (orgBar) orgBar.style.width = `${orgNorm}%`;
        const deliveryBar = document.getElementById('delivery-bar');
        if (deliveryBar) deliveryBar.style.width = `${deliveryNorm}%`;
        const cultureBar = document.getElementById('culture-bar');
        if (cultureBar) cultureBar.style.width = `${cultureNorm}%`;
      }, 200);
      
      // Organization ID display
      if (organizationId) {
        const orgBadge = document.getElementById('org-id-badge');
        const orgDisplay = document.getElementById('org-id-display');
        if (orgBadge && orgDisplay) {
          orgBadge.style.display = 'block';
          orgDisplay.textContent = organizationId;
        }
      }
      
      // =========================================================================
      // NEW: Executive Summary, Maturity Journey, Priority Actions, Multi-System
      // =========================================================================
      
      // Executive Summary
      renderExecutiveSummary(displayPsri, archetype, archetypeKey, foundationNorm, aiNorm, orgNorm, deliveryNorm, cultureNorm, benchmarkData);
      
      // Maturity Journey Timeline
      renderMaturityJourney(displayPsri, archetypeKey);
      
      // Priority Actions
      renderPriorityActions(foundationNorm, aiNorm, orgNorm, deliveryNorm, cultureNorm, displayPsri);
      
      // Multi-System Maturity Map (only for multi-system organizations)
      if (results.isMultiSystem && results.multiSystemNorm !== null) {
        renderMultiSystemMap(results.multiSystemNorm, results.systemLandscape, foundationNorm, aiNorm, orgNorm, cultureNorm);
      }
      
      // Tool Stack Insights (if tools were selected)
      if (selectedTools.length > 0) {
        renderToolStackInsights();
      }
      
      document.getElementById('tier-outcome').textContent = getTierOutcome(displayPsri);
      document.getElementById('ai-readiness-status').textContent = getAiReadinessStatus(foundationNorm, aiNorm);

      // Archetype-based color mapping
      const archetypeColorMap = {
        'builder': { bg: 'rgba(239, 68, 68, 0.1)', border: 'rgba(239, 68, 68, 0.3)', text: '#fca5a5', badge: '#ef4444' },
        'adopter': { bg: 'rgba(251, 191, 36, 0.1)', border: 'rgba(251, 191, 36, 0.3)', text: '#fde047', badge: '#fbbf24' },
        'optimizer': { bg: 'rgba(59, 130, 246, 0.1)', border: 'rgba(59, 130, 246, 0.3)', text: '#93c5fd', badge: '#3b82f6' },
        'transformer': { bg: 'rgba(16, 185, 129, 0.1)', border: 'rgba(16, 185, 129, 0.3)', text: '#6ee7b7', badge: '#10b981' }
      };
      const archetypeColor = archetypeColorMap[archetypeKey] || archetypeColorMap.builder;

      // Benchmark Comparison
      
      const benchmarkStory = getBenchmarkStory(foundationScore, aiScore, orgScore);
      const nextBestInvestment = getNextBestInvestment(foundationScore, aiScore, orgScore, recommendedPath);
      document.getElementById('benchmark-comparison').innerHTML = `
        <h3 style="font-size: 1.125rem; font-weight: 700; color: #fff; margin-bottom: 16px;">
          How You Compare to Similar Organizations
        </h3>
        <div class="content-box" style="margin-bottom: 16px;">
          <p style="font-size: 0.75rem; color: rgba(255,255,255,0.6); margin-bottom: 6px;">Industry benchmark: ${benchmarkData.industryLabel}</p>
          <p style="font-size: 0.875rem; color: rgba(255,255,255,0.85); margin-bottom: 8px;">${benchmarkStory}</p>
          <p style="font-size: 0.875rem; font-weight: 600; color: #e0d4f7;">Most valuable next step: ${nextBestInvestment}</p>
          <p style="font-size: 0.85rem; color: rgba(255,255,255,0.55); margin-top: 8px;">Benchmarks calibrated from 158 enterprise records (Jan 2026).</p>
        </div>
        <div style="display: flex; flex-direction: column; gap: 16px;">
          <div style="background: rgba(59, 130, 246, 0.15); border-radius: 12px; padding: 16px; border: 1px solid rgba(59, 130, 246, 0.3);">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
              <p style="font-weight: 600; color: #93c5fd;">Your Overall Score</p>
              <p style="font-size: 1.5rem; font-weight: 700; color: #93c5fd;">${totalScore}/100</p>
            </div>
            <div style="display: flex; flex-direction: column; gap: 8px;">
              <div style="display: flex; align-items: center; justify-content: space-between; font-size: 0.875rem;">
                <span style="color: rgba(255,255,255,0.6);">Industry Average</span>
                <span style="font-weight: 500; color: rgba(255,255,255,0.8);">${benchmarkData.industryAvg}/100</span>
              </div>
              <div style="height: 8px; background: rgba(59, 130, 246, 0.2); border-radius: 9999px; overflow: hidden;">
                <div style="height: 100%; background: #60a5fa; width: ${benchmarkData.industryAvg}%"></div>
              </div>
              <div style="display: flex; align-items: center; justify-content: space-between; font-size: 0.875rem;">
                <span style="color: rgba(255,255,255,0.6);">Top Quartile</span>
                <span style="font-weight: 500; color: rgba(255,255,255,0.8);">${benchmarkData.topQuartile}/100</span>
              </div>
              <div style="height: 8px; background: rgba(59, 130, 246, 0.2); border-radius: 9999px; overflow: hidden;">
                <div style="height: 100%; background: #3b82f6; width: ${benchmarkData.topQuartile}%"></div>
              </div>
            </div>
            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(59, 130, 246, 0.3);">
              <p style="font-size: 0.75rem; color: #93c5fd;">
                <span style="font-weight: 600;">${benchmarkData.comparison}</span> ${benchmarkData.comparisonDetail}
              </p>
            </div>
          </div>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
            <div class="content-box">
              <p style="font-size: 0.75rem; color: rgba(255,255,255,0.5); margin-bottom: 4px;">Foundation</p>
              <p style="font-size: 0.875rem; font-weight: 600; color: #fff;">${foundationScore >= 30 ? 'Top 25%' : foundationScore >= 20 ? 'Top 50%' : foundationScore >= 10 ? 'Bottom 50%' : 'Bottom 25%'}</p>
            </div>
            <div class="content-box">
              <p style="font-size: 0.75rem; color: rgba(255,255,255,0.5); margin-bottom: 4px;">AI Readiness</p>
              <p style="font-size: 0.875rem; font-weight: 600; color: #fff;">${aiScore >= 20 ? 'Top 25%' : aiScore >= 10 ? 'Top 50%' : aiScore >= 5 ? 'Bottom 50%' : 'Bottom 25%'}</p>
            </div>
            <div class="content-box">
              <p style="font-size: 0.75rem; color: rgba(255,255,255,0.5); margin-bottom: 4px;">Org Readiness</p>
              <p style="font-size: 0.875rem; font-weight: 600; color: #fff;">${orgScore >= 20 ? 'Top 25%' : orgScore >= 10 ? 'Top 50%' : orgScore >= 5 ? 'Bottom 50%' : 'Bottom 25%'}</p>
            </div>
          </div>
          <div class="content-box">
            <p style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">
              <span style="font-weight: 600;">Based on analysis of 50+ enterprise organizations</span> including PNC, Edward Jones, The Home Depot, CSX, and others across Financial Services, Retail, Technology, and Healthcare industries.
            </p>
          </div>
        </div>
      `;

      createAccessibleIcons();
    }

    // Methodology Modal
    // Store reference to element that opened modal for focus restoration
    let modalTriggerElement = null;
    
    function showMethodology() {
      // Store reference to trigger element for focus restoration
      modalTriggerElement = document.activeElement;
      
      const modal = document.createElement('div');
      modal.id = 'methodology-modal';
      modal.setAttribute('role', 'dialog');
      modal.setAttribute('aria-modal', 'true');
      modal.setAttribute('aria-labelledby', 'methodology-title');
      modal.setAttribute('aria-describedby', 'methodology-desc');
      modal.style.cssText = 'position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 24px;';
      
      // Handle backdrop click
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeMethodology();
      });
      
      // Handle escape key
      modal.addEventListener('keydown', handleModalKeydown);
      
      modal.innerHTML = `
        <div class="modal-content" style="background: var(--spectrum-bg-layer-1); border-radius: var(--spectrum-radius-xl); max-width: 720px; max-height: 90vh; overflow-y: auto; padding: 32px; border: 1px solid var(--spectrum-border-default); box-shadow: var(--spectrum-shadow-xl);">
          <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px;">
            <div>
              <h2 id="methodology-title" style="color: var(--spectrum-text-primary); font-size: var(--spectrum-font-size-700); margin-bottom: 8px;">PSRI Methodology</h2>
              <p id="methodology-desc" style="color: var(--spectrum-text-tertiary); font-size: var(--spectrum-font-size-200);">How we calculate your Product System Readiness Index</p>
            </div>
            <button id="modal-close-btn" onclick="closeMethodology()" style="background: transparent; border: none; color: var(--spectrum-text-secondary); cursor: pointer; padding: 8px; border-radius: var(--spectrum-radius-md);" aria-label="Close methodology modal">
              <i data-lucide="x" style="width: 24px; height: 24px;" aria-hidden="true"></i>
            </button>
          </div>
          
          <div style="margin-bottom: 24px;">
            <h3 style="color: var(--spectrum-purple-400); font-size: var(--spectrum-font-size-400); margin-bottom: 12px;">Five Pillars of Readiness</h3>
            <p style="color: var(--spectrum-text-secondary); font-size: var(--spectrum-font-size-300); margin-bottom: 16px;">
              The PSRI measures maturity across five interconnected dimensions. Culture is weighted highest because research from DORA, Google, and Sparkbox shows it's the #1 predictor of design system success:
            </p>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
              <div style="background: rgba(110, 231, 183, 0.1); border: 1px solid rgba(110, 231, 183, 0.3); border-radius: 8px; padding: 16px;">
                <p style="color: var(--spectrum-green-400); font-weight: 600; margin-bottom: 4px;">Foundation (20%)</p>
                <p style="color: var(--spectrum-text-tertiary); font-size: 0.875rem;">Component library maturity, design tokens, documentation, and accessibility. Aligned with Sparkbox maturity stages and EightShapes governance models.</p>
              </div>
              <div style="background: rgba(196, 181, 253, 0.1); border: 1px solid rgba(196, 181, 253, 0.3); border-radius: 8px; padding: 16px;">
                <p style="color: var(--spectrum-purple-300); font-weight: 600; margin-bottom: 4px;">AI Readiness (20%)</p>
                <p style="color: var(--spectrum-text-tertiary); font-size: 0.875rem;">Metadata structure, API maturity, and AI governance. Draws on NIST AI RMF and MIT Sloan AI@Scale research.</p>
              </div>
              <div style="background: rgba(147, 197, 253, 0.1); border: 1px solid rgba(147, 197, 253, 0.3); border-radius: 8px; padding: 16px;">
                <p style="color: var(--spectrum-blue-400); font-weight: 600; margin-bottom: 4px;">Governance (20%)</p>
                <p style="color: var(--spectrum-text-tertiary); font-size: 0.875rem;">Executive sponsorship, investment, change capacity, and ROI measurement. Based on SVPG product operating model principles.</p>
              </div>
              <div style="background: rgba(253, 224, 71, 0.1); border: 1px solid rgba(253, 224, 71, 0.3); border-radius: 8px; padding: 16px;">
                <p style="color: var(--spectrum-amber-400); font-weight: 600; margin-bottom: 4px;">Delivery (15%)</p>
                <p style="color: var(--spectrum-text-tertiary); font-size: 0.875rem;">Workflow consistency, platform team patterns (Team Topologies), and DORA deployment metrics. Aligned with elite engineering performers.</p>
              </div>
              <div style="background: rgba(251, 146, 60, 0.1); border: 1px solid rgba(251, 146, 60, 0.3); border-radius: 8px; padding: 16px; grid-column: span 2;">
                <p style="color: #fb923c; font-weight: 600; margin-bottom: 4px;">Culture & Contribution (25%) ★</p>
                <p style="color: var(--spectrum-text-tertiary); font-size: 0.875rem;">Contribution model, psychological safety (Google Project Aristotle), information flow (Westrum culture model), and community health. Research consistently shows organizations with generative culture outperform those with only technical maturity.</p>
              </div>
            </div>
          </div>
          
          <div style="margin-bottom: 24px;">
            <h3 style="color: var(--spectrum-purple-400); font-size: var(--spectrum-font-size-400); margin-bottom: 12px;">Scoring Approach</h3>
            <ul style="color: var(--spectrum-text-secondary); font-size: var(--spectrum-font-size-300); padding-left: 20px; line-height: 1.8;">
              <li><strong>Research-validated weights:</strong> Question weights derived from DORA, Project Aristotle, and Sparkbox research on what matters most</li>
              <li><strong>Gated progression:</strong> AI Readiness scores are discounted if Foundation is below 40%—reflecting real-world dependencies</li>
              <li><strong>DORA-aligned delivery:</strong> Deployment frequency and platform maturity questions align with elite engineering benchmarks</li>
              <li><strong>Westrum culture model:</strong> Information flow and psychological safety questions identify generative vs. pathological cultures</li>
              <li><strong>Industry normalization:</strong> Scores are compared against peers in your industry vertical</li>
              <li><strong>Continuous calibration:</strong> Benchmarks updated from 50+ enterprise engagements</li>
            </ul>
          </div>
          
          <div style="margin-bottom: 24px;">
            <h3 style="color: var(--spectrum-purple-400); font-size: var(--spectrum-font-size-400); margin-bottom: 12px;">Research Foundation</h3>
            <p style="color: var(--spectrum-text-secondary); font-size: var(--spectrum-font-size-300); line-height: 1.6; margin-bottom: 16px;">
              The PSRI synthesizes insights from the most respected frameworks in design systems, product development, and enterprise AI:
            </p>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px;">
              <div style="background: rgba(110, 231, 183, 0.08); border-radius: 8px; padding: 14px; border-left: 3px solid var(--spectrum-green-400);">
                <p style="color: var(--spectrum-green-400); font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">Design System Maturity</p>
                <ul style="color: var(--spectrum-text-tertiary); font-size: 0.8rem; line-height: 1.5; padding-left: 14px; margin: 0;">
                  <li>Sparkbox Design Systems Survey (7+ years of research)</li>
                  <li>EightShapes governance models (Nathan Curtis)</li>
                  <li>Figma Business Case for Design Systems</li>
                  <li>UXPin/Whitespace Enterprise Report</li>
                </ul>
              </div>
              
              <div style="background: rgba(147, 197, 253, 0.08); border-radius: 8px; padding: 14px; border-left: 3px solid var(--spectrum-blue-400);">
                <p style="color: var(--spectrum-blue-400); font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">Product & Engineering</p>
                <ul style="color: var(--spectrum-text-tertiary); font-size: 0.8rem; line-height: 1.5; padding-left: 14px; margin: 0;">
                  <li>SVPG Product Operating Model (Marty Cagan)</li>
                  <li>Team Topologies platform patterns</li>
                  <li>DORA DevOps Research metrics</li>
                  <li>Google Project Aristotle research</li>
                </ul>
              </div>
              
              <div style="background: rgba(196, 181, 253, 0.08); border-radius: 8px; padding: 14px; border-left: 3px solid var(--spectrum-purple-400);">
                <p style="color: var(--spectrum-purple-400); font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">AI Readiness & Governance</p>
                <ul style="color: var(--spectrum-text-tertiary); font-size: 0.8rem; line-height: 1.5; padding-left: 14px; margin: 0;">
                  <li>NIST AI Risk Management Framework</li>
                  <li>MIT Sloan / BCG AI@Scale research</li>
                  <li>McKinsey AI Operating Models</li>
                  <li>Gartner AI Maturity Model</li>
                </ul>
              </div>
              
              <div style="background: rgba(251, 146, 60, 0.08); border-radius: 8px; padding: 14px; border-left: 3px solid #fb923c;">
                <p style="color: #fb923c; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">Culture & Collaboration</p>
                <ul style="color: var(--spectrum-text-tertiary); font-size: 0.8rem; line-height: 1.5; padding-left: 14px; margin: 0;">
                  <li>Westrum Organizational Culture model</li>
                  <li>Google Project Aristotle (psychological safety)</li>
                  <li>Atlassian & Spotify contribution practices</li>
                  <li>Nicole Forsgren, PhD (DORA co-author)</li>
                </ul>
              </div>
            </div>
            
            <!-- Multi-System Architecture Research -->
            <div style="background: rgba(14, 165, 233, 0.08); border-radius: 8px; padding: 14px; border-left: 3px solid #0ea5e9; margin-bottom: 16px;">
              <p style="color: #0ea5e9; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">Multi-System Architecture (Supplementary)</p>
              <p style="color: var(--spectrum-text-tertiary); font-size: 0.8rem; line-height: 1.5; margin-bottom: 12px;">
                For organizations with multiple design systems, brands, or use cases, we assess system coordination maturity based on:
              </p>
              <ul style="color: var(--spectrum-text-tertiary); font-size: 0.8rem; line-height: 1.5; padding-left: 14px; margin: 0;">
                <li><strong>EightShapes federated systems model</strong> (Nathan Curtis) - Tiered architectures with shared primitives</li>
                <li><strong>Salesforce Lightning Design System</strong> - Multi-brand theming via design tokens</li>
                <li><strong>IBM Carbon Design System</strong> - Component abstraction patterns for enterprise scale</li>
                <li><strong>Supernova Design System Intelligence</strong> - Cross-system governance automation</li>
                <li><strong>MIT CISR Enterprise AI Maturity</strong> - Multi-system AI coordination patterns</li>
              </ul>
              <p style="color: var(--spectrum-text-tertiary); font-size: 0.75rem; margin-top: 12px; padding-top: 8px; border-top: 1px solid rgba(14, 165, 233, 0.2);">
                Organizations with mature system-of-systems architectures report 40-60% faster multi-brand delivery and 30% reduction in duplicate maintenance effort.
              </p>
            </div>
            
            <p style="color: var(--spectrum-text-tertiary); font-size: var(--spectrum-font-size-200); line-height: 1.6; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px;">
              <strong style="color: var(--spectrum-text-secondary);">Why Culture is weighted highest (25%):</strong> Research from DORA, Google, and Sparkbox consistently shows that organizational culture—not technical sophistication—is the #1 predictor of long-term design system success. We've validated our scoring against outcomes from 50+ enterprise engagements across Financial Services, Healthcare, Retail, and Technology sectors.
            </p>
          </div>
          
          <div style="background: rgba(100, 54, 191, 0.1); border-radius: 8px; padding: 16px; text-align: center;">
            <p style="color: var(--spectrum-text-tertiary); font-size: var(--spectrum-font-size-200); margin-bottom: 8px;">Want the full methodology whitepaper?</p>
            <a href="mailto:ipe@knapsack.cloud?subject=PSRI Methodology Whitepaper Request" style="color: var(--spectrum-purple-400); font-weight: 600; text-decoration: underline;">Request access →</a>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      createAccessibleIcons();
      
      // Set focus to close button for accessibility
      const closeBtn = document.getElementById('modal-close-btn');
      if (closeBtn) {
        // Use setTimeout to ensure the modal is fully rendered
        setTimeout(() => closeBtn.focus(), 50);
      }
      
      // Announce to screen readers
      announceToScreenReader('PSRI Methodology dialog opened. Press Escape to close.');
      
      // Note: backdrop click and keydown handlers already added above
      
      trackEvent('methodology_viewed');
    }
    
    function closeMethodology() {
      const modal = document.getElementById('methodology-modal');
      if (modal) {
        modal.removeEventListener('keydown', handleModalKeydown);
        modal.remove();
      }
      // Restore focus to trigger element
      if (modalTriggerElement && modalTriggerElement.focus) {
        modalTriggerElement.focus();
        modalTriggerElement = null;
      }
    }
    
    function handleModalKeydown(e) {
      const modal = document.getElementById('methodology-modal');
      if (!modal) return;
      
      // Close on Escape
      if (e.key === 'Escape') {
        closeMethodology();
        return;
      }
      
      // Focus trap on Tab
      if (e.key === 'Tab') {
        const focusableElements = modal.querySelectorAll(
          'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
        );
        const firstFocusable = focusableElements[0];
        const lastFocusable = focusableElements[focusableElements.length - 1];
        
        if (e.shiftKey) {
          // Shift + Tab
          if (document.activeElement === firstFocusable) {
            e.preventDefault();
            lastFocusable.focus();
          }
        } else {
          // Tab
          if (document.activeElement === lastFocusable) {
            e.preventDefault();
            firstFocusable.focus();
          }
        }
      }
    }

    function startAssessment() {
      // Show calibration page
      document.getElementById('intro-container').style.display = 'none';
      document.getElementById('calibration-container').style.display = 'block';
      window.scrollTo({ top: 0, behavior: 'smooth' });
      createAccessibleIcons();
      trackEvent('calibration_view');
    }
    
    function goBackToIntro() {
      document.getElementById('calibration-container').style.display = 'none';
      document.getElementById('intro-container').style.display = 'block';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    function beginAssessmentQuestions() {
      const industryPref = document.getElementById('industry-pref');
      const orgDomainInput = document.getElementById('org-domain');
      
      if (!industryPref || !industryPref.value) {
        industryPref?.setAttribute('aria-invalid', 'true');
        industryPref?.focus();
        announceToScreenReader('Error: Please select your industry to personalize benchmarks.', true);
        showInlineError('industry-pref', 'Please select your industry');
        return;
      } else {
        industryPref?.setAttribute('aria-invalid', 'false');
        hideInlineError('industry-pref');
      }
      
      if (!orgDomainInput || !orgDomainInput.value.trim()) {
        orgDomainInput?.setAttribute('aria-invalid', 'true');
        orgDomainInput?.focus();
        announceToScreenReader('Error: Please enter your organization email domain to track progress over time.', true);
        showInlineError('org-domain', 'Please enter your email domain');
        return;
      } else {
        orgDomainInput?.setAttribute('aria-invalid', 'false');
        hideInlineError('org-domain');
      }
      
      selectedIndustry = industryPref.value;
      organizationId = orgDomainInput.value.trim().toLowerCase().replace(/^@/, '');
      
      // Show/hide multi-system progress step based on landscape
      const showMultiSystem = SYSTEM_LANDSCAPE_CONFIG[selectedSystemLandscape]?.showMultiSystemQuestions;
      const multiSystemStep = document.getElementById('multisystem-step');
      if (multiSystemStep) {
        multiSystemStep.style.display = showMultiSystem ? 'inline-block' : 'none';
      }
      
      // Filter questions based on selected role and system landscape
      filteredQuestions = filterQuestionsByRole(selectedRole);
      currentQuestionIndex = 0;
      answers = {};
      
      document.getElementById('calibration-container').style.display = 'none';
      document.getElementById('assessment-container').style.display = 'block';
      trackEvent('assessment_start', { 
        industry: selectedIndustry, 
        organizationId, 
        assessmentType,
        role: selectedRole,
        systemLandscape: selectedSystemLandscape,
        toolStack: selectedTools.join(','),
        questionCount: filteredQuestions.length
      });
      renderQuestion();
    }

    function resetAssessment() {
      currentQuestionIndex = 0;
      answers = {};
      deploymentTier = 'D1';
      pendingResults = null;
      document.getElementById('intro-container').style.display = 'block';
      document.getElementById('calibration-container').style.display = 'none';
      document.getElementById('assessment-container').style.display = 'none';
      document.getElementById('results-container').style.display = 'none';
      document.getElementById('lead-form-container').style.display = 'block';
      document.getElementById('results-content').style.display = 'none';
      const leadForm = document.getElementById('lead-form');
      if (leadForm) {
        leadForm.reset();
      }
      // Scroll to top
      trackEvent('assessment_reset');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    async function submitLeadForm(event) {
      event.preventDefault();
      const form = event.target;
      if (!form.reportValidity()) return;
      
      // Disable submit button while saving
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span style="display: inline-block; width: 16px; height: 16px; border: 2px solid #fff; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 8px;"></span>Saving...';
      
      // Collect form data
      const formData = {
        firstName: form.elements.namedItem('firstName')?.value || '',
        lastName: form.elements.namedItem('lastName')?.value || '',
        workEmail: form.elements.namedItem('workEmail')?.value || '',
        company: form.elements.namedItem('company')?.value || '',
        companySize: form.elements.namedItem('companySize')?.value || '',
        regulatoryEnv: form.elements.namedItem('regulatoryEnv')?.value || '',
        role: form.elements.namedItem('role')?.value || '',
        context: form.elements.namedItem('context')?.value || ''
      };
      
      trackEvent('lead_form_submit', {
        industry: selectedIndustry || 'Unknown',
        companySize: formData.companySize || 'Unknown',
        regulatoryEnv: formData.regulatoryEnv || 'Unknown',
        role: formData.role || 'Unknown',
        assessmentType: assessmentType,
        organizationId: organizationId
      });
      
      // Save to Google Sheets
      const payload = buildAssessmentPayload(pendingResults, formData);
      await saveToGoogleSheets(payload);
      
      // Re-enable button
      submitBtn.disabled = false;
      submitBtn.innerHTML = originalText;
      
      renderResults(pendingResults);
    }

    function downloadResults() {
      trackEvent('cta_download_results');
      const results = {
        overallScore: document.getElementById('overall-score').textContent,
        foundationScore: document.getElementById('foundation-score').textContent,
        aiScore: document.getElementById('ai-score').textContent,
        orgScore: document.getElementById('org-score').textContent,
        deploymentTier: deploymentTier,
        recommendedPath: recommendedPath,
        industry: selectedIndustry,
        timestamp: new Date().toISOString()
      };
      
      const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `ipe-assessment-results-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      announce('Results file downloaded.');
    }

    function buildResultsSummary() {
      const totalScore = document.getElementById('overall-score')?.textContent || '—';
      const tier = document.getElementById('readiness-tier')?.textContent || '—';
      const benchmark = document.getElementById('benchmark-label')?.textContent || 'Benchmark —';
      return `IPE Readiness Summary\nTier: ${tier}\n${benchmark}\nScore: ${totalScore}/100\nDeployment: ${deploymentTier}\nIndustry: ${selectedIndustry}`;
    }

    function emailResults() {
      trackEvent('cta_email_results');
      const subject = encodeURIComponent('My IPE Assessment Results');
      const body = encodeURIComponent(buildResultsSummary());
      window.location.href = `mailto:?subject=${subject}&body=${body}`;
      announce('Opening email client.');
    }

    function copyResultsSummary() {
      const summary = buildResultsSummary();
      trackEvent('cta_copy_summary');
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(summary).then(() => {
          announce('Results summary copied to clipboard.');
        }).catch(() => {
          announce('Failed to copy to clipboard.');
        });
      } else {
        const temp = document.createElement('textarea');
        temp.value = summary;
        document.body.appendChild(temp);
        temp.select();
        document.execCommand('copy');
        document.body.removeChild(temp);
        announce('Results summary copied to clipboard.');
      }
    }
    
    // =========================================================================
    // PDF REPORT GENERATION
    // =========================================================================
    
    function generatePDFReport() {
      trackEvent('cta_generate_pdf');
      
      const psri = pendingResults?.psriScore || document.getElementById('psri-display')?.textContent || '—';
      const tier = document.getElementById('readiness-tier')?.textContent || 'Foundation';
      const benchmark = document.getElementById('benchmark-label')?.textContent || '—';
      const foundationNorm = pendingResults?.foundationNorm || 0;
      const aiNorm = pendingResults?.aiNorm || 0;
      const orgNorm = pendingResults?.orgNorm || 0;
      const deliveryNorm = pendingResults?.deliveryNorm || 0;
      const cultureNorm = pendingResults?.cultureNorm || 0;
      const archetypeKey = getArchetypeFromScore(psriScore);
      const archetype = archetypeDetails[archetypeKey];
      const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      
      // Build progress comparison if available
      let progressSection = '';
      if (baselineData && assessmentType === 'follow-up') {
        const psriDelta = psri - (baselineData.psriScore || 0);
        progressSection = `
          <div style="background: #e8f5e9; border-radius: 8px; padding: 16px; margin-bottom: 24px;">
            <h3 style="color: #2e7d32; margin-bottom: 8px; font-size: 14px;">Progress Since Baseline</h3>
            <p style="font-size: 24px; font-weight: 700; color: #1b5e20;">
              ${psriDelta >= 0 ? '+' : ''}${psriDelta} points
            </p>
            <p style="font-size: 12px; color: #4caf50;">
              From ${baselineData.psriScore} to ${psri} since ${new Date(baselineData.timestamp).toLocaleDateString()}
            </p>
          </div>
        `;
      }
      
      // Create PDF content
      const pdfContent = document.createElement('div');
      pdfContent.innerHTML = `
        <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; color: #1a1a2e;">
          <!-- Header -->
          <div style="text-align: center; margin-bottom: 32px; padding-bottom: 24px; border-bottom: 3px solid #6436bf;">
            <div style="display: inline-block; background: #6436bf; color: white; padding: 6px 16px; border-radius: 16px; font-size: 11px; font-weight: 600; letter-spacing: 1px; margin-bottom: 16px;">
              PSRI ASSESSMENT REPORT v${PSRI_VERSION}
            </div>
            <h1 style="font-size: 28px; font-weight: 700; margin: 0 0 8px 0; color: #1a1a2e;">
              Product System Readiness Index
            </h1>
            <p style="color: #666; font-size: 14px; margin: 0;">
              ${organizationId ? organizationId.toUpperCase() + ' • ' : ''}${selectedIndustry} • ${date}
            </p>
          </div>
          
          <!-- Executive Summary -->
          <div style="background: linear-gradient(135deg, #6436bf 0%, #42247f 100%); color: white; border-radius: 12px; padding: 24px; margin-bottom: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <p style="font-size: 12px; opacity: 0.8; margin: 0 0 4px 0; text-transform: uppercase; letter-spacing: 1px;">Your PSRI Score</p>
                <p style="font-size: 48px; font-weight: 700; margin: 0;">${psri}<span style="font-size: 24px; opacity: 0.7;">/100</span></p>
              </div>
              <div style="text-align: right;">
                <p style="font-size: 12px; opacity: 0.8; margin: 0 0 4px 0;">Readiness Tier</p>
                <p style="font-size: 24px; font-weight: 700; margin: 0;">${tier}</p>
                <p style="font-size: 14px; opacity: 0.9; margin-top: 4px;">${benchmark}</p>
              </div>
            </div>
          </div>
          
          ${progressSection}
          
          <!-- Pillar Breakdown -->
          <div style="margin-bottom: 24px;">
            <h2 style="font-size: 16px; font-weight: 700; color: #1a1a2e; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid #e0e0e0;">
              Pillar Breakdown
            </h2>
            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px;">
              <div style="background: #f5f5f5; border-radius: 8px; padding: 12px; text-align: center;">
                <p style="font-size: 10px; color: #666; margin: 0 0 6px 0; text-transform: uppercase;">Foundation</p>
                <p style="font-size: 22px; font-weight: 700; color: #10b981; margin: 0;">${foundationNorm}%</p>
                <div style="height: 3px; background: #e0e0e0; border-radius: 2px; margin-top: 6px;">
                  <div style="height: 100%; background: #10b981; border-radius: 2px; width: ${foundationNorm}%;"></div>
                </div>
                <p style="font-size: 9px; color: #888; margin: 4px 0 0 0;">20% weight</p>
              </div>
              <div style="background: #f5f5f5; border-radius: 8px; padding: 12px; text-align: center;">
                <p style="font-size: 10px; color: #666; margin: 0 0 6px 0; text-transform: uppercase;">AI Readiness</p>
                <p style="font-size: 22px; font-weight: 700; color: #8b5cf6; margin: 0;">${aiNorm}%</p>
                <div style="height: 3px; background: #e0e0e0; border-radius: 2px; margin-top: 6px;">
                  <div style="height: 100%; background: #8b5cf6; border-radius: 2px; width: ${aiNorm}%;"></div>
                </div>
                <p style="font-size: 9px; color: #888; margin: 4px 0 0 0;">20% weight</p>
              </div>
              <div style="background: #f5f5f5; border-radius: 8px; padding: 12px; text-align: center;">
                <p style="font-size: 10px; color: #666; margin: 0 0 6px 0; text-transform: uppercase;">Governance</p>
                <p style="font-size: 22px; font-weight: 700; color: #3b82f6; margin: 0;">${orgNorm}%</p>
                <div style="height: 3px; background: #e0e0e0; border-radius: 2px; margin-top: 6px;">
                  <div style="height: 100%; background: #3b82f6; border-radius: 2px; width: ${orgNorm}%;"></div>
                </div>
                <p style="font-size: 9px; color: #888; margin: 4px 0 0 0;">20% weight</p>
              </div>
              <div style="background: #f5f5f5; border-radius: 8px; padding: 12px; text-align: center;">
                <p style="font-size: 10px; color: #666; margin: 0 0 6px 0; text-transform: uppercase;">Delivery</p>
                <p style="font-size: 22px; font-weight: 700; color: #f59e0b; margin: 0;">${deliveryNorm}%</p>
                <div style="height: 3px; background: #e0e0e0; border-radius: 2px; margin-top: 6px;">
                  <div style="height: 100%; background: #f59e0b; border-radius: 2px; width: ${deliveryNorm}%;"></div>
                </div>
                <p style="font-size: 9px; color: #888; margin: 4px 0 0 0;">15% weight</p>
              </div>
              <div style="background: #fff8f3; border-radius: 8px; padding: 12px; text-align: center; border: 1px solid #fb923c;">
                <p style="font-size: 10px; color: #ea580c; margin: 0 0 6px 0; text-transform: uppercase; font-weight: 600;">Culture ★</p>
                <p style="font-size: 22px; font-weight: 700; color: #ea580c; margin: 0;">${cultureNorm}%</p>
                <div style="height: 3px; background: #fed7aa; border-radius: 2px; margin-top: 6px;">
                  <div style="height: 100%; background: #ea580c; border-radius: 2px; width: ${cultureNorm}%;"></div>
                </div>
                <p style="font-size: 9px; color: #ea580c; margin: 4px 0 0 0;">25% weight</p>
              </div>
            </div>
          </div>
          
          <!-- Recommended Focus -->
          <div style="background: #f8f4ff; border: 2px solid ${archetype.color}; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
            <h2 style="font-size: 16px; font-weight: 700; color: ${archetype.color}; margin: 0 0 8px 0;">
              Your Maturity Stage: ${archetype.name}
            </h2>
            <p style="font-size: 14px; font-weight: 600; color: #1a1a2e; margin: 0 0 12px 0;">${archetype.headline}</p>
            <p style="font-size: 13px; color: #333; margin: 0 0 16px 0;">${archetype.description}</p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
              <div>
                <p style="font-size: 11px; color: #666; margin: 0 0 8px 0; text-transform: uppercase; font-weight: 600;">Priority Focus Areas</p>
                <ul style="margin: 0; padding-left: 16px; font-size: 12px; color: #333;">
                  ${archetype.focus.map(item => `<li style="margin-bottom: 4px;">${item}</li>`).join('')}
                </ul>
              </div>
              <div>
                <p style="font-size: 11px; color: #666; margin: 0 0 8px 0; text-transform: uppercase; font-weight: 600;">Expected Outcomes</p>
                <ul style="margin: 0; padding-left: 16px; font-size: 12px; color: #333;">
                  ${archetype.outcomes.map(item => `<li style="margin-bottom: 4px;">${item}</li>`).join('')}
                </ul>
              </div>
            </div>
            <p style="font-size: 12px; color: #666; margin: 16px 0 0 0; font-style: italic;">${archetype.timeframe}</p>
          </div>
          
          <!-- Next Steps -->
          <div style="margin-bottom: 24px;">
            <h2 style="font-size: 16px; font-weight: 700; color: #1a1a2e; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid #e0e0e0;">
              Recommended Next Steps
            </h2>
            <ol style="margin: 0; padding-left: 20px; font-size: 14px; color: #333;">
              ${getNextStepsForPath(recommendedPath).map(step => `<li style="margin-bottom: 8px;">${step}</li>`).join('')}
            </ol>
          </div>
          
          <!-- Gating Notice -->
          ${pendingResults?.gatingApplied?.ai || pendingResults?.gatingApplied?.delivery ? `
          <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 12px 16px; margin-bottom: 24px;">
            <p style="font-size: 12px; color: #e65100; margin: 0; font-weight: 600;">Note on Gated Scores</p>
            <p style="font-size: 12px; color: #666; margin: 4px 0 0 0;">
              ${pendingResults?.gatingApplied?.ai ? 'AI Readiness score was adjusted due to Foundation being below threshold. ' : ''}
              ${pendingResults?.gatingApplied?.delivery ? 'Delivery score was adjusted due to Governance being below threshold.' : ''}
            </p>
          </div>
          ` : ''}
          
          <!-- Footer -->
          <div style="text-align: center; padding-top: 24px; border-top: 1px solid #e0e0e0; margin-top: 32px;">
            <p style="font-size: 11px; color: #999; margin: 0;">
              Generated by Knapsack PSRI v${PSRI_VERSION} on ${date}
            </p>
            <p style="font-size: 11px; color: #999; margin: 4px 0 0 0;">
              For more information, visit knapsack.cloud or contact ipe@knapsack.cloud
            </p>
          </div>
        </div>
      `;
      
      // Generate PDF
      const opt = {
        margin: 0.5,
        filename: `PSRI-Report-${organizationId || 'assessment'}-${new Date().toISOString().split('T')[0]}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
      };
      
      announce('Generating PDF report. This may take a moment.');
      html2pdf().set(opt).from(pdfContent).save().then(() => {
        announce('PDF report downloaded.');
      });
    }
    
    function getNextStepsForPath(path) {
      const steps = {
        J1: [
          'Schedule a readiness review to establish your baseline',
          'Align ownership and decision rights for the product system',
          'Inventory core components, tokens, and usage patterns',
          'Define governance standards before scaling adoption'
        ],
        J2: [
          'Confirm trigger event and urgency timeline',
          'Run a rapid enablement sprint for priority workflows',
          'Compress timeline with a focus on speed and clarity',
          'Standardize the highest-impact experiences first'
        ],
        J3: [
          'Run a readiness review and quantify adoption gaps',
          'Tighten governance rules and decision flow',
          'Drive adoption across priority teams and products',
          'Measure usage and quality signals every release'
        ],
        J4: [
          'Identify AI workflows to pilot with governed context',
          'Ensure rules and metadata are production-ready',
          'Expand AI-assisted delivery to more teams',
          'Measure impact and iterate on governance'
        ]
      };
      return steps[path] || steps.J1;
    }

    function renderResultsPreview(results) {
      const preview = document.getElementById('results-preview');
      if (!preview || !results) return;
      const archetypeKey = getArchetypeFromScore(results.psriScore || results.totalScore);
      const archetype = archetypeDetails[archetypeKey];
      const benchmarkData = generateBenchmarkComparison(results.totalScore, results.foundationScore, results.aiScore, results.orgScore, recommendedPath, selectedIndustry);
      preview.innerHTML = `
        <p style="font-size: 0.8rem; color: rgba(255,255,255,0.6); margin-bottom: 6px;">Preview your results</p>
        <div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
          <span style="font-weight: 700; color: ${archetype.color};">${archetype.name}</span>
          <span style="font-size: 0.75rem; color: rgba(255,255,255,0.7);">PSRI ${results.psriScore || results.totalScore}/100</span>
          <span style="font-size: 0.75rem; color: rgba(255,255,255,0.7);">${getBenchmarkLabel(results.psriScore || results.totalScore, benchmarkData)}</span>
        </div>
        <p style="font-size: 0.75rem; color: rgba(255,255,255,0.55); margin-top: 6px;">Submit details to reveal your personalized roadmap.</p>
      `;
    }

    // =========================================================================
    // NEW: Executive Summary, Maturity Journey, Priority Actions
    // =========================================================================
    
    function toggleExecutiveSummary() {
      const content = document.getElementById('exec-summary-content');
      const toggle = document.getElementById('exec-summary-toggle');
      if (content.style.display === 'none') {
        content.style.display = 'block';
        toggle.innerHTML = '<i data-lucide="chevron-up" style="width: 16px; height: 16px;"></i><span>Collapse</span>';
      } else {
        content.style.display = 'none';
        toggle.innerHTML = '<i data-lucide="chevron-down" style="width: 16px; height: 16px;"></i><span>Expand</span>';
      }
      createAccessibleIcons();
    }
    
    function renderExecutiveSummary(psriScore, archetype, archetypeKey, foundationNorm, aiNorm, orgNorm, deliveryNorm, cultureNorm, benchmarkData) {
      // Animate score
      animateCounter(document.getElementById('exec-score'), psriScore, 1000);
      
      // Archetype
      document.getElementById('exec-archetype').textContent = archetype.name;
      
      // Percentile
      const percentile = psriScore >= 80 ? 'Top 10%' : psriScore >= 60 ? 'Top 35%' : psriScore >= 40 ? 'Top 65%' : 'Bottom 35%';
      document.getElementById('exec-percentile').textContent = percentile;
      
      // Industry rank
      const rankLabels = { 'Top 25%': 'Leading', 'Top 50%': 'Above Average', 'Bottom 50%': 'Below Average', 'Bottom 25%': 'Lagging' };
      document.getElementById('exec-rank').textContent = benchmarkData.comparison || 'Average';
      document.getElementById('exec-industry').textContent = `in ${selectedIndustry}`;
      
      // Find key strength and gap using consistent pillar icons
      const pillars = [
        { name: 'Foundation', score: foundationNorm, key: 'foundation' },
        { name: 'AI Readiness', score: aiNorm, key: 'ai' },
        { name: 'Governance', score: orgNorm, key: 'governance' },
        { name: 'Delivery', score: deliveryNorm, key: 'delivery' },
        { name: 'Culture', score: cultureNorm, key: 'culture' }
      ];
      
      const sortedByScore = [...pillars].sort((a, b) => b.score - a.score);
      const strength = sortedByScore[0];
      const gap = sortedByScore[sortedByScore.length - 1];
      
      document.getElementById('exec-strength').textContent = `${strength.name} (${strength.score}%) — Your strongest pillar`;
      document.getElementById('exec-gap').textContent = `${gap.name} (${gap.score}%) — Priority improvement area`;
      
      // Bottom line
      let bottomLine = '';
      if (psriScore >= 75) {
        bottomLine = `Your organization is among the most mature we've assessed. Focus on optimizing AI governance and scaling your contribution model to maintain competitive advantage.`;
      } else if (psriScore >= 55) {
        bottomLine = `You have solid foundations in place. Prioritize ${gap.name.toLowerCase()} improvements to unlock the next tier of maturity and accelerate delivery velocity.`;
      } else if (psriScore >= 40) {
        bottomLine = `Your product system is developing but gaps remain. Concentrate on strengthening ${gap.name.toLowerCase()} while building governance practices to support sustainable growth.`;
      } else {
        bottomLine = `You're in the early stages of product system maturity. Start with foundational components and governance before expanding to AI capabilities. Expected time to next tier: 6-9 months.`;
      }
      document.getElementById('exec-bottomline').textContent = bottomLine;
    }
    
    function renderMaturityJourney(psriScore, archetypeKey) {
      // Calculate progress line width based on score
      const progressPercent = Math.min(100, Math.max(0, (psriScore / 100) * 100));
      
      setTimeout(() => {
        const progressLine = document.getElementById('journey-progress-line');
        if (progressLine) {
          progressLine.style.width = `${progressPercent}%`;
        }
      }, 300);
      
      // Highlight current stage
      const stages = ['builder', 'adopter', 'optimizer', 'transformer'];
      stages.forEach(stage => {
        const stageEl = document.getElementById(`journey-stage-${stage}`);
        if (stageEl) {
          const circle = stageEl.querySelector('div');
          if (stage === archetypeKey) {
            // Current stage - make it pop
            circle.style.transform = 'scale(1.15)';
            circle.style.boxShadow = '0 0 20px rgba(100, 54, 191, 0.5)';
            circle.style.borderWidth = '4px';
            stageEl.querySelector('p').style.color = '#fff';
          } else if (stages.indexOf(stage) < stages.indexOf(archetypeKey)) {
            // Completed stages
            circle.style.opacity = '0.9';
          } else {
            // Future stages
            circle.style.opacity = '0.4';
          }
        }
      });
      
      // Position callout text
      const archetype = archetypeDetails[archetypeKey];
      const nextStage = stages[stages.indexOf(archetypeKey) + 1];
      let positionText = '';
      
      if (archetypeKey === 'transformer') {
        positionText = `Congratulations! You're a Transformer — among the top 10% of organizations. Focus on continuous innovation and AI-first delivery.`;
      } else if (nextStage) {
        const nextArchetype = archetypeDetails[nextStage];
        const monthsToNext = archetypeKey === 'builder' ? '6-9' : archetypeKey === 'adopter' ? '9-12' : '12-18';
        positionText = `You're an ${archetype.name}. With focused effort, you could reach ${nextArchetype.name} status in ${monthsToNext} months.`;
      }
      
      document.getElementById('journey-position-text').textContent = positionText;
    }
    
    function renderPriorityActions(foundationNorm, aiNorm, orgNorm, deliveryNorm, cultureNorm, psriScore) {
      const actions = [];
      
      // Analyze gaps and create prioritized actions
      const pillars = [
        { 
          name: 'Foundation', 
          score: foundationNorm, 
          color: '#6ee7b7',
          bgColor: 'rgba(16, 185, 129, 0.15)',
          borderColor: 'rgba(16, 185, 129, 0.3)',
          icon: 'building',
          lowAction: 'Establish component library with design tokens',
          lowWhy: 'A weak foundation limits all other improvements. Start here.',
          medAction: 'Improve documentation and accessibility compliance',
          medWhy: 'Good foundation, but gaps in documentation slow adoption.',
          effort: 'Medium',
          timeline: '4-8 weeks'
        },
        { 
          name: 'AI Readiness', 
          score: aiNorm, 
          color: '#c4b5fd',
          bgColor: 'rgba(196, 181, 253, 0.15)',
          borderColor: 'rgba(196, 181, 253, 0.3)',
          icon: 'sparkles',
          lowAction: 'Structure metadata and APIs for AI consumption',
          lowWhy: 'AI tools can\'t leverage your system without structured data.',
          medAction: 'Implement AI governance and guardrails',
          medWhy: 'AI adoption is growing but lacks governance structure.',
          effort: 'High',
          timeline: '8-12 weeks'
        },
        { 
          name: 'Governance', 
          score: orgNorm, 
          color: '#93c5fd',
          bgColor: 'rgba(59, 130, 246, 0.15)',
          borderColor: 'rgba(59, 130, 246, 0.3)',
          icon: 'shield',
          lowAction: 'Secure executive sponsor and define ROI metrics',
          lowWhy: 'Without sponsorship, initiatives stall under priority pressure.',
          medAction: 'Formalize change management and adoption tracking',
          medWhy: 'Sponsorship exists but adoption isn\'t being measured.',
          effort: 'Medium',
          timeline: '4-6 weeks'
        },
        { 
          name: 'Delivery', 
          score: deliveryNorm, 
          color: '#fde047',
          bgColor: 'rgba(253, 224, 71, 0.15)',
          borderColor: 'rgba(253, 224, 71, 0.3)',
          icon: 'truck',
          lowAction: 'Establish platform team with self-service capabilities',
          lowWhy: 'Product teams carry too much cognitive load without platform support.',
          medAction: 'Increase deployment frequency toward daily releases',
          medWhy: 'Workflow is solid but deployment cadence limits feedback loops.',
          effort: 'High',
          timeline: '8-12 weeks'
        },
        { 
          name: 'Culture', 
          score: cultureNorm, 
          color: '#fb923c',
          bgColor: 'rgba(251, 146, 60, 0.15)',
          borderColor: 'rgba(251, 146, 60, 0.3)',
          icon: 'users',
          lowAction: 'Open contribution model and build psychological safety',
          lowWhy: 'Closed contribution stifles innovation and creates bottlenecks.',
          medAction: 'Improve information flow across teams and disciplines',
          medWhy: 'Community exists but silos limit cross-functional collaboration.',
          effort: 'Medium',
          timeline: '6-10 weeks'
        }
      ];
      
      // Sort by lowest score to find priority gaps
      const sortedPillars = [...pillars].sort((a, b) => a.score - b.score);
      
      // Take top 3 gaps
      const topGaps = sortedPillars.slice(0, 3);
      
      topGaps.forEach((pillar, index) => {
        const isLow = pillar.score < 50;
        const action = isLow ? pillar.lowAction : pillar.medAction;
        const why = isLow ? pillar.lowWhy : pillar.medWhy;
        const impact = pillar.score < 30 ? 'Critical' : pillar.score < 50 ? 'High' : 'Medium';
        // Use darker backgrounds with white text for better contrast (WCAG AA)
        const impactColor = impact === 'Critical' ? '#dc2626' : impact === 'High' ? '#b45309' : '#047857';
        const impactTextColor = '#fff'; // Always white text on dark backgrounds
        
        actions.push({
          priority: index + 1,
          pillar: pillar.name,
          score: pillar.score,
          action,
          why,
          impact,
          impactColor,
          impactTextColor,
          effort: pillar.effort,
          timeline: pillar.timeline,
          color: pillar.color,
          bgColor: pillar.bgColor,
          borderColor: pillar.borderColor,
          icon: pillar.icon
        });
      });
      
      // Render action cards
      const grid = document.getElementById('priority-actions-grid');
      grid.innerHTML = actions.map(a => `
        <div style="background: ${a.bgColor}; border: 1px solid ${a.borderColor}; border-radius: 16px; padding: 20px; position: relative; overflow: hidden;">
          <!-- Priority Badge (WCAG AA compliant) -->
          <div style="position: absolute; top: 16px; right: 16px; background: ${a.impactColor}; color: ${a.impactTextColor}; font-size: 0.8rem; font-weight: 700; padding: 6px 12px; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.5px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
            ${a.impact}
          </div>
          
          <!-- Header -->
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
            <div style="width: 48px; height: 48px; background: ${a.borderColor}; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
              <i data-lucide="${a.icon}" style="width: 24px; height: 24px; color: ${a.color};"></i>
            </div>
            <div>
              <p style="font-size: 0.75rem; color: ${a.color}; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px;">${a.pillar} • ${a.score}%</p>
              <h3 style="font-size: 1.1rem; font-weight: 700; color: #fff; margin: 0;">${a.action}</h3>
            </div>
          </div>
          
          <!-- Why -->
          <p style="font-size: 0.95rem; color: rgba(255,255,255,0.8); line-height: 1.5; margin-bottom: 16px;">${a.why}</p>
          
          <!-- Metrics Row -->
          <div style="display: flex; gap: 16px; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 6px;">
              <i data-lucide="zap" style="width: 14px; height: 14px; color: ${a.color};"></i>
              <span style="font-size: 0.85rem; color: rgba(255,255,255,0.7);">Impact: <strong style="color: #fff;">${a.impact}</strong></span>
            </div>
            <div style="display: flex; align-items: center; gap: 6px;">
              <i data-lucide="gauge" style="width: 14px; height: 14px; color: ${a.color};"></i>
              <span style="font-size: 0.85rem; color: rgba(255,255,255,0.7);">Effort: <strong style="color: #fff;">${a.effort}</strong></span>
            </div>
            <div style="display: flex; align-items: center; gap: 6px;">
              <i data-lucide="clock" style="width: 14px; height: 14px; color: ${a.color};"></i>
              <span style="font-size: 0.85rem; color: rgba(255,255,255,0.7);">Timeline: <strong style="color: #fff;">${a.timeline}</strong></span>
            </div>
          </div>
        </div>
      `).join('');
      
      createAccessibleIcons();
    }
    
    function renderMultiSystemMap(multiSystemNorm, systemLandscape, foundationNorm, aiNorm, orgNorm, cultureNorm) {
      const mapContainer = document.getElementById('multi-system-map');
      const mapContent = document.getElementById('multi-system-map-content');
      if (!mapContainer || !mapContent) return;
      
      // Show the container
      mapContainer.style.display = 'block';
      
      // Get landscape config
      const landscapeConfig = SYSTEM_LANDSCAPE_CONFIG[systemLandscape];
      const landscapeName = landscapeConfig?.name || 'Multi-System';
      
      // Calculate sub-dimension scores from the multi-system questions
      // These are approximations based on the overall multi-system score
      const tokenScore = Math.round(multiSystemNorm * 1.1); // Token architecture tends to be slightly higher
      const componentScore = Math.round(multiSystemNorm * 0.95);
      const governanceScore = Math.round(multiSystemNorm * 1.0);
      const aiContextScore = Math.round(multiSystemNorm * 0.85); // AI context usually lags
      const contributionScore = Math.round(multiSystemNorm * 0.9);
      const syncScore = Math.round(multiSystemNorm * 1.0);
      
      // Cap at 100
      const capped = (score) => Math.min(100, Math.max(0, score));
      
      // Determine maturity level for multi-system
      let multiSystemMaturity = 'Fragmented';
      let maturityColor = '#ef4444';
      let maturityBg = 'rgba(239, 68, 68, 0.15)';
      
      if (multiSystemNorm >= 75) {
        multiSystemMaturity = 'Orchestrated';
        maturityColor = '#10b981';
        maturityBg = 'rgba(16, 185, 129, 0.15)';
      } else if (multiSystemNorm >= 55) {
        multiSystemMaturity = 'Coordinated';
        maturityColor = '#3b82f6';
        maturityBg = 'rgba(59, 130, 246, 0.15)';
      } else if (multiSystemNorm >= 35) {
        multiSystemMaturity = 'Aligned';
        maturityColor = '#fbbf24';
        maturityBg = 'rgba(251, 191, 36, 0.15)';
      }
      
      // Calculate consolidation opportunity
      const avgPillarScore = (foundationNorm + aiNorm + orgNorm + cultureNorm) / 4;
      const consolidationGap = avgPillarScore - multiSystemNorm;
      const hasConsolidationOpp = consolidationGap > 15 && systemLandscape !== 'single';
      
      mapContent.innerHTML = `
        <!-- Multi-System Score Overview -->
        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 24px; margin-bottom: 24px;">
          <!-- Score Card -->
          <div style="background: ${maturityBg}; border: 2px solid ${maturityColor}33; border-radius: 16px; padding: 24px; text-align: center;">
            <p style="font-size: 0.75rem; color: rgba(255,255,255,0.6); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 8px;">System of Systems Score</p>
            <div style="font-size: 3rem; font-weight: 800; color: ${maturityColor}; line-height: 1; margin-bottom: 8px;">${multiSystemNorm}</div>
            <p style="font-size: 0.85rem; color: ${maturityColor}; font-weight: 600;">${multiSystemMaturity}</p>
            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid ${maturityColor}33;">
              <p style="font-size: 0.75rem; color: rgba(255,255,255,0.5);">Landscape Type</p>
              <p style="font-size: 0.9rem; color: #fff; font-weight: 600;">${landscapeName}</p>
            </div>
          </div>
          
          <!-- Dimension Breakdown -->
          <div style="background: rgba(255,255,255,0.03); border-radius: 16px; padding: 24px;">
            <p style="font-size: 0.8rem; color: rgba(255,255,255,0.6); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 16px;">Cross-System Capabilities</p>
            <div style="display: grid; gap: 12px;">
              ${[
                { name: 'Token Architecture', score: capped(tokenScore), icon: 'palette', desc: 'Shared design tokens with inheritance' },
                { name: 'Component Abstraction', score: capped(componentScore), icon: 'layers', desc: 'Brand-agnostic themeable components' },
                { name: 'Cross-System Governance', score: capped(governanceScore), icon: 'shield', desc: 'Unified standards and compliance' },
                { name: 'AI Context Sharing', score: capped(aiContextScore), icon: 'sparkles', desc: 'AI access across all systems' },
                { name: 'Contribution Model', score: capped(contributionScore), icon: 'users', desc: 'Cross-system collaboration' },
                { name: 'Release Coordination', score: capped(syncScore), icon: 'git-merge', desc: 'Versioning and deployment sync' }
              ].map(dim => `
                <div style="display: grid; grid-template-columns: 140px 1fr 40px; gap: 12px; align-items: center;">
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <i data-lucide="${dim.icon}" style="width: 14px; height: 14px; color: #0ea5e9;"></i>
                    <span style="font-size: 0.85rem; color: rgba(255,255,255,0.9);">${dim.name}</span>
                  </div>
                  <div style="height: 8px; background: rgba(14, 165, 233, 0.2); border-radius: 999px; overflow: hidden;">
                    <div style="height: 100%; background: #0ea5e9; width: ${dim.score}%; transition: width 0.8s ease;"></div>
                  </div>
                  <span style="font-size: 0.8rem; color: rgba(255,255,255,0.7); text-align: right;">${dim.score}%</span>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
        
        <!-- System Architecture Visual -->
        <div style="background: rgba(14, 165, 233, 0.08); border: 1px solid rgba(14, 165, 233, 0.2); border-radius: 16px; padding: 24px; margin-bottom: 24px;">
          <p style="font-size: 0.8rem; color: rgba(255,255,255,0.6); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 16px;">Your System Landscape</p>
          
          <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
            <!-- Core Layer -->
            <div style="background: rgba(14, 165, 233, 0.2); border: 2px solid #0ea5e9; border-radius: 12px; padding: 16px 32px; text-align: center; position: relative;">
              <i data-lucide="database" style="width: 20px; height: 20px; color: #0ea5e9; margin-bottom: 4px;"></i>
              <p style="font-size: 0.9rem; font-weight: 600; color: #fff; margin: 0;">Shared Foundation</p>
              <p style="font-size: 0.75rem; color: rgba(255,255,255,0.6); margin: 0;">(Tokens, Primitives)</p>
              <div style="position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%); width: 2px; height: 20px; background: #0ea5e9;"></div>
            </div>
            
            <!-- Connection -->
            <div style="width: 80%; height: 2px; background: linear-gradient(90deg, transparent, #0ea5e9, #0ea5e9, transparent); margin: 8px 0;"></div>
            
            <!-- System Layer -->
            <div style="display: flex; gap: 16px; flex-wrap: wrap; justify-content: center;">
              ${systemLandscape === 'federated' ? `
                <div style="background: rgba(16, 185, 129, 0.15); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 120px;">
                  <p style="font-size: 0.85rem; font-weight: 600; color: #6ee7b7; margin: 0;">Brand A</p>
                  <p style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin: 0;">Extension</p>
                </div>
                <div style="background: rgba(59, 130, 246, 0.15); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 120px;">
                  <p style="font-size: 0.85rem; font-weight: 600; color: #93c5fd; margin: 0;">Brand B</p>
                  <p style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin: 0;">Extension</p>
                </div>
                <div style="background: rgba(251, 146, 60, 0.15); border: 1px solid rgba(251, 146, 60, 0.3); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 120px;">
                  <p style="font-size: 0.85rem; font-weight: 600; color: #fb923c; margin: 0;">Internal</p>
                  <p style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin: 0;">Extension</p>
                </div>
              ` : systemLandscape === 'multiple' ? `
                <div style="background: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 120px; opacity: 0.7;">
                  <p style="font-size: 0.85rem; font-weight: 600; color: #fca5a5; margin: 0;">System 1</p>
                  <p style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin: 0;">Independent</p>
                </div>
                <div style="background: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 120px; opacity: 0.7;">
                  <p style="font-size: 0.85rem; font-weight: 600; color: #fca5a5; margin: 0;">System 2</p>
                  <p style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin: 0;">Independent</p>
                </div>
                <div style="background: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 120px; opacity: 0.7;">
                  <p style="font-size: 0.85rem; font-weight: 600; color: #fca5a5; margin: 0;">System 3</p>
                  <p style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin: 0;">Independent</p>
                </div>
              ` : systemLandscape === 'systemOfSystems' ? `
                <div style="background: rgba(16, 185, 129, 0.15); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 120px;">
                  <p style="font-size: 0.85rem; font-weight: 600; color: #6ee7b7; margin: 0;">External</p>
                  <p style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin: 0;">Customer-facing</p>
                </div>
                <div style="background: rgba(59, 130, 246, 0.15); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 120px;">
                  <p style="font-size: 0.85rem; font-weight: 600; color: #93c5fd; margin: 0;">Internal</p>
                  <p style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin: 0;">Employee tools</p>
                </div>
                <div style="background: rgba(139, 92, 246, 0.15); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 120px;">
                  <p style="font-size: 0.85rem; font-weight: 600; color: #c4b5fd; margin: 0;">Partner</p>
                  <p style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin: 0;">White-label</p>
                </div>
              ` : `
                <div style="background: rgba(239, 68, 68, 0.15); border: 1px dashed rgba(239, 68, 68, 0.5); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 100px;">
                  <p style="font-size: 0.8rem; color: #fca5a5; margin: 0;">?</p>
                </div>
                <div style="background: rgba(239, 68, 68, 0.15); border: 1px dashed rgba(239, 68, 68, 0.5); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 100px;">
                  <p style="font-size: 0.8rem; color: #fca5a5; margin: 0;">?</p>
                </div>
                <div style="background: rgba(239, 68, 68, 0.15); border: 1px dashed rgba(239, 68, 68, 0.5); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 100px;">
                  <p style="font-size: 0.8rem; color: #fca5a5; margin: 0;">?</p>
                </div>
              `}
            </div>
          </div>
          
          <p style="text-align: center; font-size: 0.8rem; color: rgba(255,255,255,0.5); margin-top: 16px;">
            ${systemLandscape === 'federated' ? 'Your federated model shares core primitives across brand-specific extensions' :
              systemLandscape === 'multiple' ? 'Multiple independent systems create opportunities for consolidation' :
              systemLandscape === 'systemOfSystems' ? 'Your orchestrated architecture coordinates across use cases with unified governance' :
              'Fragmented systems need a consolidation strategy for efficiency and consistency'}
          </p>
        </div>
        
        ${hasConsolidationOpp ? `
        <!-- Consolidation Opportunity -->
        <div style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(239, 68, 68, 0.1) 100%); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 16px; padding: 24px;">
          <div style="display: flex; align-items: flex-start; gap: 16px;">
            <div style="width: 48px; height: 48px; background: rgba(251, 191, 36, 0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
              <i data-lucide="lightbulb" style="width: 24px; height: 24px; color: #fbbf24;"></i>
            </div>
            <div>
              <h3 style="font-size: 1.1rem; font-weight: 700; color: #fff; margin-bottom: 8px;">Consolidation Opportunity Detected</h3>
              <p style="font-size: 0.9rem; color: rgba(255,255,255,0.8); margin-bottom: 16px;">
                Your pillar scores average ${Math.round(avgPillarScore)}%, but multi-system coordination is at ${multiSystemNorm}%. 
                This ${Math.round(consolidationGap)}-point gap suggests significant efficiency gains from better system alignment.
              </p>
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                <div style="text-align: center;">
                  <p style="font-size: 1.5rem; font-weight: 700; color: #fbbf24;">~30%</p>
                  <p style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">Potential reduction in duplicate maintenance</p>
                </div>
                <div style="text-align: center;">
                  <p style="font-size: 1.5rem; font-weight: 700; color: #fbbf24;">~40%</p>
                  <p style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">Faster multi-brand delivery with shared core</p>
                </div>
                <div style="text-align: center;">
                  <p style="font-size: 1.5rem; font-weight: 700; color: #fbbf24;">~50%</p>
                  <p style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">Improved consistency across experiences</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        ` : `
        <!-- Multi-System Best Practice -->
        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 16px; padding: 24px;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <i data-lucide="check-circle" style="width: 24px; height: 24px; color: #10b981;"></i>
            <p style="font-size: 0.9rem; color: rgba(255,255,255,0.9); margin: 0;">
              <strong style="color: #6ee7b7;">Well-coordinated!</strong> Your multi-system maturity aligns well with your overall product system capabilities.
            </p>
          </div>
        </div>
        `}
      `;
      
      createAccessibleIcons();
    }
    
    function renderToolStackInsights() {
      const container = document.getElementById('tool-stack-insights');
      const content = document.getElementById('tool-stack-insights-content');
      if (!container || !content) return;
      
      // Analyze the tool stack
      const analysis = analyzeToolStack();
      
      // If no meaningful analysis, hide the section
      if (!analysis && selectedTools.length === 0) {
        container.style.display = 'none';
        return;
      }
      
      // Show the container
      container.style.display = 'block';
      
      // Get tool names for display
      const toolNames = selectedTools
        .filter(t => TOOL_CONFIG[t])
        .map(t => TOOL_CONFIG[t].name);
      
      // Check if this is a Knapsack user
      const isKnapsackUser = analysis && analysis.isKnapsackUser;
      
      // Update header for Knapsack users
      const titleEl = document.getElementById('tool-stack-title');
      const subtitleEl = document.getElementById('tool-stack-subtitle');
      const iconEl = document.getElementById('tool-stack-icon');
      if (isKnapsackUser) {
        if (titleEl) titleEl.textContent = 'Knapsack Optimization Insights';
        if (subtitleEl) subtitleEl.textContent = 'Maximize your unified platform investment';
        if (iconEl) {
          iconEl.setAttribute('data-lucide', 'package');
          iconEl.style.color = 'var(--spectrum-purple-400)';
        }
      } else {
        if (titleEl) titleEl.textContent = 'Tool Stack Assessment';
        if (subtitleEl) subtitleEl.textContent = 'Insights based on your current setup';
        if (iconEl) {
          iconEl.setAttribute('data-lucide', 'wrench');
          iconEl.style.color = 'var(--spectrum-amber-400)';
        }
      }
      
      // Build the content
      let html = `
        <!-- Current Setup -->
        <div style="background: ${isKnapsackUser ? 'linear-gradient(135deg, rgba(100, 54, 191, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%)' : 'rgba(255,255,255,0.03)'}; border-radius: 12px; padding: 16px; margin-bottom: 20px; ${isKnapsackUser ? 'border: 1px solid rgba(100, 54, 191, 0.2);' : ''}">
          <p style="font-size: 0.8rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 12px;">Your Current Stack</p>
          <div style="display: flex; flex-wrap: wrap; gap: 8px;">
            ${toolNames.map(name => `
              <span style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: ${name === 'Knapsack' ? 'linear-gradient(135deg, var(--spectrum-purple-700) 0%, var(--spectrum-purple-900) 100%)' : 'rgba(100, 54, 191, 0.15)'}; border: 1px solid ${name === 'Knapsack' ? 'var(--spectrum-purple-400)' : 'rgba(100, 54, 191, 0.3)'}; border-radius: 999px; font-size: 0.85rem; color: ${name === 'Knapsack' ? '#fff' : 'var(--spectrum-purple-300)'}; ${name === 'Knapsack' ? 'font-weight: 600;' : ''}">
                ${name === 'Knapsack' ? '<i data-lucide="package" style="width: 14px; height: 14px;"></i>' : ''}
                ${name}
              </span>
            `).join('')}
          </div>
        </div>
      `;
      
      // Special handling for Knapsack users
      if (isKnapsackUser) {
        // Get PSRI scores for optimization recommendations
        const foundationNorm = pendingResults?.foundationNorm || 50;
        const aiNorm = pendingResults?.aiNorm || 50;
        const orgNorm = pendingResults?.orgNorm || 50;
        const deliveryNorm = pendingResults?.deliveryNorm || 50;
        const cultureNorm = pendingResults?.cultureNorm || 50;
        
        // Determine top optimization area
        const scores = [
          { area: 'foundation', score: foundationNorm, label: 'Foundation', rec: analysis.optimizations.foundation },
          { area: 'ai', score: aiNorm, label: 'AI Readiness', rec: analysis.optimizations.ai },
          { area: 'governance', score: orgNorm, label: 'Governance', rec: analysis.optimizations.governance },
          { area: 'delivery', score: deliveryNorm, label: 'Delivery', rec: analysis.optimizations.delivery },
          { area: 'culture', score: cultureNorm, label: 'Culture', rec: analysis.optimizations.culture }
        ].sort((a, b) => a.score - b.score);
        
        const topOptimizations = scores.slice(0, 3);
        
        html += `
          <!-- Knapsack User Status -->
          <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(100, 54, 191, 0.1) 100%); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
            <div style="display: flex; align-items: flex-start; gap: 16px;">
              <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                <i data-lucide="check-circle" style="width: 24px; height: 24px; color: #fff;"></i>
              </div>
              <div style="flex: 1;">
                <p style="font-size: 0.75rem; color: #10b981; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 4px;">${analysis.status}</p>
                <p style="font-size: 0.95rem; color: #fff; line-height: 1.6; margin-bottom: 16px;">${analysis.description}</p>
                
                <div style="margin-bottom: 0;">
                  <p style="font-size: 0.75rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">What you have:</p>
                  <ul style="list-style: none; padding: 0; margin: 0;">
                    ${analysis.strengths.map(strength => `
                      <li style="display: flex; align-items: flex-start; gap: 8px; margin-bottom: 8px; font-size: 0.85rem; color: rgba(255,255,255,0.85);">
                        <i data-lucide="check" style="width: 14px; height: 14px; color: #10b981; flex-shrink: 0; margin-top: 2px;"></i>
                        ${strength}
                      </li>
                    `).join('')}
                  </ul>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Optimization Recommendations -->
          <div style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px;">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
              <i data-lucide="rocket" style="width: 20px; height: 20px; color: var(--spectrum-purple-400);"></i>
              <h4 style="font-size: 0.95rem; font-weight: 600; color: #fff; margin: 0;">Optimization Opportunities</h4>
            </div>
            <p style="font-size: 0.85rem; color: rgba(255,255,255,0.6); margin-bottom: 16px;">Based on your assessment, focus on these areas to maximize your Knapsack investment:</p>
            
            <div style="display: flex; flex-direction: column; gap: 12px;">
              ${topOptimizations.map((opt, idx) => `
                <div style="display: flex; align-items: flex-start; gap: 12px; padding: 12px; background: rgba(${idx === 0 ? '100, 54, 191, 0.15' : '255, 255, 255, 0.03'}); border-radius: 8px; ${idx === 0 ? 'border: 1px solid rgba(100, 54, 191, 0.3);' : ''}">
                  <div style="width: 24px; height: 24px; background: ${idx === 0 ? 'var(--spectrum-purple-700)' : 'rgba(255,255,255,0.1)'}; border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 0.75rem; font-weight: 700; color: ${idx === 0 ? '#fff' : 'rgba(255,255,255,0.5)'};">
                    ${idx + 1}
                  </div>
                  <div style="flex: 1;">
                    <p style="font-size: 0.8rem; color: ${idx === 0 ? 'var(--spectrum-purple-300)' : 'rgba(255,255,255,0.5)'}; margin-bottom: 2px;">${opt.label} <span style="color: rgba(255,255,255,0.4);">(${Math.round(opt.score)}%)</span></p>
                    <p style="font-size: 0.85rem; color: rgba(255,255,255,0.85); margin: 0;">${opt.rec}</p>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
        
        // Add connected tools section if they have other tools
        if (analysis.otherTools && analysis.otherTools.length > 0) {
          const connectedToolNames = analysis.otherTools
            .filter(t => TOOL_CONFIG[t])
            .map(t => TOOL_CONFIG[t].name);
          
          html += `
            <div style="margin-top: 16px; padding: 16px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 12px;">
              <div style="display: flex; align-items: center; gap: 10px;">
                <i data-lucide="plug" style="width: 18px; height: 18px; color: #3b82f6;"></i>
                <p style="font-size: 0.85rem; color: rgba(255,255,255,0.8); margin: 0;">
                  <strong style="color: #93c5fd;">Tip:</strong> You're using ${connectedToolNames.join(', ')} alongside Knapsack. Ensure your integrations are configured for maximum sync efficiency.
                </p>
              </div>
            </div>
          `;
        }
      } else if (analysis) {
        // Non-Knapsack user - show gap analysis
        html += `
          <!-- Gap Analysis -->
          <div style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
            <div style="display: flex; align-items: flex-start; gap: 16px;">
              <div style="width: 48px; height: 48px; background: rgba(251, 191, 36, 0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                <i data-lucide="alert-triangle" style="width: 24px; height: 24px; color: #fbbf24;"></i>
              </div>
              <div style="flex: 1;">
                <p style="font-size: 0.75rem; color: #fbbf24; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 4px;">Gap Identified</p>
                <h3 style="font-size: 1.1rem; font-weight: 700; color: #fff; margin-bottom: 8px;">${analysis.gap}</h3>
                <p style="font-size: 0.9rem; color: rgba(255,255,255,0.8); line-height: 1.5; margin-bottom: 16px;">${analysis.description}</p>
                
                <div style="margin-bottom: 16px;">
                  <p style="font-size: 0.75rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">What this means:</p>
                  <ul style="list-style: none; padding: 0; margin: 0;">
                    ${analysis.insights.map(insight => `
                      <li style="display: flex; align-items: flex-start; gap: 8px; margin-bottom: 8px; font-size: 0.85rem; color: rgba(255,255,255,0.75);">
                        <i data-lucide="alert-circle" style="width: 14px; height: 14px; color: #fbbf24; flex-shrink: 0; margin-top: 2px;"></i>
                        ${insight}
                      </li>
                    `).join('')}
                  </ul>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Knapsack Positioning -->
          <div style="background: linear-gradient(135deg, rgba(100, 54, 191, 0.15) 0%, rgba(16, 185, 129, 0.1) 100%); border: 1px solid rgba(100, 54, 191, 0.3); border-radius: 12px; padding: 20px;">
            <div style="display: flex; align-items: flex-start; gap: 16px;">
              <div style="width: 48px; height: 48px; background: linear-gradient(135deg, var(--spectrum-purple-700) 0%, var(--spectrum-purple-900) 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                <i data-lucide="lightbulb" style="width: 24px; height: 24px; color: #fff;"></i>
              </div>
              <div style="flex: 1;">
                <p style="font-size: 0.75rem; color: var(--spectrum-purple-300); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 4px;">What a Unified Platform Enables</p>
                <p style="font-size: 0.95rem; color: #fff; line-height: 1.6; margin-bottom: 16px;">${analysis.positioning}</p>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                  <div style="text-align: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                    <i data-lucide="link" style="width: 20px; height: 20px; color: var(--spectrum-green-400); margin-bottom: 6px;"></i>
                    <p style="font-size: 0.75rem; color: rgba(255,255,255,0.7); margin: 0;">Single Source of Truth</p>
                  </div>
                  <div style="text-align: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                    <i data-lucide="shield-check" style="width: 20px; height: 20px; color: var(--spectrum-blue-400); margin-bottom: 6px;"></i>
                    <p style="font-size: 0.75rem; color: rgba(255,255,255,0.7); margin: 0;">Built-in Governance</p>
                  </div>
                  <div style="text-align: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                    <i data-lucide="sparkles" style="width: 20px; height: 20px; color: var(--spectrum-purple-400); margin-bottom: 6px;"></i>
                    <p style="font-size: 0.75rem; color: rgba(255,255,255,0.7); margin: 0;">AI-Ready APIs</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
      } else {
        // No specific gap found - show general insights
        html += `
          <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 20px;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <i data-lucide="check-circle" style="width: 24px; height: 24px; color: #10b981;"></i>
              <div>
                <p style="font-size: 0.9rem; color: rgba(255,255,255,0.9); margin: 0;">
                  <strong style="color: #6ee7b7;">Good foundation!</strong> Your tool stack appears reasonably well-integrated. 
                  Consider how AI-readiness and governance capabilities could further enhance your setup.
                </p>
              </div>
            </div>
          </div>
        `;
      }
      
      content.innerHTML = html;
      createAccessibleIcons();
    }

    function getBenchmarkLabel(totalScore, benchmarkData) {
      if (totalScore >= benchmarkData.topQuartile) return 'Top Quartile';
      if (totalScore >= benchmarkData.industryAvg) return 'Above Average';
      if (totalScore >= 30) return 'Below Average';
      return 'Early Stage';
    }

    function generateBenchmarkComparison(totalScore, foundationScore, aiScore, orgScore, recommendedPath, industry) {
      const benchmarks = getIndustryBenchmarks(industry);
      const industryAvg = benchmarks.industryAvg;
      const topQuartile = benchmarks.topQuartile;
      
      let comparison = '';
      let comparisonDetail = '';
      
      if (totalScore >= topQuartile) {
        comparison = 'You\'re in the top quartile';
        comparisonDetail = '—organizations at this level typically see 40-60% faster development cycles with governed adoption.';
      } else if (totalScore >= industryAvg) {
        comparison = 'You\'re above industry average';
        comparisonDetail = '—organizations in this range unlock significant value through targeted adoption programs.';
      } else if (totalScore >= 30) {
        comparison = 'You\'re below industry average';
        comparisonDetail = '—but within range for transformation. Organizations at this level see the highest ROI from foundation-building.';
      } else {
        comparison = 'You\'re in the early stages';
        comparisonDetail = '—organizations starting here benefit most from building governance early, before technical debt compounds.';
      }
      
      return {
        industryAvg,
        topQuartile,
        comparison,
        comparisonDetail,
        industryLabel: benchmarks.label
      };
    }

    function getIndustryBenchmarks(industry) {
      const benchmarkMap = {
        'Financial Services': { industryAvg: 83.4, topQuartile: 88.0, label: 'Financial Services' },
        'Enterprise Software': { industryAvg: 86.7, topQuartile: 99.0, label: 'Enterprise Software' },
        'Technology / Media': { industryAvg: 85.0, topQuartile: 99.0, label: 'Technology / Media' },
        'Healthcare': { industryAvg: 81.4, topQuartile: 81.0, label: 'Healthcare' },
        'Retail / E-commerce': { industryAvg: 82.6, topQuartile: 81.0, label: 'Retail / E-commerce' },
        'Telecommunications / Media': { industryAvg: 78.2, topQuartile: 77.0, label: 'Telecommunications / Media' },
        'Regulated / Industrial': { industryAvg: 81.0, topQuartile: 81.0, label: 'Regulated / Industrial' },
        'International / Industrial': { industryAvg: 93.0, topQuartile: 99.0, label: 'International / Industrial' },
        'Travel / Hospitality': { industryAvg: 81.0, topQuartile: 81.0, label: 'Travel / Hospitality' },
        'Aerospace / Space': { industryAvg: 52.0, topQuartile: 52.0, label: 'Aerospace / Space' },
        'Education (Nonprofit)': { industryAvg: 65.0, topQuartile: 65.0, label: 'Education (Nonprofit)' },
        'Utilities (Electric)': { industryAvg: 58.0, topQuartile: 58.0, label: 'Utilities (Electric)' },
        'Other / Unknown': { industryAvg: 72.6, topQuartile: 81.0, label: 'Cross-industry' },
        'Unknown': { industryAvg: 57.7, topQuartile: 58.0, label: 'Cross-industry' }
      };
      return benchmarkMap[industry] || { industryAvg: 72.6, topQuartile: 81.0, label: 'Cross-industry' };
    }

    function getDeliveryCultureSummary() {
      const decision = getAssessmentAnswer('decisionClarity');
      const pace = getAssessmentAnswer('experimentPace');
      const collaboration = getAssessmentAnswer('collaboration');
      const workflow = getAssessmentAnswer('workflow');

      const labels = {
        low: 'early',
        medium: 'developing',
        high: 'strong'
      };

      const parts = [];
      if (decision) parts.push(`decision clarity is ${labels[decision] || decision}`);
      if (pace) parts.push(`experimentation pace is ${labels[pace] || pace}`);
      if (collaboration) parts.push(`cross‑functional collaboration is ${labels[collaboration] || collaboration}`);
      if (workflow) parts.push(`delivery workflow consistency is ${labels[workflow] || workflow}`);
      if (parts.length === 0) return '';
      return `You also reported that ${parts.join(', ')}.`;
    }

    function getAssessmentAnswer(key) {
      const index = questions.findIndex(q => q.key === key);
      if (index < 0) return '';
      return answers[index];
    }

    function getTierOutcome(totalScore) {
      const archetypeKey = getArchetypeFromScore(totalScore);
      const outcomes = {
        builder: 'Focus on building the foundation that unlocks consistent delivery and sets you up for AI-ready scale.',
        adopter: 'Focus on scaling adoption and building the community practices that drive long-term success.',
        optimizer: 'Focus on optimization—typically unlocks 40–60% faster delivery with strong adoption and governance.',
        transformer: 'Focus on leading with AI-enabled delivery by applying governed context to production workflows.'
      };
      return outcomes[archetypeKey] || 'Focus on measurable delivery improvements and readiness acceleration.';
    }

    function getAiReadinessStatus(foundationNorm, aiNorm) {
      // Using normalized 0-100 scale
      if (foundationNorm >= 75 && aiNorm >= 75) return 'Ready';
      if (foundationNorm >= 50 && aiNorm >= 50) return 'Prep';
      return 'Locked';
    }

    function getBenchmarkStory(foundationScore, aiScore, orgScore) {
      const foundationBand = foundationScore >= 30 ? 'top' : foundationScore >= 20 ? 'above' : foundationScore >= 10 ? 'below' : 'early';
      const aiBand = aiScore >= 20 ? 'top' : aiScore >= 10 ? 'above' : aiScore >= 5 ? 'below' : 'early';
      const orgBand = orgScore >= 20 ? 'top' : orgScore >= 10 ? 'above' : orgScore >= 5 ? 'below' : 'early';
      const bandMap = {
        top: 'above ~75% of peers',
        above: 'above ~60% of peers',
        below: 'below ~60% of peers',
        early: 'below ~75% of peers'
      };
      return `You are ${bandMap[foundationBand]} in Foundation, ${bandMap[aiBand]} in AI readiness, and ${bandMap[orgBand]} in Governance & adoption.`;
    }

    function getNextBestInvestment(foundationScore, aiScore, orgScore, recommendedPath) {
      if (foundationScore < 15) return 'Component inventory + governance baseline';
      if (aiScore < 10) return 'AI context + rules engine alignment';
      if (orgScore < 10) return 'Executive sponsorship + change enablement plan';
      if (recommendedPath === 'J4') return 'Governed AI workflows + safe scale-out';
      if (recommendedPath === 'J3') return 'Governance activation + adoption depth';
      if (recommendedPath === 'J2') return 'Rapid enablement on priority workflows';
      return 'Readiness review + foundation roadmap';
    }

    // Animated counter for scores
    function animateCounter(element, endValue, duration = 1000) {
      if (!element) return;
      const startValue = 0;
      const startTime = performance.now();
      
      function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        // Ease out cubic
        const easeProgress = 1 - Math.pow(1 - progress, 3);
        const currentValue = Math.round(startValue + (endValue - startValue) * easeProgress);
        
        element.textContent = currentValue;
        
        if (progress < 1) {
          requestAnimationFrame(update);
        }
      }
      
      requestAnimationFrame(update);
    }
    
    // Add staggered fade-in to result cards
    function animateResultCards() {
      const cards = document.querySelectorAll('#results-content .card');
      cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
          card.style.transition = 'opacity 0.4s ease-out, transform 0.4s ease-out';
          card.style.opacity = '1';
          card.style.transform = 'translateY(0)';
        }, 100 + (index * 80));
      });
    }

    // Initialize
    createAccessibleIcons();
  </script>
</body>
</html>



